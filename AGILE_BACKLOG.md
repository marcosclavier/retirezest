# RetireZest - Agile Product Backlog

**Last Updated**: February 4, 2026 (Sprint 8 Day 1: US-072 Complete + US-073/074 Added)
**Product Owner**: JRCB
**Development Team**: RetireZest Team
**Sprint Duration**: 7 days (default)

---

## üìã Table of Contents

1. [Current Sprint](#current-sprint-sprint-8---february-10-16-2026)
2. [Product Backlog](#product-backlog)
3. [Epic Breakdown](#epics)
4. [User Story Template](#user-story-template)
5. [Definition of Done](#definition-of-done)
6. [Sprint Planning](#sprint-planning-process)

---

## üéØ Current Sprint: Sprint 8 - February 4-11, 2026 (7 days)

**Sprint Goal**: "Fix critical employment income bug and unblock 19 users who entered assets but never ran simulations"

**Sprint Planning Date**: February 4, 2026
**Sprint Duration**: 7 days (bug fix + user conversion sprint)
**Team Capacity**: 18 story points (focused sprint with critical bug fix)
**Sprint Type**: Critical Bug Fix + User Conversion Optimization
**Sprint Status**: üîÑ In Progress (Day 1 - US-072 Completed ‚úÖ)

### Sprint 8 Backlog (IN PROGRESS) - REVISED

**PHASE 1: Verify & Fix Critical Bugs (Before User Outreach)**

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-072 | Fix Employment Income Not Applied Before Retirement | 3 | P0 üî¥ | Epic 5: Simulation | ‚úÖ Done |
| US-073 | Auto-Stop rental_income_annual When Property Is Sold | 2 | P0 üî¥ | Epic 5: Simulation | ‚úÖ Done |
| US-075 | Connect Real Estate Downsizing UI to Simulation Engine | 5 | P0 üî¥ | Epic 5: Simulation | ‚úÖ Done |
| US-074 | Add Automatic endAge for Rental Income in other_incomes | 3 | P1 üü° | Epic 5: Simulation | üìã To Do |

**PHASE 2: UX Improvements (After Bugs Fixed)**

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| ~~US-066~~ | ~~Make "Run Simulation" Button Prominent~~ | ~~2~~ | ~~P0~~ | ~~Epic 1~~ | ‚úÖ Already Done |
| US-067 | Add Post-Onboarding Redirect and Welcome Modal | 2 | P1 üü° | Epic 1: Retention | üìã To Do |
| US-068 | Add Empty State on Results Tab | 1 | P1 üü° | Epic 1: Retention | üìã To Do |
| US-044 | Improve Cash Flow Gap Messaging | 2 | P1 üü° | Epic 4: UX | üìã To Do |

**PHASE 3: User Outreach (Final, After Everything Verified)**

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-071 | Re-engagement Email Campaign for 19 Users | 2 | P1 üü° | Epic 1: Retention | ‚è∏Ô∏è On Hold |

**STRETCH GOALS (Optional)**

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-069 | Add Simulation Validation with Clear Error Messages | 2 | P2 üü¢ | Epic 1: Retention | üìã Stretch |
| US-070 | Improve Simulation Loading State | 1 | P2 üü¢ | Epic 1: Retention | üìã Stretch |
| US-053 | Optimize Dashboard Layout Query (JWT Caching) | 3 | P1 üü° | Epic 6: Quality | üìã Stretch |

**Total Story Points**: 15 committed (was 10) + 6 stretch = 21 total
**Rationale**: Added US-073 (2 pts) and US-074 (3 pts) to ensure all simulation accuracy bugs are fixed before user outreach
**Note**: US-071 moved to Phase 3 (on hold) - will not communicate with users until bugs are fixed
**Sprint Board**: [SPRINT_8_PLAN.md](SPRINT_8_PLAN.md)

**Critical Issues Identified**:
- üî¥ **US-072**: Employment income bug affecting all pre-retirement users
  - Location: `/juan-retirement-app/modules/simulation.py:1357`
  - Impact: Missing `endAge` check causes incorrect cash flow projections
  - User: Daniel Gonzalez (danjgonzalezm@gmail.com) - 1% success rate instead of 95%+
  - Evidence: Tax = $0 in 2026-2027 despite $200K employment income
  - Fix: Add `endAge` check with special handling for employment income
- üî¥ **User Conversion Issue**: 19 active users with $20.6M in assets haven't run simulations
  - Root Cause: Simulation button not prominent, no post-onboarding guidance
  - Revenue at Risk: $456/year (if 50% convert to premium)
  - Fix: US-066, US-067, US-068, US-071

**Sprint 8 Success Criteria**:
- ‚úÖ **COMPLETED**: US-072 deployed: Daniel's simulation shows correct tax (> $0 in 2026-2027)
- ‚úÖ **COMPLETED**: Employment income bug fixed - 2 critical bugs discovered and fixed
- ‚úÖ **COMPLETED**: All 5 verification test cases passing (100%)
- ‚úÖ **COMPLETED**: Code pushed to production (6 commits, GitHub main branch)
- ‚è≥ **PENDING**: Verify Railway/Vercel auto-deployment completed
- ‚è≥ **PENDING**: Production verification - Daniel's simulation shows correct results
- üìã **TO DO**: 19 users receive re-engagement email
- üìã **TO DO**: At least 5/19 users (26%) run their first simulation
- üìã **TO DO**: Simulation button redesigned and prominent (US-066 already done)
- üìã **TO DO**: Post-onboarding redirect and welcome modal live

### Sprint 8 Progress Report (Day 1 - February 4, 2026)

**Completed Today**:
- ‚úÖ **US-072 COMPLETED** (3 story points)
  - Initial implementation: Fixed employment income endAge check
  - Bug #1 discovered: Non-existent `retirement_age` field referenced
  - Bug #1 fixed: Changed to use `cpp_start_age` as retirement age proxy
  - Bug #2 discovered: Tax splitting losing employment/pension income
  - Bug #2 fixed: Updated `recompute_tax()` to include `other_income` and `pension_income`
  - Created comprehensive test suite: 5 test cases, all passing
  - Production deployment: 6 commits pushed to GitHub main branch
  - Documentation: SPRINT_8_DAY_2_PROGRESS.md, PRODUCTION_DEPLOYMENT_SPRINT_8.md

**Test Results**:
```
‚úÖ Test 1: Daniel Gonzalez (Age 64: Tax = $60,896, Age 65: Tax = $82,950, Age 66: Tax = $0)
‚úÖ Test 2: Early Retirement (Age 50: Tax = $23,266, Age 55: Tax = $0)
‚úÖ Test 3: Late Retirement (Age 65: Tax = $16,699, Age 70: Tax = $379)
‚úÖ Test 4: Regression Test (CPP: $15,000, OAS: $8,000, Other Income: $0)
‚úÖ Test 5: Multiple Incomes (Age 64: Other = $124,000, Age 66: Other = $24,000)
Tests Passed: 5/5 (100%)
```

**Production Commits**:
1. `b1a41f4` - Initial US-072 implementation (employment income endAge check)
2. `4bbc911` - Verification plan and Sprint 8 backlog update
3. `59a5f24` - Sprint 8 Day 1 progress report
4. `3b65825` - Fix retirement_age field bug (CRITICAL)
5. `b3e54f5` - Fix tax splitting bug that zeros out employment income (CRITICAL)
6. `8b416d0` - Complete verification test suite and Day 2 progress report

**Velocity**:
- Story points completed: 3/10 committed (30%)
- Days elapsed: 1/7 (14%)
- On track for sprint completion

**Blockers**: None

**Additional Discoveries**:
- üîç **Rental Income Investigation**: Completed investigation into how rental income handles property sales
  - Found 2 bugs in rental income lifecycle management
  - Created US-073: Auto-stop `rental_income_annual` when property is sold (2 pts)
  - Created US-074: Add automatic endAge for rental income in `other_incomes` array (3 pts)
  - Both stories added to Epic 5 backlog for future sprint

**Next Steps**:
1. Verify Railway Python API auto-deployment completed
2. Verify Vercel frontend auto-deployment completed
3. Test production API health endpoint
4. Re-run Daniel Gonzalez's simulation in production
5. Begin US-067 (Post-onboarding redirect and welcome modal)

**Sprint 8 Focus**:
- Fix critical simulation accuracy bug (US-072) - affects all pre-retirees
- Implement user conversion improvements (US-066, US-067, US-068)
- Re-engage 19 users with assets (US-071)
- Improve cash flow gap messaging (US-044)
- Stretch: Validation, loading state, performance optimization

**Sprint 7 ‚Üí Sprint 8 Learnings Applied**:
- User-reported bugs provide critical insights (Daniel's screenshot revealed bug)
- Employment income logic requires special handling (default to retirement age)
- Simulation accuracy is paramount - fix before more users are affected
- User conversion requires multiple touchpoints (button, modal, empty state, email)
- Conservative sprint planning (67% committed) allows for thorough testing

---

## üéØ Previous Sprint: Sprint 7 - February 2-9, 2026 (Status: Deferred)

**Sprint Goal**: "Ship a bulletproof, bug-free RetireZest with < 500ms response times and 100% feature reliability"

**Status**: ‚ö†Ô∏è Deferred to Sprint 9 - Sprint 8 takes priority due to critical bug

**Sprint Planning Date**: February 1, 2026
**Sprint Duration**: 7 days (planned)
**Team Capacity**: 15 story points (conservative for quality-focused sprint)
**Sprint Type**: Quality Assurance & Performance Optimization

### Sprint 7 Backlog (DEFERRED TO SPRINT 9)

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-053 | Optimize Dashboard Layout Query (JWT Caching) | 3 | P0 üî¥ | Epic 6: Quality | üìã To Do ‚Üí Sprint 8 Stretch |
| US-054 | Optimize Login API Response Time | 3 | P0 üî¥ | Epic 6: Quality | üìã Deferred to Sprint 9 |
| US-048 | Mobile Responsive Testing - All Features | 3 | P2 üü¢ | Epic 4: UX | üìã Deferred to Sprint 9 |
| US-049 | Subscription Status Ribbon Display | 2 | P2 üü¢ | Epic 4: UX | üìã Deferred to Sprint 9 |
| US-050 | Python API Monitoring & Alerting | 2 | P2 üü¢ | Epic 6: Quality | üìã Deferred to Sprint 9 |

**Total Story Points**: 15 planned
**Status**: Deferred due to critical employment income bug (US-072) discovered February 4, 2026

**Sprint 7 ‚Üí Sprint 8 Pivot**:
- **February 4, 2026**: Critical bug discovered (US-072)
  - User: Daniel Gonzalez (danjgonzalezm@gmail.com)
  - Issue: Employment income not counted before retirement
  - Evidence: Tax = $0 in 2026-2027 despite $200K employment
  - Impact: 1% success rate instead of 95%+
- **Decision**: Prioritize bug fix + user conversion over performance optimization
- **Rationale**: Simulation accuracy is fundamental; performance can wait
- **Sprint 7 Items**: Moved to Sprint 8 stretch (US-053) or Sprint 9 (US-054, US-048, US-049, US-050)

---

## üéØ Previous Sprint: Sprint 4 - January 30, 2026 (Completed in 1 day)

**Sprint Goal**: Complete Sprint 3 carryovers - Fix critical income timing bug and unblock onboarding

**Status**: ‚úÖ 100% Complete (8/9 pts delivered)

**Sprint Planning Date**: January 30, 2026
**Actual Duration**: 1 day (vs 7 days planned)
**Retrospective**: Sprint 4 completed ahead of schedule

### Sprint 4 Backlog

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-038 | Fix CPP/OAS Income Timing Bug | 8 | P0 üî¥ | Epic 4: UX | ‚úÖ Done |
| US-009 | Onboarding - Skip Real Estate Step | 1 (0 delivered) | P2 üü¢ | Epic 4: UX | ‚úÖ Done (Pre-existing) |

**Total Story Points**: 9 planned / 8 delivered (US-038: 8 pts)
**Completed**: 8 pts (100% of core work)
**Velocity**: 8 pts/day (exceptional)

**Sprint Board**: [SPRINT_4_BOARD.md](SPRINT_4_BOARD.md)

**Key Achievement**:
- ‚úÖ **US-038**: Fixed CPP/OAS income timing bug - Income table established as single source of truth
- ‚úÖ **US-009**: Pre-existing functionality (no development needed)

---

## üéØ Previous Sprint: Sprint 6 - February 1, 2026 (Completed in 1 day)

**Sprint Goal**: Quality & Bug-Free Experience - Fix critical bugs and baseline scenario issues

**Status**: ‚úÖ 100% Complete (11/16 pts delivered, 1 critical bug fixed, 1 investigated & deferred)

**Sprint Planning Date**: January 31, 2026
**Actual Duration**: 1 day (vs 14 days planned)
**Sprint Retrospective**: [SPRINT_6_VERIFICATION_REPORT.md](SPRINT_6_VERIFICATION_REPORT.md)

### Sprint 6 Backlog

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-047 | Fix Baseline Scenario Auto-Population | 3 | P0 üî¥ | Epic 4: UX | ‚úÖ Done |
| US-046 | Improve Low Success Rate Messaging | 8 | P0 üî¥ | Epic 4: UX | ‚úÖ Done + CRITICAL BUG FIXED |
| US-044 | Fix Cash Flow Gap Detection | 5 | P1 üü° | Epic 4: UX | ‚úÖ Investigated (Deferred to Sprint 7) |
| **US-052** | **Dual Simulation Limit System (Email + Daily)** | **5** | **P0 üî¥** | **Epic 10: Monetization** | **‚úÖ Done** |

**Total Story Points**: 21 planned / 16 delivered (US-047: 3, US-046: 8, US-052: 5)
**Completed**: 16 pts (100% of core commitment + monetization feature)
**Velocity**: 16 pts/day (exceptional)

**Sprint Board**: [SPRINT_6_BOARD.md](SPRINT_6_BOARD.md)
**Verification Report**: [SPRINT_6_VERIFICATION_REPORT.md](SPRINT_6_VERIFICATION_REPORT.md)
**Critical Bug Report**: [BUG_FIX_SUCCESS_RATE_DECIMAL.md](BUG_FIX_SUCCESS_RATE_DECIMAL.md)

**Key Achievements**:
- ‚úÖ **US-047**: Fixed baseline scenario auto-population (32/32 scenarios corrected)
  - Created `lib/utils/age.ts` with proper age calculation
  - Fixed age calculation (was off by up to 39 years)
  - Fixed province selection (was hardcoded to "ON")
  - Database migration: 100% success rate
- ‚úÖ **US-046**: Improved low success rate messaging (270-line modal component)
  - Created `lib/analysis/failureReasons.ts` with 5 failure types
  - Created `components/modals/LowSuccessRateWarning.tsx`
  - All 3 automated tests passing
  - **CRITICAL BUG FIXED**: Success rate decimal to percentage conversion
    - Backend returns 0.0-1.0 (decimal), not percentage
    - Bug caused 100% success simulations to show "1.0% success rate" warning
    - User reported contradiction: Modal shows 1.0%, simulation shows 100/100 health score
    - Fix: Multiply `success_rate` by 100 before comparison
    - Impact: CRITICAL - Users with perfect plans were seeing alarming failure warnings
- ‚úÖ **US-044**: Cash flow gap detection investigated
  - Created investigation scripts
  - Root cause identified: TFSA intentionally last in withdrawal strategies (by design)
  - Conclusion: UX issue, not critical bug
  - Deferred to Sprint 7 as messaging improvement (2-3 hours)
- ‚úÖ **US-052**: Dual Simulation Limit System implemented (freemium monetization)
  - **Limit 1**: Email verification - 3 free simulations for unverified users
  - **Limit 2**: Daily limit - 10 simulations/day for free tier users
  - **Premium**: Unlimited simulations (both limits bypassed)
  - Database: Added `freeSimulationsUsed`, `simulationRunsToday`, `simulationRunsDate` fields
  - Backend: 4 new functions in `lib/subscription.ts`
  - Frontend: Email verification banner + daily limit banner in simulation page
  - API: Sequential limit checks in `/api/simulation/run`
  - TypeScript: 0 compilation errors
  - Documentation: `DUAL_LIMIT_SYSTEM_COMPLETE.md`

**Testing Coverage**:
- Automated Tests: 3/3 passing (100%)
- Age Migration: 32/32 scenarios updated (100%)
- TypeScript Compilation: 0 errors
- Production Ready: ‚úÖ All changes deployed

**Quality Metrics**:
- ‚ùå NO type safety bypasses
- ‚ùå NO workarounds or shortcuts
- ‚ùå NO disabled tests
- ‚úÖ Complete implementation
- ‚úÖ Comprehensive testing
- ‚úÖ Production deployed

**Critical Bug Fix Details**:
- **Issue**: Low Success Rate Warning Modal showed on 100% success simulations
- **Root Cause**: Backend returns `success_rate` as decimal (0.0-1.0), code compared to 10
- **Example**: `success_rate: 1.0` (100%) triggered warning because `1.0 < 10`
- **Fix**: Convert decimal to percentage: `successRate = result.summary?.success_rate * 100`
- **Impact**: Fixed confusing/alarming warnings for users with perfect retirement plans
- **User Report**: Screenshots showed contradiction between modal (1.0%) and health score (100/100)

**Sprint 6 Priority Shift**:
- **Original Plan**: GIC Ladder integration (US-045: 5 pts)
- **User Direction**: "lower the priority related to the gic ladder we have more important activities"
- **User Focus**: "the major point is to have a quality and bug free application for retirement planning"
- **Result**: Shifted to P0/P1 quality bugs, delivered 100% in 1 day + critical bug fix

---

## üéØ Previous Sprint: Sprint 5 - January 31, 2026 (Completed in 3 days)

**Sprint Goal**: Advanced Retirement Planning Features - What-If Scenarios, LIRA Support, and GIC Ladder

**Status**: ‚úÖ 100% Complete (13/13 pts core commitment)

**Sprint Planning Date**: January 30, 2026
**Pre-Sprint Verification**: ‚úÖ Complete
**Actual Duration**: 3 days (vs 14 days planned)
**Retrospective**: [SPRINT_5_RETROSPECTIVE.md](SPRINT_5_RETROSPECTIVE.md)

### Sprint 5 Backlog

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-040 | What-If Sliders for Interactive Scenarios | 5 | P1 üü° | Epic 4: UX | ‚úÖ Done |
| US-041 | LIRA Account Support | 3 | P1 üü° | Epic 3: Investment | ‚úÖ Done |
| US-042 | Auto-Create Baseline Scenario After Onboarding | 2 | P2 üü¢ | Epic 4: UX | ‚úÖ Done |
| US-013 | GIC Ladder Planner Component | 3 | P2 üü¢ | Epic 3: Investment | ‚ö†Ô∏è Built (NOT Integrated) |

**Total Story Points**: 13 committed / 18 capacity (72% utilization)
**Completed**: 13 pts (100%) - All stories delivered in 3 days
**Velocity**: 4.3 pts/day (exceptional)

**Sprint Board**: [SPRINT_5_BOARD.md](SPRINT_5_BOARD.md)
**Technical Reference**: [docs/SPRINT_5_TECHNICAL_REFERENCE.md](webapp/docs/SPRINT_5_TECHNICAL_REFERENCE.md)
**Test Results**: [EARLY_RETIREMENT_TEST_RESULTS.md](webapp/EARLY_RETIREMENT_TEST_RESULTS.md)

**Key Achievements**:
- ‚úÖ **US-040**: What-If Sliders with 500ms debounce, auto-correction for CPP/OAS ages
- ‚úÖ **US-041**: LIRA balance column added to Scenario model, combined with RRSP for projections
- ‚úÖ **US-042**: Baseline scenario auto-creation from onboarding data
- ‚ö†Ô∏è **US-013**: GIC Ladder Planner component built (283 lines) and tested (26/26 tests passing) but **NOT integrated into any page**

**Testing Coverage**:
- Component Tests: 71/71 passing (100%)
- Early Retirement Scenarios: 64/65 passing (98.5%)
- Total Test Coverage: 135 automated tests

**Production Deployment**:
- Commit: `cfed2ac` - "feat: Complete Sprint 5 - Advanced Retirement Planning Features"
- Deployed: January 31, 2026
- Files Changed: 19 files, 6,030 insertions, 286 deletions

**Sprint 5 ‚Üí Sprint 6 Carryover**:
- US-013 GIC Ladder integration deferred to Sprint 6 (component exists but needs integration)
- Component is production-ready (tested, documented) but users cannot access it

---

## üéØ Previous Sprint: Sprint 3 - January 30 - February 12, 2026

**Sprint Goal**: Fix critical income timing bug, improve onboarding UX, and validate simulation accuracy based on user feedback

**Status**: ‚ö†Ô∏è 0% Complete (0/16 pts core) - All work pivoted to critical user issue

**Sprint Planning Date**: January 29, 2026 (Revised based on critical user feedback)
**Pre-Sprint Verification**: ‚úÖ Complete (AI-2.3 process followed)
**Retrospective**: [SPRINT_3_RETROSPECTIVE.md](SPRINT_3_RETROSPECTIVE.md)

### Sprint 3 Backlog

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-038 | Fix CPP/OAS Income Timing Bug | 8 | P0 üî¥ | Epic 4: UX | üîÑ Carried to Sprint 4 |
| US-009 | Onboarding - Skip Real Estate Step | 3 ‚Üí 1 | P2 üü¢ | Epic 4: UX | üîÑ Carried to Sprint 4 |
| US-039 | Pension Start Date Configuration | 5 | P1 üü° | Epic 4: UX | üìã Deferred to Sprint 5 |
| US-013 | RRIF Strategy Validation (Stretch) | 8 | P1 üü° | Epic 5: Simulation | üìã Deferred to Sprint 5 |
| US-003 | Database Migration - Pension Indexing (Stretch) | 3 | P1 üü° | Epic 1: Retention | üìã Deferred to Sprint 5 |

**Total Story Points**: 27 planned / 40 capacity (68% utilization)
**Core Commitment**: 16 pts (US-038, US-009, US-039)
**Stretch Goals**: 11 pts (US-013, US-003)
**Completed**: 0 pts (0%) - Work pivoted to critical GIC feature (8 pts ad-hoc work)

**Sprint Board**: [SPRINT_3_BOARD_REVISED.md](SPRINT_3_BOARD_REVISED.md)
**Pre-Planning Report**: [SPRINT_3_PRE_PLANNING_VERIFICATION.md](SPRINT_3_PRE_PLANNING_VERIFICATION.md)

**Sprint 3 ‚Üí Sprint 4 Carryover Rationale**:
- Sprint 3 ended with 0% completion due to critical user feedback requiring immediate response
- GIC Maturity Tracking (8 pts) completed ad-hoc outside sprint scope (user satisfaction 1/5)
- US-038 and US-009 carried to Sprint 4 (1-week focused sprint)
- US-039, US-013, US-003 deferred to Sprint 5 due to capacity constraints
- Sprint 4 planned conservatively (9 pts / 60% capacity) to ensure completion

**Ad-Hoc Work Completed (Outside Sprint Scope)**:
- ‚úÖ **GIC Maturity Tracking** - 8 story points completed Jan 29-30, 2026
  - Phase 2: Python backend processing (5 pts) - Commit `06afdac`
  - Phase 3: Frontend GIC form with privacy protections (2 pts) - Commit `3a0e049`
  - Status: Deployed to production at www.retirezest.com/profile/assets
  - Documentation: [SPRINT_3_GIC_COMPLETION_UPDATE.md](SPRINT_3_GIC_COMPLETION_UPDATE.md)
  - User Response: Email sent to rightfooty218@gmail.com about GIC feature
  - Note: NOT counted toward Sprint 3 velocity (completed outside sprint tracking)

**Key Focus Areas**:
- üî¥ Critical: Fix CPP/OAS income timing bug (user satisfaction: 1/5) (US-038)
- üü¢ Quick Win: Unblock 12 users stuck at Step 6 onboarding (US-009)
- üü° Enhancement: Add pension start date configuration (US-039)
- üìä Stretch: Validate RRIF strategies against CRA rules (US-013)
- üìä Stretch: Finish pension indexing backend (US-003)

**Key Learnings from Sprint 2 Applied**:
- ‚úÖ Pre-sprint verification prevents duplicate work (AI-2.3)
- ‚úÖ Small stories (1-3 pts) have higher success rate
- ‚úÖ Conservative planning (60% capacity = 16 pts core)
- ‚úÖ Git history check is CRITICAL before starting work (AI-2.1)
- ‚úÖ Update backlog immediately after story completion (AI-2.2)

---

## üéØ Previous Sprint: Sprint 2 - Complete! ‚úÖ

**Sprint Goal**: Enable premium monetization and improve withdrawal strategy UX to reduce user churn

### Sprint 2 Backlog

| ID | User Story | Story Points | Priority | Epic | Status |
|----|------------|--------------|----------|------|--------|
| US-024 | Premium Account Verification & Payment Testing | 8 | P0 üî¥ | Epic 9: Monetization | ‚úÖ Done |
| BUILD-FIX | Fix Build Warnings & Vulnerabilities | 2 | P1 üü° | Epic 6: Testing | ‚úÖ Done |
| US-025 | Improve Withdrawal Strategy Discoverability | 3 | P1 üü° | Epic 4: UX | ‚úÖ Done |
| US-026 | Display Current Strategy Selection | 2 | P1 üü° | Epic 4: UX | ‚úÖ Done |
| US-029 | Fix Default Withdrawal Strategy | 1 | P0 üî¥ | Epic 4: UX | ‚úÖ Done |
| US-022 | What-If Scenario Slider Testing & Fixes | 5 | P1 üü° | Epic 6: Testing | ‚úÖ Done |
| US-027 | Educational Guidance - Withdrawal Order | 5 | P1 üü° | Epic 4: UX | üìã To Do |
| US-009 | Onboarding - Skip Real Estate Step | 3 | P2 üü¢ | Epic 4: UX | ‚úÖ Done (Pre-existing) |
| US-021 | Configurable Investment Yields | 8 | P1 üü° | Epic 3: Investment | üìã Deferred |

**Total Story Points**: 20 committed / 40 capacity (50% utilization - conservative sprint)
**Completed**: 21 pts (105%!) - BUILD-FIX (2), US-024 (8), US-025 (3), US-026 (2), US-029 (1), US-022 (5)
**Note**: US-022 completed on Jan 29, 2026 (commit 2487294) but discovered during Sprint 3 planning
**Estimated Velocity**: Will be based on Sprint 1 completion

**Sprint Board**: [SPRINT_2_BOARD.md](SPRINT_2_BOARD.md)

**Key Focus Areas**:
- ‚úÖ Revenue: Verify premium subscription system works (US-024)
- ‚úÖ User Control: Allow custom investment return assumptions (US-021)
- ‚úÖ Churn Prevention: Make withdrawal strategies more discoverable (US-025, US-026, US-027)
- ‚úÖ Quality: Ensure What-If scenarios work correctly (US-022)
- ‚úÖ Onboarding: Remove friction for users without real estate (US-009)

---

## üìö Product Backlog

### High Priority (Next 1-2 Sprints)

#### Epic 1: User Retention & Engagement

**Context**: February 3, 2026 analysis revealed critical conversion funnel issue: 20 users entered $24.4M in assets but ran ZERO simulations. Root causes: (1) Simulation button disabled bug (fixed Feb 1), (2) Poor UX/onboarding. See [USER_CONVERSION_ANALYSIS_FEBRUARY_2026.md](USER_CONVERSION_ANALYSIS_FEBRUARY_2026.md) for full analysis.

**Goal**: Increase simulation conversion from 0-20% to 80-90% through UX improvements and re-engagement.

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-066** | **Make "Run Simulation" Button Prominent and Impossible to Miss** | **2** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a user who has entered my assets and created a scenario, I want the "Run Simulation" button to be prominent and obvious so that I know exactly how to see my retirement projection |
| **Acceptance Criteria** | - [ ] Button size increased 2x (large size)<br>- [ ] Vibrant gradient background (blue-500 to blue-600)<br>- [ ] Positioned at top of page (above the fold)<br>- [ ] Clear label: "üöÄ Run Your Retirement Simulation"<br>- [ ] Subtle pulsing animation for first-time users<br>- [ ] Hover effect: scale + shadow increase<br>- [ ] Mobile-responsive (full width on mobile) |
| **Tasks** | - [ ] Update button size and styling in simulation/page.tsx<br>- [ ] Add gradient background class<br>- [ ] Position button above all other content<br>- [ ] Add Lucide icon (Rocket) to button<br>- [ ] Implement CSS animation (pulse-once for first-time users)<br>- [ ] Add hover state with transform and shadow<br>- [ ] Test on mobile devices (iPhone, Android)<br>- [ ] Update button in mobile layout (full width) |
| **Technical Notes** | **Current Location**: `webapp/app/(dashboard)/simulation/page.tsx` line ~1165<br><br>**BEFORE**:<br>```tsx<br><button className="px-4 py-2 bg-blue-600 text-white rounded"><br>  Run Simulation<br></button><br>```<br><br>**AFTER**:<br>```tsx<br><button className="px-8 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xl font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all animate-pulse-once"><br>  <Rocket className="w-6 h-6 inline mr-2" /><br>  Run Your Retirement Simulation<br></button><br>```<br><br>**Add to tailwind.config.js**:<br>```js<br>animation: {<br>  'pulse-once': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) 3',<br>}<br>``` |
| **User Impact** | **CRITICAL** - Without prominent button, users don't know where to click. This is the #1 blocker preventing users from seeing value. 20 users with $24.4M in assets couldn't figure out how to run simulations. |
| **Priority Justification** | P0 because:<br>1. **Highest impact fix** - Directly addresses #1 user confusion point<br>2. **Quick implementation** - 2 hours, pure CSS/HTML changes<br>3. **Zero risk** - No logic changes, just styling<br>4. **Immediate ROI** - Unblocks 19 active users ($20.6M assets) |
| **Success Metrics** | - [ ] Button click rate increases from unknown to >95%<br>- [ ] Simulation conversion increases from 0% to >80%<br>- [ ] User feedback: "Easy to find button" in surveys |
| **Related Stories** | - US-067 (Post-onboarding redirect) - Directs users to this page<br>- US-068 (Empty state) - Reinforces need to click this button |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-067** | **Add Post-Onboarding Redirect and Welcome Modal** | **2** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a new user who just completed onboarding, I want to be automatically taken to the simulation page with clear guidance on what to do next so that I can immediately run my first simulation |
| **Acceptance Criteria** | - [ ] After creating baseline scenario, redirect to `/simulation?welcome=true`<br>- [ ] Show welcome modal on first visit (check localStorage)<br>- [ ] Modal explains: "Click Run Simulation to see your projection"<br>- [ ] Arrow graphic pointing to button<br>- [ ] Dismissible with "Got it!" button<br>- [ ] Modal doesn't show again after dismissal<br>- [ ] Optional tooltip pointing to button (for users who dismiss modal) |
| **Tasks** | - [ ] Add redirect after scenario creation: `router.push('/simulation?welcome=true')`<br>- [ ] Create WelcomeModal component<br>- [ ] Add modal trigger based on URL param `?welcome=true`<br>- [ ] Check localStorage for `welcome_modal_seen: true`<br>- [ ] Design modal content (heading, explanation, arrow graphic)<br>- [ ] Implement arrow SVG pointing down to button<br>- [ ] Add "Got it!" dismiss button<br>- [ ] Set localStorage on dismiss<br>- [ ] Add fallback tooltip if modal dismissed too quickly<br>- [ ] Test on mobile and desktop |
| **Technical Notes** | **Files to Modify**:<br>1. `webapp/app/onboarding/page.tsx` - Add redirect after scenario creation<br>2. `webapp/app/(dashboard)/simulation/page.tsx` - Add welcome modal<br>3. `webapp/components/WelcomeModal.tsx` - New component<br><br>**Redirect Logic**:<br>```tsx<br>// onboarding/page.tsx<br>const handleComplete = async () => {<br>  await createBaselineScenario();<br>  router.push('/simulation?welcome=true');<br>};<br>```<br><br>**Modal Logic**:<br>```tsx<br>// simulation/page.tsx<br>const [showWelcome, setShowWelcome] = useState(false);<br><br>useEffect(() => {<br>  const params = new URLSearchParams(window.location.search);<br>  const isWelcome = params.get('welcome') === 'true';<br>  const seen = localStorage.getItem('welcome_modal_seen');<br>  <br>  if (isWelcome && !seen) {<br>    setShowWelcome(true);<br>  }<br>}, []);<br><br>const handleDismiss = () => {<br>  localStorage.setItem('welcome_modal_seen', 'true');<br>  setShowWelcome(false);<br>};<br>``` |
| **User Impact** | **HIGH** - Guides users to next step immediately after onboarding. Prevents confusion about "what do I do now?". Increases likelihood of running first simulation. |
| **Priority Justification** | P0 because:<br>1. **Smooth onboarding** - Seamless transition from setup to action<br>2. **Prevents drop-off** - 80% of affected users created scenarios but didn't simulate<br>3. **Quick win** - 2 hours implementation<br>4. **Complements US-066** - Directs users to prominent button |
| **Success Metrics** | - [ ] 90%+ of new users who complete onboarding run simulation within 5 minutes<br>- [ ] Modal shown to 100% of first-time users<br>- [ ] Modal dismissed within 10 seconds on average<br>- [ ] Simulation conversion increases from 0% to >80% |
| **Related Stories** | - US-066 (Prominent button) - Modal points to this button<br>- US-068 (Empty state) - Alternative path if user dismisses modal |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-068** | **Add Empty State on Results Tab** | **1** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a user who clicks the "Results" tab before running a simulation, I want to see a helpful empty state that tells me what to do so that I understand I need to run a simulation first |
| **Acceptance Criteria** | - [ ] Empty state shown when no simulation results exist<br>- [ ] Large icon (üìä) and clear heading<br>- [ ] Explanation: "Click Run Simulation to see your projection"<br>- [ ] Arrow pointing up to button location<br>- [ ] Call-to-action button: "Run My First Simulation"<br>- [ ] Mobile-friendly layout |
| **Tasks** | - [ ] Update ResultsDashboard component<br>- [ ] Add conditional rendering: if (!simulationResults) show empty state<br>- [ ] Design empty state layout (centered, icon, text, CTA)<br>- [ ] Add Chart icon from Lucide (large, 96x96)<br>- [ ] Add heading: "No simulation results yet"<br>- [ ] Add explanation text<br>- [ ] Add arrow SVG pointing up/left to button<br>- [ ] Add CTA button that scrolls to Run Simulation button<br>- [ ] Test on mobile (ensure arrow/text makes sense)<br>- [ ] Test with screen readers (accessibility) |
| **Technical Notes** | **File**: `webapp/components/simulation/ResultsDashboard.tsx`<br><br>**Implementation**:<br>```tsx<br>export function ResultsDashboard({ results }) {<br>  if (!results) {<br>    return (<br>      <div className="flex flex-col items-center justify-center py-20 text-center px-4"><br>        <BarChart3 className="w-24 h-24 text-gray-300 mb-6" /><br>        <h3 className="text-2xl font-bold text-gray-900 mb-2"><br>          No simulation results yet<br>        </h3><br>        <p className="text-gray-600 mb-6 max-w-md"><br>          Click "Run Simulation" to see your personalized retirement<br>          projection, year-by-year cash flow, and tax-optimized<br>          withdrawal strategy.<br>        </p><br>        <div className="flex items-center gap-2 text-blue-600"><br>          <ArrowUp className="w-5 h-5" /><br>          <span className="font-medium">Click "Run Simulation" above</span><br>        </div><br>        <Button<br>          onClick={() => {<br>            document.getElementById('run-simulation-btn')?.scrollIntoView({<br>              behavior: 'smooth',<br>              block: 'center'<br>            });<br>          }}<br>          className="mt-6"<br>        ><br>          Run My First Simulation<br>        </Button><br>      </div><br>    );<br>  }<br>  <br>  // Normal results display<br>  return ( ... );<br>}<br>``` |
| **User Impact** | **HIGH** - Prevents confusion when users click Results tab expecting to see data. Common user behavior: "Where are my results?" Empty state guides them to action. |
| **Priority Justification** | P0 because:<br>1. **Prevents confusion** - Users naturally click Results first<br>2. **Quick implementation** - 1 hour, single component change<br>3. **Zero risk** - Only affects empty state (doesn't break existing functionality)<br>4. **Reinforces US-066** - Multiple paths to same action |
| **Success Metrics** | - [ ] Empty state shown to 100% of users who visit Results before running simulation<br>- [ ] CTA button click rate >80%<br>- [ ] Reduction in "where are my results?" support tickets<br>- [ ] Simulation conversion increases (contributes to overall 80% target) |
| **Related Stories** | - US-066 (Prominent button) - Empty state points to this<br>- US-067 (Welcome modal) - Alternative onboarding path |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-069** | **Add Simulation Validation with Clear Error Messages** | **2** | **P1** üü° | **üìã To Do** |
| **Description** | As a user attempting to run a simulation, I want to see clear validation errors if I'm missing required data so that I know exactly what to fix |
| **Acceptance Criteria** | - [ ] Validate before running simulation<br>- [ ] Show red alert with specific errors (bulleted list)<br>- [ ] "Fix these issues" button links to relevant input tab<br>- [ ] Button disabled with tooltip if validation fails<br>- [ ] Help text explains common mistakes |
| **Validation Rules** | - At least 1 asset OR 1 income source<br>- Retirement age >= current age<br>- Life expectancy > retirement age<br>- CPP start age valid (60-70)<br>- OAS start age valid (65-70) |
| **User Impact** | **MEDIUM** - Prevents silent failures, helps users understand what data is missing. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-070** | **Improve Simulation Loading State** | **1** | **P1** üü° | **üìã To Do** |
| **Description** | As a user running a simulation, I want to see progressive loading messages and a progress bar so that I know the system is working |
| **Acceptance Criteria** | - [ ] Replace generic "Loading..." with stages<br>- [ ] Progress bar (0% ‚Üí 100%)<br>- [ ] Estimated time remaining<br>- [ ] 30-second timeout with error message<br>- [ ] Mobile-friendly design |
| **User Impact** | **MEDIUM** - Reduces perceived wait time, prevents users from thinking page is frozen. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-071** | **Re-engagement Email Campaign for Users with Assets but No Simulations** | **2** | **P0** üî¥ | **üìã To Do** |
| **Description** | As the product owner, I want to send re-engagement emails to users who loaded assets but never ran simulations so that we can recover these high-value users and prevent churn |
| **Acceptance Criteria** | - [ ] Query database for users: assets > 0, scenarios = 0<br>- [ ] Personalized email with actual asset amount<br>- [ ] Clear CTA: Link to /simulation page<br>- [ ] Explain what they'll see (benefits)<br>- [ ] Track email opens and clicks<br>- [ ] Track simulation runs within 48 hours<br>- [ ] Success metric: 60%+ run simulations (12/19 users) |
| **Tasks** | - [ ] Query database: `SELECT id, email, COUNT(assets) FROM User WHERE assets > 0 AND scenarios = 0`<br>- [ ] Create email template (personalized with asset amount)<br>- [ ] Send via Resend API (batch email)<br>- [ ] Add tracking links (UTM params)<br>- [ ] Monitor opens/clicks in Resend dashboard<br>- [ ] Query simulation runs 48 hours after send<br>- [ ] Document results in report |
| **Technical Notes** | **Target**: 19 active users with $20.6M in assets<br><br>**Email Subject**: "Your retirement plan is 90% complete - one click away!"<br><br>**Email Body Template**:<br>```<br>Hi [First Name],<br><br>I noticed you loaded $[X] in assets into RetireZest (thank you!),<br>but you haven't run your retirement simulation yet.<br><br>Good news: You're just ONE CLICK away from seeing your<br>personalized retirement projection.<br><br>‚Üí [Run My Simulation]<br><br>What you'll see:<br>‚úÖ Year-by-year cash flow through retirement<br>‚úÖ Tax-optimized withdrawal strategy  <br>‚úÖ Success probability (will your money last?)<br>‚úÖ GIS/OAS benefit optimization<br><br>Questions? Hit reply - I'm here to help.<br><br>- [Product Owner Name]<br>```<br><br>**Implementation**:<br>```typescript<br>// Query users<br>const users = await prisma.user.findMany({<br>  where: {<br>    assets: { some: {} },<br>    scenarios: { none: {} }<br>  },<br>  include: {<br>    assets: { select: { balance: true } }<br>  }<br>});<br><br>// Calculate total assets<br>users.forEach(user => {<br>  const totalAssets = user.assets.reduce((sum, a) => sum + a.balance, 0);<br>  <br>  // Send personalized email<br>  await sendEmail({<br>    to: user.email,<br>    subject: "Your retirement plan is 90% complete",<br>    template: 'reengagement-simulation',<br>    data: {<br>      firstName: user.email.split('@')[0],<br>      totalAssets: formatCurrency(totalAssets),<br>      simulationUrl: `https://retirezest.com/simulation?utm_source=email&utm_campaign=reengagement`<br>    }<br>  });<br>});<br>``` |
| **User Impact** | **CRITICAL** - Potential to recover 19 users with $20.6M in assets. Prevents churn, demonstrates product value, generates word-of-mouth. High-value users most likely to convert to premium. |
| **Priority Justification** | P0 because:<br>1. **Immediate revenue impact** - Prevent $432-$1,000/year churn<br>2. **High conversion potential** - Users already invested time loading data<br>3. **Quick execution** - 2 hours to send emails<br>4. **Demonstrates care** - Personal outreach shows we value users<br>5. **Data-driven** - Can measure exact ROI (opens, clicks, simulations) |
| **Success Metrics** | - [ ] Email sent to 19 users (100%)<br>- [ ] Open rate: 60%+ (12/19 users)<br>- [ ] Click rate: 40%+ (8/19 users)<br>- [ ] **Simulation conversion: 60%+ (12/19 users)**<br>- [ ] Response rate (replies): 10%+ (2/19 users)<br>- [ ] Zero unsubscribes or spam reports |
| **Related Stories** | - US-066, US-067, US-068 (UX fixes that make email successful)<br>- US-001 (Previous re-engagement campaign - apply learnings) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-001** | **Monitor Re-engagement Campaign** | **3** | **P0** | **‚úÖ Done** |
| **Description** | As a product manager, I want to monitor the re-engagement email campaign results so that I can measure the effectiveness of our user recovery efforts |
| **Acceptance Criteria** | - [ ] Resend dashboard checked daily for opens/clicks<br>- [ ] Database queried for user logins<br>- [x] Email delivery confirmed (4/4 sent)<br>- [ ] Week 1 metrics documented |
| **Tasks** | - [x] Check Resend dashboard<br>- [ ] Run query_deleted_users.js daily<br>- [ ] Document open rates<br>- [ ] Document click rates<br>- [ ] Count reactivations |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-002** | **Track User Reactivations** | **5** | **P0** | **üîÑ In Progress** |
| **Description** | As a product manager, I want to automatically track which deleted users reactivate their accounts so that I can measure campaign ROI |
| **Acceptance Criteria** | - [ ] Automated script checks for logins after email sent<br>- [ ] Dashboard shows reactivation status by user<br>- [ ] Conversion rate calculated automatically<br>- [ ] Results logged for future analysis |
| **Tasks** | - [x] Create query_deleted_users.js script<br>- [ ] Add reactivation tracking logic<br>- [ ] Create weekly report automation<br>- [ ] Build simple dashboard view |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-003** | **Database Migration - Pension Indexing** | **8** | **P1** | **üìã To Do** |
| **Description** | As a user, I want my pension indexing checkbox selection to be saved so that my retirement projections are accurate over time |
| **Acceptance Criteria** | - [ ] Prisma schema updated with inflationIndexed field<br>- [ ] Migration runs successfully in production<br>- [ ] API routes save/retrieve inflationIndexed value<br>- [ ] Existing pensions default to true<br>- [ ] UI checkbox state persists after save |
| **Tasks** | - [ ] Update Prisma schema<br>- [ ] Create migration file<br>- [ ] Test migration locally<br>- [ ] Update API routes (create, update, read)<br>- [ ] Test end-to-end flow<br>- [ ] Deploy to production |
| **Technical Notes** | Frontend already implemented in commit 997c924. Only backend persistence needed. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-004** | **Fix Resend Email ID Tracking** | **2** | **P2** | **üìã To Do** |
| **Description** | As a developer, I want to properly capture Resend email IDs so that I can track individual email delivery and status |
| **Acceptance Criteria** | - [ ] Email IDs properly extracted from Resend API response<br>- [ ] IDs logged to database or file<br>- [ ] Can query email status by ID<br>- [ ] Documentation updated with correct API usage |
| **Tasks** | - [ ] Debug Resend API response format<br>- [ ] Update send_reengagement_emails.js<br>- [ ] Test email sending<br>- [ ] Verify ID capture<br>- [ ] Update documentation |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-005** | **Admin Dashboard - Deletion Analytics** | **13** | **P2** | **üìã Backlog** |
| **Description** | As a product manager, I want a dashboard showing deletion trends and reasons so that I can proactively identify and fix UX issues |
| **Acceptance Criteria** | - [ ] Dashboard shows deletion rate over time<br>- [ ] Chart displays deletion reasons breakdown<br>- [ ] Metrics show same-day deletion rate<br>- [ ] Compare before/after UX fixes<br>- [ ] Export data to CSV |
| **Tasks** | - [ ] Design dashboard UI mockup<br>- [ ] Create API endpoints for metrics<br>- [ ] Build chart components<br>- [ ] Add filters (date range, reason)<br>- [ ] Implement CSV export<br>- [ ] Add access control (admin only) |

---

#### Epic 2: French Language Support

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-006** | **French Translation - Core App** | **21** | **P3** | **üìã Backlog** |
| **Description** | As a French-speaking Canadian user, I want to use RetireZest in French so that I can comfortably plan my retirement in my native language |
| **Acceptance Criteria** | - [ ] All UI text translated to French<br>- [ ] Language toggle in settings<br>- [ ] User preference saved<br>- [ ] Email templates in French<br>- [ ] Documentation in French |
| **Tasks** | - [ ] Audit all UI strings<br>- [ ] Set up i18n framework (next-i18next)<br>- [ ] Create translation files<br>- [ ] Hire/contract translator<br>- [ ] Translate all strings<br>- [ ] Add language selector<br>- [ ] Test all pages in French<br>- [ ] Update onboarding flow |
| **Impact** | Could recover Maurice Poitras + 22% of Canadian market (Quebec) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-007** | **Quebec Tax Rules** | **13** | **P3** | **üìã Backlog** |
| **Description** | As a Quebec resident, I want accurate tax calculations using Quebec provincial tax rates so that my retirement projections are realistic |
| **Acceptance Criteria** | - [ ] Quebec tax brackets implemented<br>- [ ] QPP (Quebec Pension Plan) vs CPP calculations<br>- [ ] Provincial credits calculated correctly<br>- [ ] Tax forms reference Quebec tax system<br>- [ ] Validation against Revenu Qu√©bec |
| **Tasks** | - [ ] Research Quebec tax rates<br>- [ ] Implement Quebec tax calculation<br>- [ ] Add province selector to profile<br>- [ ] Update simulation engine<br>- [ ] Test with Quebec scenarios<br>- [ ] Validate against official calculators |

---

---

#### Epic 3: Investment & Account Configuration

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-045** | **Integrate GIC Ladder Planner into Assets Page** | **5** | **P1** | **üìã Sprint 6** |
| **Description** | As a user, I want to access the GIC Ladder Planner from my Assets page so that I can create and manage staggered GIC investments for liquidity and returns |
| **Acceptance Criteria** | - [ ] GIC Ladder Planner component integrated into Assets page<br>- [ ] Accessible via tab or section on `/profile/assets`<br>- [ ] Component renders correctly with all features<br>- [ ] Generate ladder functionality works<br>- [ ] Add/remove/edit rung functionality works<br>- [ ] Statistics display correctly (weighted avg rate, avg maturity, total invested)<br>- [ ] Mobile responsive design<br>- [ ] Help text explains GIC ladder strategy |
| **Tasks** | - [ ] Import GICLadderPlanner component into assets page<br>- [ ] Create new tab or section for GIC Ladder<br>- [ ] Add navigation/routing<br>- [ ] Test ladder generation<br>- [ ] Test statistics calculations<br>- [ ] Test on mobile devices<br>- [ ] Add help documentation<br>- [ ] Update user guide |
| **Technical Notes** | Component already built: `/webapp/components/assets/GICLadderPlanner.tsx` (283 lines)<br>Tests already passing: 26/26 (100%)<br>Just needs integration into page |
| **User Impact** | High - Users can plan GIC ladder strategies for retirement income |
| **Sprint** | Sprint 6 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-046** | **Mobile Responsive Testing - Early Retirement** | **3** | **P2** | **üìã Sprint 6** |
| **Description** | As a mobile user, I want the early retirement page to work perfectly on my phone so that I can plan retirement on the go |
| **Acceptance Criteria** | - [ ] What-If Sliders work on mobile (touch-friendly)<br>- [ ] Early retirement form is mobile-responsive<br>- [ ] Results display correctly on small screens<br>- [ ] No horizontal scrolling<br>- [ ] Touch targets are large enough (min 44px)<br>- [ ] Text is readable without zooming<br>- [ ] Tested on iOS Safari and Android Chrome |
| **Tasks** | - [ ] Test early retirement page on iPhone<br>- [ ] Test early retirement page on Android<br>- [ ] Fix any responsive issues<br>- [ ] Verify What-If Sliders work with touch<br>- [ ] Check form layout on mobile<br>- [ ] Verify results table scrolls properly<br>- [ ] Document mobile testing results |
| **Technical Notes** | Components to test:<br>- `/webapp/app/(dashboard)/early-retirement/page.tsx`<br>- `/webapp/components/early-retirement/WhatIfSliders.tsx`<br>Tailwind CSS responsive classes should handle most cases |
| **User Impact** | Medium - Ensures mobile users have good experience |
| **Sprint** | Sprint 6 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-047** | **GIC Ladder Database Integration** | **2** | **P2** | **üìã Sprint 6** |
| **Description** | As a user, I want my GIC ladder plans to be saved in my account so that I can revisit and update them later |
| **Acceptance Criteria** | - [ ] Create GICLadder model in Prisma schema<br>- [ ] API endpoints for create/read/update/delete<br>- [ ] Save ladder to database when user clicks "Save"<br>- [ ] Load saved ladders on page load<br>- [ ] Display list of saved ladders<br>- [ ] Allow editing/deleting saved ladders<br>- [ ] Ladders associated with user account |
| **Tasks** | - [ ] Update Prisma schema with GICLadder model<br>- [ ] Create database migration<br>- [ ] Create API route: `/api/gic-ladder/`<br>- [ ] Add save functionality to component<br>- [ ] Add load functionality<br>- [ ] Add list/edit/delete UI<br>- [ ] Test CRUD operations<br>- [ ] Deploy migration |
| **Technical Notes** | **Prisma Schema:**<br>```prisma<br>model GICLadder {<br>  id String @id @default(cuid())<br>  userId String<br>  user User @relation(fields: [userId], references: [id], onDelete: Cascade)<br>  name String<br>  totalInvestment Float<br>  rungs Json // Array of GICRung objects<br>  createdAt DateTime @default(now())<br>  updatedAt DateTime @updatedAt<br>}<br>```<br><br>**API Routes:**<br>- POST `/api/gic-ladder` - Create new ladder<br>- GET `/api/gic-ladder` - Get user's ladders<br>- PUT `/api/gic-ladder/[id]` - Update ladder<br>- DELETE `/api/gic-ladder/[id]` - Delete ladder |
| **User Impact** | Medium - Allows users to save and manage ladder plans |
| **Sprint** | Sprint 6 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-021** | **Configurable Investment Yields (TFSA/RRSP/RRIF)** | **8** | **P1** | **üìã To Do** |
| **Description** | As a user, I want to configure custom interest rates for my TFSA, RRSP, and RRIF accounts so that my retirement projections reflect my actual investment strategy and risk tolerance |
| **Acceptance Criteria** | - [ ] UI allows setting yield % for TFSA accounts<br>- [ ] UI allows setting yield % for RRSP accounts<br>- [ ] UI allows setting yield % for RRIF accounts<br>- [ ] Default yields pre-populated (e.g., 5% balanced portfolio)<br>- [ ] Yields saved per account type<br>- [ ] Simulation engine uses custom yields<br>- [ ] Validation: yields between -10% and 20%<br>- [ ] Help text explains conservative vs aggressive yields |
| **Tasks** | - [ ] Add yield fields to Asset model (Prisma schema)<br>- [ ] Update database migration<br>- [ ] Add yield input fields to asset forms<br>- [ ] Implement yield validation (range check)<br>- [ ] Update simulation.py to use custom yields<br>- [ ] Add yield presets (Conservative 3%, Balanced 5%, Aggressive 7%)<br>- [ ] Create help documentation explaining yields<br>- [ ] Test with different yield scenarios<br>- [ ] Update API routes (create/update assets) |
| **Technical Notes** | Current system uses hardcoded 5% default. Need to make it configurable per account. |
| **User Impact** | High - Users want control over return assumptions. Different users have different risk profiles. |
| **Examples** | - Conservative investor: TFSA 3%, RRSP 3%, RRIF 3%<br>- Balanced investor: TFSA 5%, RRSP 5%, RRIF 5%<br>- Aggressive investor: TFSA 7%, RRSP 7%, RRIF 7%<br>- Mixed strategy: TFSA 6% (stocks), RRSP 4% (bonds), RRIF 4% (conservative) |

---

#### Epic 11: Comprehensive Asset, Income & Expense Coverage

**Goal**: Ensure RetireZest supports all major Canadian retirement assets, income sources, and expense categories for complete retirement planning.

**Background**: Review completed February 3, 2026 identified 13 missing categories across assets (5), income (6), and expenses (2). See [ASSET_INCOME_EXPENSE_CATEGORIES_REVIEW.md](ASSET_INCOME_EXPENSE_CATEGORIES_REVIEW.md) for full analysis.

**Key Deliverables**:
1. LIF/LRIF asset types and automatic LIRA conversion tracking (age 71)
2. Annuity assets and guaranteed income modeling
3. Investment income tax type differentiation (dividend/interest/capital gains)
4. Long-term care expense planning ($6K-$20K/month in Canada)
5. Home care expense modeling (alternative to LTC facilities)
6. DPSP asset type for historical employer plan balances

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-060** | **Add LIF/LRIF Asset Types and Conversion Tracking** | **8** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a user with a LIRA, I want the system to automatically track when my LIRA converts to a LIF/LRIF at age 71 and apply correct minimum/maximum withdrawal rules so my retirement projections are accurate |
| **Acceptance Criteria** | - [ ] Add "lif", "lrif", "rlif" asset types to schema<br>- [ ] Add LIF-specific fields (min/max withdrawal, province, unlock rules)<br>- [ ] Simulation automatically converts LIRA ‚Üí LIF at age 71<br>- [ ] Apply provincial LIF withdrawal rules (BC, SK, MB, federal)<br>- [ ] Support NS unlocking rule (50% at age 55+ as of 2025)<br>- [ ] Display LIF conversion in investment timeline<br>- [ ] Year-by-year table shows LIF min/max withdrawals |
| **Tasks** | - [ ] Update Prisma schema: Add lifMinWithdrawal, lifMaxWithdrawal, lifProvince, lifUnlockAmount fields<br>- [ ] Create database migration<br>- [ ] Update Python backend to convert LIRA ‚Üí LIF at age 71<br>- [ ] Implement provincial LIF rules (BC, SK, MB different from federal RLIF)<br>- [ ] Implement NS unlocking (50% at 55+ since April 2025)<br>- [ ] Update assets page UI to show LIF/LRIF options<br>- [ ] Add LIF conversion to InvestmentTimeline component (US-040)<br>- [ ] Test with user rightfooty218@gmail.com (has LIRA, age 67)<br>- [ ] Update documentation |
| **Technical Notes** | **2025 Regulatory Update**: Nova Scotia allows 55+ to unlock 50% when transferring LIRA to LIF (effective April 1, 2025)<br><br>**Provincial Variations**:<br>- BC, SK, MB: LIF with province-specific min/max rules<br>- Federal: RLIF (Restricted LIF) - more restrictive<br>- ON: LIF phased out in 2008, now use LRIF<br><br>**Schema Changes**:<br>```prisma<br>model Asset {<br>  type String // add: lif, lrif, rlif<br>  lifMinWithdrawal Float?<br>  lifMaxWithdrawal Float?<br>  lifProvince String?<br>  lifUnlockAmount Float?<br>}<br>```<br><br>**Backend Logic**:<br>At age 71, convert LIRA ‚Üí LIF/LRIF:<br>- Check province for LIF type<br>- Apply min withdrawal (like RRIF)<br>- Apply max withdrawal (unique to LIF)<br>- Allow unlocking if eligible (NS only) |
| **User Impact** | **CRITICAL** - ~15% of users have LIRAs. They don't know when it converts to LIF/LRIF (age 71) or that there are maximum withdrawal limits. User rightfooty218@gmail.com specifically asked about "end date for investments" - LIF conversion is part of this. |
| **Related Stories** | - US-040 (Investment Timeline) - Shows LIF conversion at age 71<br>- US-041 (LIRA Support) - Completed in Sprint 5 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-061** | **Add Annuity Asset Type and Income Tracking** | **5** | **P1** üü° | **üìã To Do** |
| **Description** | As a retiree who converted my RRSP to an annuity, I want to track my annuity asset and guaranteed income payments so my retirement plan reflects this income source |
| **Acceptance Criteria** | - [ ] Add "annuity" asset type to schema<br>- [ ] Add annuity-specific fields (type, start date, payment, indexed, guarantee)<br>- [ ] Support annuity types: term, life, joint-life, variable<br>- [ ] Link annuity asset to annuity income (auto-create income stream)<br>- [ ] Apply correct tax treatment (portion is return of capital, non-taxable)<br>- [ ] Display annuity guarantee period and payments in results<br>- [ ] Support inflation-indexed annuities<br>- [ ] Help text explains annuity types and trade-offs |
| **Tasks** | - [ ] Update Prisma schema: Add annuityType, annuityStartDate, annuityEndDate, annuityPayment, annuityIndexed, annuityGuarantee fields<br>- [ ] Create database migration<br>- [ ] Update assets page UI to show annuity option and form fields<br>- [ ] Add "annuity" income type to Income model<br>- [ ] Backend: Auto-create annuity income when annuity asset is added<br>- [ ] Implement tax treatment (return of capital portion non-taxable)<br>- [ ] Create educational content: "Should I convert my RRSP to an annuity?"<br>- [ ] Test with term annuity (10-year guarantee)<br>- [ ] Test with life annuity (no end date)<br>- [ ] Test with joint-life annuity (survives to spouse)<br>- [ ] Update documentation |
| **Technical Notes** | **Annuity Types**:<br>1. **Term Annuity**: Fixed payments for specific period (e.g., 10 years)<br>2. **Life Annuity**: Payments until death (no estate value)<br>3. **Joint-Life**: Payments until both spouses pass<br>4. **Variable Annuity**: Payments vary with investment performance<br><br>**Tax Treatment**: Complex - portion of each payment is non-taxable return of capital, remainder is taxable income. Calculation: (Principal √∑ Total Expected Payments) = Non-Taxable Portion<br><br>**Schema Changes**:<br>```prisma<br>model Asset {<br>  type String // add: annuity<br>  annuityType String? // "term", "life", "joint-life", "variable"<br>  annuityStartDate DateTime?<br>  annuityEndDate DateTime? // For term only<br>  annuityPayment Float? // Monthly/annual amount<br>  annuityIndexed Boolean? // Inflation protection<br>  annuityGuarantee Int? // Guarantee period (years)<br>}<br><br>model Income {<br>  type String // add: annuity<br>  annuityStartDate DateTime?<br>  annuityIndexed Boolean?<br>  annuityGuarantee Int?<br>}<br>``` |
| **User Impact** | **High** - ~8% of retirees have annuities. Common for LIRA conversions (can convert LIRA to life annuity instead of LIF). Provides guaranteed income but reduces flexibility. |
| **Examples** | **Example**: Convert $300K LIRA to life annuity at age 65:<br>- Guaranteed payment: $1,250/month ($15K/year) for life<br>- Indexed: 2% annual increase<br>- Guarantee: 10 years (if die before 75, spouse gets payments)<br>- Trade-off: No flexibility, but income guaranteed |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-062** | **Split Investment Income into Tax Types (Dividend/Interest/Capital Gains)** | **5** | **P1** üü° | **üìã To Do** |
| **Description** | As a user with investment income, I want to specify whether my income is from dividends, interest, or capital gains so the tax calculations are accurate |
| **Acceptance Criteria** | - [ ] Add income types: "dividend-eligible", "dividend-ineligible", "interest", "capital-gains"<br>- [ ] Update income form to show investment income sub-types<br>- [ ] Backend applies correct tax treatment for each type:<br>  - Eligible dividends: Dividend tax credit (lowest tax)<br>  - Ineligible dividends: Smaller tax credit<br>  - Interest: Fully taxable at marginal rate (highest tax)<br>  - Capital gains: 50% inclusion rate (medium tax)<br>- [ ] Simulation results show tax breakdown by income type<br>- [ ] Help text explains different tax treatments<br>- [ ] Migration script: Convert existing "investment" income to "interest" (conservative)<br>- [ ] Display effective tax rate by income type in results |
| **Tasks** | - [ ] Update Prisma schema: Add dividend-eligible, dividend-ineligible, interest, capital-gains to Income.type<br>- [ ] Add investmentType, dividendEligibility, capitalGainsCostBase fields<br>- [ ] Create database migration<br>- [ ] Migration script: Update existing "investment" ‚Üí "interest"<br>- [ ] Update income form UI with investment sub-types dropdown<br>- [ ] Update Python backend tax calculations:<br>  - Eligible dividends: Gross-up 138%, federal credit 15.02%, provincial varies<br>  - Ineligible dividends: Gross-up 115%, federal credit 9.03%<br>  - Interest: 100% taxable at marginal rate<br>  - Capital gains: 50% inclusion rate (as of 2025)<br>- [ ] Display tax breakdown in results: "Investment Income Taxes: Dividends $X, Interest $Y, Capital Gains $Z"<br>- [ ] Create educational content: "Investment Income and Taxes"<br>- [ ] Test with high-dividend scenario (verify tax savings)<br>- [ ] Test with high-interest scenario (verify higher taxes)<br>- [ ] Update documentation |
| **Technical Notes** | **Tax Treatment (2025 Federal Rates)**:<br>1. **Eligible Dividends** (Canadian corporations):<br>   - Grossed up: Amount √ó 1.38<br>   - Federal tax credit: 15.02% of grossed-up amount<br>   - Provincial credit: Varies by province (ON: 10%)<br>   - **Effective tax rate**: 20-25% (lowest)<br><br>2. **Ineligible Dividends** (small business):<br>   - Grossed up: Amount √ó 1.15<br>   - Federal tax credit: 9.03% of grossed-up amount<br>   - Provincial credit: Lower than eligible<br>   - **Effective tax rate**: 30-35%<br><br>3. **Interest Income**:<br>   - 100% taxable at marginal rate<br>   - No credits or deductions<br>   - **Effective tax rate**: 40-50% (highest)<br><br>4. **Capital Gains**:<br>   - 50% inclusion rate (only half is taxable)<br>   - **Effective tax rate**: 20-25% (similar to eligible dividends)<br><br>**Example**: $10,000 income at 40% marginal rate:<br>- Eligible dividend: $2,000-$2,500 tax<br>- Interest: $4,000 tax<br>- Capital gains: $2,000 tax<br>**Difference**: $2,000/year tax savings! |
| **User Impact** | **High** - ~40% of users have investment income. Current "investment" category overstates taxes if income is dividends or capital gains. Users with $20K dividend income could be overpaying estimated taxes by $4K-$6K/year in projections. |
| **Priority Justification** | P1 because:<br>1. Tax accuracy is critical for retirement planning<br>2. Many users have dividend-focused portfolios<br>3. Current projections overstate taxes (conservative, but inaccurate)<br>4. Relatively quick implementation (5 pts, ~10 hours) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-063** | **Add Long-Term Care Expense Category with Cost Modeling** | **8** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a retirement planner, I want to model long-term care costs (nursing home, assisted living) so I can plan for this major expense that could cost $6K-$20K/month in Canada |
| **Acceptance Criteria** | - [ ] Add "long-term-care" and "home-care" expense categories<br>- [ ] Split existing "healthcare" into "healthcare-routine"<br>- [ ] Add LTC-specific fields: type, facility, province, start age, duration, subsidy<br>- [ ] Provide LTC cost presets by province (public vs private)<br>- [ ] Default LTC start age: 85 (user-configurable 75-95)<br>- [ ] Default LTC duration: 3-5 years (user-configurable 1-15 years)<br>- [ ] Simulation shows impact of LTC on retirement success rate<br>- [ ] Educational content: "Planning for Long-Term Care in Canada"<br>- [ ] Display provincial subsidy eligibility (income-tested)<br>- [ ] Warning if LTC costs exceed available assets |
| **Tasks** | - [ ] Update Prisma schema: Add long-term-care, home-care, healthcare-routine to Expense.category<br>- [ ] Add LTC fields: ltcType, ltcFacility, ltcProvince, ltcStartAge, ltcDuration, ltcSubsidy<br>- [ ] Create database migration<br>- [ ] Build LTC cost database by province:<br>  - Ontario: Public $2,036/month, Private $6,000-$15,000/month<br>  - BC: Public $1,200/month, Private $4,500-$12,000/month<br>  - Quebec: Public $2,000/month, Private $5,000-$18,000/month<br>  - Alberta: Public $1,800/month, Private $5,500-$14,000/month<br>  - Nova Scotia: Public $3,315/month, Private $6,000-$16,000/month<br>- [ ] Create LTC expense form with province presets<br>- [ ] Backend: Model LTC as time-bound expense (age 85-90 default)<br>- [ ] Show LTC impact in simulation: "LTC costs $180K over 5 years, reduces success rate from 95% to 78%"<br>- [ ] Create educational modal: "What is Long-Term Care?"<br>- [ ] Add "Plan for LTC" prompt to age 75+ users<br>- [ ] Test with high LTC costs ($20K/month √ó 5 years = $1.2M)<br>- [ ] Test with public subsidy (income-tested)<br>- [ ] Update documentation |
| **Technical Notes** | **Long-Term Care Costs (Canada 2025)**:<br><br>**Public Subsidized**:<br>- Ontario: $2,036/month (basic co-payment as of July 2024)<br>- Nova Scotia: $3,315/month (standard accommodation as of Nov 2024)<br>- Range: $879-$3,575/month depending on province<br>- **Income-tested**: Higher income = higher co-payment<br><br>**Private (Non-Subsidized)**:<br>- Basic: $6,000-$15,000/month<br>- Premium: $15,000-$20,900/month<br>- Includes: Room, meals, 24/7 care, medications<br><br>**Average LTC Stay**:<br>- Men: 2.5 years average<br>- Women: 3.5 years average<br>- 10% stay 5+ years<br>- **Planning horizon**: 3-5 years (conservative: 7 years)<br><br>**Total Lifetime Cost**:<br>- Public: $72K-$215K (3-5 years)<br>- Private: $216K-$900K (3-5 years)<br>- Premium: $540K-$1.5M (3-5 years)<br><br>**Schema Changes**:<br>```prisma<br>model Expense {<br>  category String // add: long-term-care, home-care, healthcare-routine<br>  ltcType String? // "public-subsidized", "private-basic", "private-premium"<br>  ltcFacility String?<br>  ltcProvince String?<br>  ltcStartAge Int? // Default: 85<br>  ltcDuration Int? // Default: 3-5 years<br>  ltcSubsidy Float? // Provincial subsidy if income-tested<br>}<br>``` |
| **User Impact** | **CRITICAL** - 100% of retirees need to plan for potential LTC. This is the #1 expense that depletes retirement savings. Without LTC planning:<br>- Users see "100% success rate" but fail to account for $200K-$1M expense<br>- Retirement projections are overly optimistic<br>- Users are unprepared for LTC costs<br><br>**Real Example**: User with $800K assets, $50K/year spending:<br>- Without LTC: 100% success to age 95<br>- With LTC ($10K/month for 5 years at age 85): 65% success rate<br>- **LTC costs $600K** - massive impact on retirement security |
| **Priority Justification** | **P0 (Critical)** because:<br>1. **Universal impact** - All retirees face potential LTC costs<br>2. **Massive expense** - $200K-$1M can deplete retirement savings<br>3. **Accuracy critical** - Current projections dangerously optimistic<br>4. **Competitive differentiator** - Most retirement tools don't model LTC<br>5. **User safety** - Users need realistic planning for this risk |
| **Related Stories** | - US-064 (Home Care Expenses) - Alternative to LTC facilities<br>- US-040 (Investment Timeline) - Show when LTC costs deplete assets |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-064** | **Add Home Care Expense Category** | **3** | **P1** üü° | **üìã To Do** |
| **Description** | As a user planning to age at home, I want to model in-home care costs (nursing, PSW, therapy) so I can budget for care without moving to a facility |
| **Acceptance Criteria** | - [ ] Add "home-care" expense category (already part of US-063 schema)<br>- [ ] Add home care fields: hours/week, type (nursing/PSW/therapy), provider<br>- [ ] Provide hourly rate presets by care type (Ontario 2025):<br>  - Private Nursing: $29-$96/hour<br>  - PSW (Personal Support Worker): $29/hour<br>  - Occupational Therapy: $137/hour<br>  - Companion Care: $20-$25/hour<br>- [ ] Calculate monthly cost: hours √ó rate √ó 4.33 weeks<br>- [ ] Support escalating care (e.g., 5 hrs/week at age 75 ‚Üí 20 hrs/week at age 85)<br>- [ ] Simulation models home care as alternative to LTC<br>- [ ] Compare costs: "Home care ($2,500/month) vs LTC facility ($6,000/month)"<br>- [ ] Educational content: "Aging at Home: Costs and Considerations" |
| **Tasks** | - [ ] Update Prisma schema: Add homeCareHours, homeCareType, homeCareProvider to Expense model (already added in US-063)<br>- [ ] Build home care cost database:<br>  - Ontario: Nursing $29-$96/hr, PSW $29/hr, Therapy $137/hr<br>  - BC: Similar rates (regional variations)<br>  - Quebec: Lower rates (provincial subsidies)<br>- [ ] Create home care expense form<br>- [ ] Add "escalating care" feature: Start at 5 hrs/week age 75, increase to 20 hrs/week age 85<br>- [ ] Backend: Calculate monthly cost and annual total<br>- [ ] Show home care vs LTC comparison in results<br>- [ ] Create educational content about aging at home<br>- [ ] Test with low-intensity care (5 hrs/week PSW = $629/month)<br>- [ ] Test with high-intensity care (40 hrs/week nursing = $6,144/month, same as LTC!)<br>- [ ] Update documentation |
| **Technical Notes** | **Home Care Costs (Ontario 2025)**:<br>- Private Nursing: $29.44-$96.14/hour<br>- PSW: $28.94/hour average<br>- Occupational Therapy: $136.98/hour<br>- Companion Care: $20-$25/hour<br><br>**Monthly Cost Examples** (4.33 weeks/month):<br>1. **Light care** (5 hrs/week PSW):<br>   - 5 hrs √ó $29 √ó 4.33 = $628/month<br>   - Annual: $7,536<br><br>2. **Moderate care** (15 hrs/week PSW):<br>   - 15 hrs √ó $29 √ó 4.33 = $1,884/month<br>   - Annual: $22,608<br><br>3. **Heavy care** (40 hrs/week PSW + 5 hrs/week nursing):<br>   - (40 √ó $29) + (5 √ó $60) √ó 4.33 = $6,325/month<br>   - Annual: $75,900<br>   - **Same cost as private LTC facility!**<br><br>**Advantage**: Home care is cheaper than LTC for light/moderate care. But at 40+ hours/week, costs are similar to facility care.<br><br>**Schema Changes** (already in US-063):<br>```prisma<br>model Expense {<br>  homeCareHours Float? // Hours per week<br>  homeCareType String? // "nursing", "psw", "therapy", "companion"<br>  homeCareProvider String? // Agency or private<br>}<br>``` |
| **User Impact** | **High** - ~30% of retirees prefer aging at home vs moving to facility. Home care is significantly cheaper for light/moderate care needs (5-20 hrs/week). Provides realistic alternative to LTC planning. |
| **Examples** | **Example 1**: Age at home with escalating care:<br>- Age 75-80: 5 hrs/week PSW = $629/month ($37,740 over 5 years)<br>- Age 80-85: 15 hrs/week PSW = $1,884/month ($113,040 over 5 years)<br>- Age 85-90: 30 hrs/week PSW = $3,767/month ($226,020 over 5 years)<br>- **Total: $376,800 over 15 years**<br>- Compare to LTC at age 85: $10,000/month for 5 years = $600,000<br>- **Savings: $223,200 by aging at home** |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-065** | **Add DPSP Asset Type (Historical Balances)** | **3** | **P2** üü¢ | **üìã To Do** |
| **Description** | As a user with a Deferred Profit Sharing Plan from a former employer, I want to track this locked-in balance so it's included in my retirement projections |
| **Acceptance Criteria** | - [ ] Add "dpsp" asset type to schema<br>- [ ] Add DPSP-specific fields: vested (always true), employer name<br>- [ ] DPSP treated like RRSP for withdrawals (no contributions since 1991)<br>- [ ] Help text: "DPSPs are employer-funded retirement plans. No contributions allowed since 1991."<br>- [ ] Simulation includes DPSP in RRSP/RRIF projections<br>- [ ] At age 71, DPSP converts to RRIF along with RRSP |
| **Tasks** | - [ ] Update Prisma schema: Add dpsp to Asset.type<br>- [ ] Add fields: dpspVested (default true), dpspEmployer<br>- [ ] Create database migration<br>- [ ] Update assets page UI to show DPSP option<br>- [ ] Add DPSP form fields: Employer name, balance<br>- [ ] Backend: Treat DPSP like RRSP (withdrawals 100% taxable)<br>- [ ] At age 71: Convert DPSP ‚Üí RRIF<br>- [ ] Help text explains DPSP history and rules<br>- [ ] Test with DPSP balance from former employer<br>- [ ] Update documentation |
| **Technical Notes** | **DPSP Background**:<br>- Deferred Profit Sharing Plans were employer-funded retirement plans<br>- Employee contributions prohibited since 1991<br>- Many retirees still have DPSP balances from former employers<br>- **Tax treatment**: Like RRSP (contributions were tax-deferred, withdrawals 100% taxable)<br>- **Withdrawal rules**: Can withdraw anytime (unlike LIRA which is locked)<br>- **Conversion**: At age 71, must convert to RRIF or withdraw as lump sum<br><br>**Prevalence**: ~10% of retirees have DPSP balances<br><br>**Schema Changes**:<br>```prisma<br>model Asset {<br>  type String // add: dpsp<br>  dpspVested Boolean? @default(true) // Always true (can't contribute since 1991)<br>  dpspEmployer String? // Former employer name<br>}<br>``` |
| **User Impact** | **Low-Medium** - ~10% of users have DPSP balances. Not tracking this asset means their projections understate retirement resources. Small feature that improves completeness. |
| **Priority Justification** | P2 because:<br>1. Relatively small user segment (~10%)<br>2. Low complexity (similar to RRSP)<br>3. Quick implementation (3 pts, ~6 hours)<br>4. Improves completeness for affected users |

---

#### Epic 4: UX Improvements

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-008** | **Guided Wizard - Pre-fill from Profile** | **5** | **P1** | **‚úÖ Done** |
| **Description** | As a user, I want the simulation wizard to pre-fill with my saved profile data so that I don't have to re-enter information I've already provided |
| **Acceptance Criteria** | - [x] Wizard loads profile data on initialization<br>- [x] Assets, income, expenses auto-populated<br>- [x] User can override pre-filled values<br>- [x] No errors during data loading |
| **Status** | Completed in commit 4ba194b |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-009** | **Onboarding - Skip Real Estate Step** | **1 (0 delivered)** | **P2** | **‚úÖ Done (Pre-existing)** |
| **Description** | As a user without property, I want to skip the real estate onboarding step so that I can complete setup faster |
| **Acceptance Criteria** | - [x] "Skip for now" button visible on Step 6<br>- [x] Clicking skip advances to next step<br>- [x] Can return to add real estate later<br>- [x] Progress bar shows step as optional<br>- [x] No validation errors when skipped |
| **Impact** | 12 users can now complete onboarding (feature was already implemented) |
| **Verification** | See [US-009_VERIFICATION_REPORT.md](US-009_VERIFICATION_REPORT.md) - All acceptance criteria verified as complete |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-010** | **Default Withdrawal Strategy Update** | **2** | **P0** | **‚úÖ Done** |
| **Description** | As a user, I want the default withdrawal strategy to be "minimize-income" so that I get tax-optimized results by default |
| **Acceptance Criteria** | - [x] Default strategy changed to minimize-income<br>- [x] Existing users unaffected<br>- [x] New users see minimize-income selected<br>- [x] Help text updated |
| **Status** | Completed in commit 81fcb19 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-025** | **Improve Withdrawal Strategy Discoverability** | **3** | **P1** | **‚úÖ Done** |
| **Description** | As a user, I want the withdrawal strategy selector to be more visible and prominent so that I understand it's an important decision that affects my retirement plan |
| **Acceptance Criteria** | - [x] Strategy selector moved to more prominent location<br>- [x] Visual hierarchy improved (larger, clearer label)<br>- [x] Help icon/tooltip added explaining importance<br>- [x] Strategy selector highlighted or emphasized (border, icon, etc.)<br>- [x] Mobile view optimized for easy access<br>- [x] User can easily find and change strategy<br>- [x] Strategy selection tracked in analytics |
| **Tasks** | - [x] Audit current strategy selector location and visibility<br>- [x] Design mockup for improved UI<br>- [x] Move selector to prominent location (visually separated)<br>- [x] Add visual emphasis (Target icon üéØ, blue border, background color)<br>- [x] Update label to be clearer ("Withdrawal Strategy" with subtitle)<br>- [x] Add tooltip explaining why strategy matters<br>- [x] Test on mobile devices<br>- [x] Responsive layout maintained |
| **Technical Notes** | **Implementation (commit 0a4dc70):**<br>- Added prominent blue border (2px) and background (blue-50/30)<br>- Added Target icon (üéØ) for visual emphasis<br>- Increased font sizes (text-base font-semibold)<br>- Taller select trigger (min-h-[48px])<br>- Added explanatory text: "Critical decision: How to withdraw from accounts to optimize taxes and benefits"<br>- Added tip: "üí° Tip: Income Minimization (GIS-Optimized) preserves government benefits"<br>- File: `webapp/components/simulation/HouseholdForm.tsx` (+38 lines) |
| **User Impact** | Medium-High - Ian Crawford (deleted user) specifically mentioned "early RRIF withdrawals for wife with no income" which is a strategy option. Better discoverability prevents user frustration and account deletions. ‚úÖ Now impossible to miss due to visual prominence. |
| **Dependencies** | - US-010 (Default strategy) - already completed<br>- US-026 (Display current strategy) - completed |
| **Completion** | ‚úÖ Completed January 29, 2026 in commit 0a4dc70. Strategy selector now has prominent blue border, Target icon, larger fonts, and helpful messaging. All 6 acceptance criteria met. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-026** | **Display Current Strategy Selection in Strategy Selector** | **2** | **P1** | **‚úÖ Done** |
| **Description** | As a user, I want to clearly see which withdrawal strategy is currently selected (e.g., "minimize-income") so that I know what strategy my simulation will use |
| **Acceptance Criteria** | - [x] Current strategy value visible in selector/dropdown<br>- [x] Default "minimize-income" shows as selected<br>- [x] User-selected strategy persists and displays correctly<br>- [x] Strategy name displayed in human-readable format<br>- [x] Visual confirmation when strategy is changed<br>- [x] Current strategy shown in simulation results summary |
| **Tasks** | - [x] Verify strategy value binding in UI component<br>- [x] Ensure dropdown/select shows current value<br>- [x] Map technical names to display names (e.g., "minimize-income" ‚Üí "Income Minimization (GIS-Optimized)")<br>- [x] Add visual indicator for default vs custom strategy<br>- [x] Show current strategy in results header<br>- [x] Test strategy persistence across page refreshes<br>- [x] Update SimulationWizard if needed |
| **Technical Notes** | Strategy mapping (from simulation/page.tsx:762-772):<br>```typescript<br>const strategyMap: Record<string, string> = {<br>  'minimize-income': 'Income Minimization (GIS-Optimized)',<br>  'balanced-income': 'Balanced Income',<br>  'early-rrif-withdrawal': 'Early RRIF Withdrawals (Income Splitting)',<br>  'max-tfsa-first': 'Maximize TFSA First',<br>  // ... other mappings<br>};<br>```<br><br>Ensure selector component uses this mapping to show friendly names. |
| **User Impact** | Medium - Users need clear feedback about which strategy they're using. Confusion about strategy selection leads to unexpected results and reduced trust in the tool. |
| **Dependencies** | - US-010 (Default strategy) - already completed<br>- US-025 (Improved discoverability) - should implement together for best UX |
| **Completion** | ‚úÖ Completed January 29, 2026. See US-026_COMPLETION_REPORT.md |
| **Known Issues** | ‚úÖ **Bug Fixed**: Default strategy was "balanced" instead of "minimize-income". Fixed in US-029. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-029** | **Fix Default Withdrawal Strategy to minimize-income** | **1** | **P0** | **‚úÖ Done** |
| **Description** | As a GIS-eligible retiree, I want the default withdrawal strategy to be "Income Minimization (GIS-Optimized)" so that I immediately understand the tool is designed to preserve government benefits |
| **Acceptance Criteria** | - [x] Default strategy in `defaultHouseholdInput` is `'minimize-income'`<br>- [x] Prefill API fallback strategy is `'minimize-income'` (not 'balanced')<br>- [x] Default indicator shows "(Default)" for minimize-income in results<br>- [x] Strategy selector shows "Income Minimization (GIS-Optimized)" when page loads<br>- [x] Smart recommendation logic still overrides for users with specific asset mixes<br>- [x] Manual test: New user with no profile sees minimize-income<br>- [x] Manual test: User with typical portfolio sees minimize-income |
| **Tasks** | - [x] Change default in `/webapp/lib/types/simulation.ts` line 565 from 'corporate-optimized' to 'minimize-income'<br>- [x] Change prefill API fallback in `/webapp/app/api/simulation/prefill/route.ts` line 480 from 'balanced' to 'minimize-income'<br>- [x] Change prefill API default for typical retiree in `/webapp/app/api/simulation/prefill/route.ts` line 525 from 'balanced' to 'minimize-income'<br>- [x] Test with new user profile (no assets)<br>- [x] Test with typical mixed portfolio<br>- [x] Verify smart recommendation still works for RRIF>40%, corporate>30%, etc.<br>- [x] Deploy to production |
| **Technical Notes** | **Root Cause**:<br>1. `defaultHouseholdInput.strategy` is set to 'corporate-optimized' (line 565 of simulation.ts)<br>2. Prefill API uses 'balanced' as fallback (line 480 of prefill/route.ts)<br>3. Prefill API uses 'balanced' for typical retirees (line 525)<br><br>**Fix**: Change all three locations to 'minimize-income'<br><br>**Why minimize-income?**<br>- GIS optimization is core product differentiator<br>- Benefits majority of Canadian retirees (OAS clawback avoidance)<br>- Safe default that works well for low/moderate income users<br>- Users can still select other strategies if needed<br><br>**Files to modify**:<br>1. `/webapp/lib/types/simulation.ts` (line 565)<br>2. `/webapp/app/api/simulation/prefill/route.ts` (lines 480, 525) |
| **User Impact** | **CRITICAL** - This bug affects ALL users and contributed to account deletions. Ian Crawford said "withdrawal strategies were not discoverable" - seeing "Balanced" instead of "Income Minimization (GIS-Optimized)" hides the GIS optimization feature entirely. Fixing this will immediately improve user understanding and trust. |
| **Bug Report** | See `US-026_BUG_REPORT.md` for detailed root cause analysis and evidence |
| **Dependencies** | - US-026 (completed) - UI now shows strategy correctly, just need to fix default value |
| **Priority Justification** | P0 (Critical) - This is a fundamental product issue that:<br>1. Hides core value proposition (GIS optimization)<br>2. Confuses users about strategy selection<br>3. Contributed to user account deletions<br>4. Affects 100% of new users<br>5. Simple 3-line fix with high impact |
| **Completion** | ‚úÖ Completed January 29, 2026. See US-029_COMPLETION_REPORT.md. Changed 3 lines of code to fix default strategy. |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-038** | **Fix CPP/OAS Income Timing Bug in Simulations** | **8** | **P0** | **üìã To Do** |
| **Description** | As a user, I want simulations to correctly account for when CPP/OAS income starts (based on my selected start ages) so that my retirement projections are accurate and I can trust the tool |
| **User Feedback** | **Source**: UserFeedback database (ID: 1b6410b0-f96b-4ecc-8320-a6d92aebd61d)<br>**User**: rightfooty218@gmail.com (Ontario, free tier, 2 simulations run)<br>**Date**: January 29, 2026<br>**Satisfaction Score**: 1/5 ‚ö†Ô∏è (Lowest possible - indicates severe dissatisfaction)<br>**Priority**: 4 (High - automatically escalated due to low satisfaction)<br>**Feedback Type**: dashboard<br>**Trigger**: dashboard_feedback_panel at https://www.retirezest.com/dashboard<br>**User's Exact Words**: *"This by far the worst even worse than ai. It diesnt take it to account when pics come due sucks"*<br><br>**üö® CRITICAL ISSUE IDENTIFIED**: User is reporting that **simulations don't account for when CPP/OAS income starts** ("when pics come due" = "when CPP/OAS come due"). This is a **SIMULATION ACCURACY BUG**, not just a dashboard UX issue. The user ran simulations but got incorrect results because CPP/OAS income timing was wrong.<br><br>**THIS CHANGES EVERYTHING**: What appeared to be a dashboard UX problem is actually a **core simulation engine bug** affecting income projections. This is P0 critical and requires immediate investigation. |
| **Acceptance Criteria** | **Investigation Phase:**<br>- [ ] Query user's simulation data (rightfooty218@gmail.com) from database<br>- [ ] Review user's CPP/OAS start age settings<br>- [ ] Check simulation results for income timing errors<br>- [ ] Reproduce bug with same inputs<br>- [ ] Identify root cause in simulation engine<br>- [ ] Document expected vs actual behavior<br><br>**Fix Phase - CPP Timing:**<br>- [ ] CPP income starts at correct age (user-selected, default 65)<br>- [ ] CPP can start ages 60-70 (with reduction/increase applied)<br>- [ ] CPP reduction: 0.6% per month before 65 (max 36% at age 60)<br>- [ ] CPP increase: 0.7% per month after 65 (max 42% at age 70)<br>- [ ] No CPP income before selected start age<br>- [ ] CPP amount adjusts correctly based on start age<br><br>**Fix Phase - OAS Timing:**<br>- [ ] OAS income starts at correct age (user-selected, default 65)<br>- [ ] OAS can start ages 65-70 (no early start option)<br>- [ ] OAS deferral bonus: 0.6% per month after 65 (max 36% at age 70)<br>- [ ] No OAS income before age 65 (hard rule)<br>- [ ] No OAS income before selected start age<br>- [ ] OAS amount adjusts correctly based on start age<br><br>**Testing:**<br>- [ ] Test with CPP at age 60 (max reduction)<br>- [ ] Test with CPP at age 65 (no adjustment)<br>- [ ] Test with CPP at age 70 (max increase)<br>- [ ] Test with OAS at age 65 (default)<br>- [ ] Test with OAS at age 70 (max deferral bonus)<br>- [ ] Test with delayed retirement (user retires after CPP/OAS start)<br>- [ ] Test with early retirement (user retires before CPP/OAS start)<br>- [ ] Verify year-by-year income table shows $0 before start ages<br>- [ ] Verify health score improves/worsens with timing changes<br><br>**User Validation:**<br>- [ ] Re-run rightfooty218@gmail.com's scenarios with fix<br>- [ ] Show user corrected results<br>- [ ] Request feedback on accuracy<br>- [ ] Monitor satisfaction scores after fix deployed |
| **Tasks** | **Week 1: Investigation (12 hours)**<br>- [ ] Query user's simulation history from database<br>- [ ] Review user's dashboard interactions (if analytics available)<br>- [ ] Check for API errors or performance issues in user's session<br>- [ ] Audit dashboard UI/UX:<br>  - [ ] Information architecture (is it clear?)<br>  - [ ] Navigation (can user find what they need?)<br>  - [ ] Visual hierarchy (is important info prominent?)<br>  - [ ] Loading performance (is it slow?)<br>  - [ ] Mobile responsiveness (does it work on phone?)<br>  - [ ] Error messages (are they helpful?)<br>  - [ ] Empty states (what if no simulations?)<br>  - [ ] Call-to-action clarity (what should user do next?)<br>- [ ] Compare with competitor dashboards (Wealthsimple, Questrade, etc.)<br>- [ ] Create issue report with findings<br><br>**Week 2: User Outreach (2 hours)**<br>- [ ] Draft personalized email to rightfooty218@gmail.com<br>- [ ] Express concern and desire to improve<br>- [ ] Ask specific questions about their experience<br>- [ ] Offer 15-minute call or detailed email response<br>- [ ] Track response and follow up<br><br>**Week 3: Fixes (8 hours)**<br>- [ ] Prioritize fixes based on investigation<br>- [ ] Implement quick wins (low-hanging fruit)<br>- [ ] Redesign problematic UI elements<br>- [ ] Improve feedback form:<br>  - [ ] Add "What frustrated you most?" open text field (required)<br>  - [ ] Simplify form (fewer questions = higher completion)<br>  - [ ] Add visual indicators (progress bar, "almost done")<br>  - [ ] Make submit button more prominent<br>- [ ] Add dashboard tour for first-time users<br>- [ ] Test fixes with free tier users<br><br>**Week 4: Monitoring (2 hours)**<br>- [ ] Deploy fixes to production<br>- [ ] Monitor satisfaction scores for 2 weeks<br>- [ ] Set up dashboard analytics (Mixpanel, Amplitude, or GA4)<br>- [ ] Create alert for satisfaction ‚â§2 (email notification)<br>- [ ] Document learnings and best practices |
| **Technical Notes** | **Feedback System Analysis:**<br><br>**Priority Calculation** (from `/webapp/app/api/feedback/submit/route.ts` lines 191-223):<br>```typescript<br>function calculatePriority(feedback, subscriptionTier): number {<br>  let score = 3; // Base priority<br>  if (feedback.satisfactionScore <= 2) score += 1; // +1 for low satisfaction<br>  if (feedback.npsScore <= 6) score += 1; // +1 for detractors<br>  if (subscriptionTier === 'premium') score += 1; // +1 for premium<br>  return Math.min(score, 5); // Cap at 5<br>}<br>```<br>**Why priority 4?** User gave 1/5 satisfaction (‚â§2), which adds +1 to base priority of 3 = 4<br><br>**Feedback Form Location:**<br>- Component: `/webapp/components/dashboard/DashboardFeedbackPanel.tsx`<br>- Triggered from: `/webapp/app/dashboard/page.tsx`<br>- API endpoint: `/webapp/app/api/feedback/submit/route.ts`<br><br>**User Profile Query:**<br>```sql<br>SELECT u.email, u.createdAt, u.subscriptionTier,<br>       s.id, s.scenarioName, s.householdInput, s.result<br>FROM User u<br>LEFT JOIN Scenario s ON u.id = s.userId<br>WHERE u.email = 'rightfooty218@gmail.com'<br>ORDER BY s.createdAt DESC;<br>```<br><br>**Dashboard Components to Review:**<br>1. `/webapp/app/dashboard/page.tsx` - Main dashboard page<br>2. `/webapp/components/dashboard/ScenarioList.tsx` - List of scenarios<br>3. `/webapp/components/dashboard/ProfileSummary.tsx` - User profile card<br>4. `/webapp/components/dashboard/QuickActions.tsx` - Action buttons<br>5. `/webapp/components/dashboard/DashboardFeedbackPanel.tsx` - Feedback form<br><br>**Potential Issues to Investigate:**<br>1. **Empty State**: If user has no/few simulations, is dashboard confusing?<br>2. **Navigation**: Can user easily start new simulation or view results?<br>3. **Performance**: Does dashboard load slowly (API calls, large data)?<br>4. **Mobile UX**: Is dashboard broken or hard to use on mobile?<br>5. **Feedback Form**: Is form too long/complex causing abandonment?<br>6. **Visual Design**: Is UI cluttered, confusing, or unprofessional?<br>7. **Error Handling**: Did user encounter errors that weren't handled well?<br>8. **Onboarding**: Does dashboard assume user knowledge they don't have?<br><br>**Similar Feedback Check:**<br>```bash<br>DATABASE_URL="..." node query_user_feedback.js | grep "Satisfaction: [12]/5"<br># Check if other users also gave low scores<br>```<br><br>**Analytics to Add:**<br>- Track dashboard page views<br>- Track time on dashboard<br>- Track clicks on action buttons<br>- Track feedback form starts vs completions<br>- Track satisfaction scores distribution<br>- Track user flow (where do they go from dashboard?)<br><br>**Dashboard Best Practices:**<br>- Clear hierarchy (most important info first)<br>- Quick actions above the fold<br>- Visual progress indicators<br>- Helpful empty states ("Get started by...")<br>- Fast loading (<2 seconds)<br>- Mobile-first responsive design<br>- Clear calls-to-action<br>- Contextual help/guidance |
| **User Impact** | **CRITICAL** - A 1/5 satisfaction score is the strongest negative signal possible. This user was so frustrated they couldn't even complete the feedback form. This likely indicates a systemic UX problem affecting multiple users (but only 1 brave enough to give feedback). Fixing dashboard UX is critical for user retention and word-of-mouth. |
| **Root Cause Hypothesis** | Based on incomplete feedback (no comments, no features selected), possible root causes:<br><br>1. **Dashboard is overwhelming/confusing** - User couldn't figure out what to do<br>2. **Feedback form is too complex** - User gave up before completing<br>3. **Technical error** - User encountered bug/error that broke experience<br>4. **Mobile UX broken** - Dashboard doesn't work on user's device<br>5. **Missing expected features** - User expected something that doesn't exist<br>6. **Poor onboarding** - User landed on dashboard without context<br>7. **Performance issues** - Dashboard too slow, user frustrated<br>8. **Empty state problem** - User has no data, dashboard unhelpful<br><br>**Most Likely**: Dashboard is confusing/overwhelming for new users with few simulations (user only ran 2 simulations). Empty/sparse dashboard may not guide user on what to do next. |
| **Dependencies** | - Access to user's simulation data (rightfooty218@gmail.com)<br>- Analytics tools (Mixpanel, Amplitude, or GA4) - optional but recommended<br>- Email sending capability (Resend API already set up)<br>- Dashboard UI components (existing) |
| **Priority Justification** | **P0 (Critical)** because:<br>1. **Strongest negative signal** - 1/5 is rock bottom satisfaction<br>2. **High priority by algorithm** - System flagged as priority 4<br>3. **User retention risk** - Dissatisfied users churn and don't return<br>4. **Word-of-mouth risk** - Negative experiences spread to friends/family<br>5. **Product reputation** - Dashboard is first impression after signup<br>6. **Pattern risk** - This may be symptom of broader UX issues<br>7. **Quick ROI** - Fixing dashboard UX benefits all users immediately |
| **Success Metrics** | **Investigation Phase:**<br>- [ ] Root cause identified within 2 weeks<br>- [ ] 3+ specific UX issues documented<br>- [ ] User responds to outreach email (stretch goal)<br><br>**Fix Phase:**<br>- [ ] Dashboard satisfaction score increases from 1/5 to >3.5/5 average<br>- [ ] Feedback form completion rate increases from 0% to >60%<br>- [ ] Zero 1/5 satisfaction scores in next 30 days<br>- [ ] Dashboard page bounce rate decreases by 20%<br>- [ ] User engagement metrics improve (time on page, actions taken)<br><br>**Long-term:**<br>- [ ] Dashboard satisfaction maintains >4/5 average<br>- [ ] Less than 5% of feedback scores are ‚â§2<br>- [ ] Support tickets about dashboard confusion decrease by 50%<br>- [ ] User retention improves (fewer churned users citing dashboard issues) |
| **Related Stories** | - US-028 (Help Section) - Dashboard could link to help content<br>- US-027 (Educational Guidance) - Dashboard could surface key guidance<br>- Feedback System (already implemented) - Improve form UX |
| **Next Steps** | 1. ‚úÖ Create user story (US-038) and add to backlog<br>2. ‚úÖ Email sent to user requesting clarification on "pics" (Jan 29, 2026)<br>3. Query user's simulation history and profile data<br>4. Wait for user response to understand issue<br>5. Investigate and fix reported issue<br>6. Follow up with corrected results after fix deployed |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-039** | **Pension Start Date Configuration & Simulation Integration** | **5** | **P1** | **üìã To Do** |
| **Description** | As a user with pension income, I want to specify when my pension payments will start (age or specific year) and have this accurately reflected in my retirement simulations so that my projections show correct income timing |
| **User Story** | As a retiree with a company pension, I want to configure when my pension payments begin (e.g., at age 60, or in year 2028) so that my retirement simulation accurately shows $0 pension income before that date and the correct pension amount starting from that date forward. |
| **Acceptance Criteria** | **Data Model & Input:**<br>- [ ] Pension data model includes `startAge` field (integer, 50-85)<br>- [ ] Pension data model includes `startYear` field (optional, alternative to age)<br>- [ ] Pension input form asks "When will pension payments start?"<br>- [ ] User can choose: "At age X" OR "In year YYYY"<br>- [ ] Default pension start age is 65 if not specified<br>- [ ] Validation: startAge must be ‚â• current age<br>- [ ] Validation: startYear must be ‚â• current year<br>- [ ] Help text explains: "Enter the age when you will start receiving pension payments"<br><br>**Simulation Integration:**<br>- [ ] Simulation shows $0 pension income before start age/year<br>- [ ] Simulation shows full pension amount starting from start age/year<br>- [ ] Pension income properly indexed for inflation (if indexing enabled)<br>- [ ] Pension income included in taxable income calculations<br>- [ ] Pension income factored into OAS/GIS clawback calculations<br>- [ ] Year-by-year projection table shows correct pension timing<br>- [ ] Cash flow chart visualizes pension income starting at correct age<br><br>**Edge Cases:**<br>- [ ] User already receiving pension (startAge = currentAge) works correctly<br>- [ ] Future pension (startAge 10+ years away) works correctly<br>- [ ] Pension starting mid-year (prorated for first year)<br>- [ ] Multiple pensions with different start dates all handled correctly<br>- [ ] Partner has different pension start age than user<br><br>**Testing:**<br>- [ ] Test pension starting at age 55 (early retirement)<br>- [ ] Test pension starting at age 60 (common early pension)<br>- [ ] Test pension starting at age 65 (standard retirement)<br>- [ ] Test pension already started (age 70, pension at 65)<br>- [ ] Test pension 5 years in future<br>- [ ] Test multiple pensions (DB + DC) with different start ages<br>- [ ] Verify inflation indexing works correctly over time<br>- [ ] Verify pension income affects GIS eligibility calculations |
| **Tasks** | **Week 1: Backend Implementation (8 hours)**<br>- [ ] Update Prisma schema: Add `startAge` and `startYear` to Pension model<br>- [ ] Create database migration<br>- [ ] Update pension API routes to save/retrieve start date<br>- [ ] Update Python backend simulation to handle pension start timing:<br>  - [ ] Modify `juan-retirement-app/modules/simulation.py`<br>  - [ ] Add logic: `if current_age < pension.startAge: pension_income = 0`<br>  - [ ] Ensure pension properly starts at specified age<br>  - [ ] Handle inflation indexing from start year forward<br>- [ ] Write unit tests for pension timing logic<br><br>**Week 2: Frontend Implementation (6 hours)**<br>- [ ] Update pension input form:<br>  - [ ] Add "Pension Start Age" field (number input, 50-85)<br>  - [ ] Add help tooltip explaining start age<br>  - [ ] Add validation (must be ‚â• current age)<br>  - [ ] Pre-fill with sensible default (65 or retirement age)<br>- [ ] Update TypeScript types (`webapp/lib/types/simulation.ts`)<br>- [ ] Update pension form component (`components/PensionForm.tsx`)<br>- [ ] Test form saves and retrieves start age correctly<br><br>**Week 3: Simulation Results Display (4 hours)**<br>- [ ] Update cash flow visualization to show pension starting at correct age<br>- [ ] Update year-by-year income table to show $0 before start age<br>- [ ] Add pension timeline indicator in results<br>- [ ] Test with multiple scenarios (early/late pension start)<br><br>**Week 4: Testing & Documentation (4 hours)**<br>- [ ] Create comprehensive test scenarios<br>- [ ] Run regression tests (ensure existing pensions still work)<br>- [ ] Test edge cases (already started, far future, multiple pensions)<br>- [ ] Update user documentation about pension start dates<br>- [ ] Create FAQ: "When should I start my pension?" |
| **Technical Notes** | **Database Schema Update:**<br>```prisma<br>model Pension {<br>  id                  String   @id @default(cuid())<br>  userId              String<br>  pensionName         String   // e.g., "Teacher's Pension"<br>  monthlyAmount       Float    // Monthly pension amount<br>  inflationIndexed    Boolean  @default(true)<br>  startAge            Int?     @default(65) // NEW: Age when pension starts<br>  startYear           Int?     // NEW: Alternative to startAge<br>  createdAt           DateTime @default(now())<br>  updatedAt           DateTime @updatedAt<br>  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)<br>}<br>```<br><br>**Python Backend Logic (simulation.py):**<br>```python<br>def calculate_pension_income(pension, current_age, current_year):<br>    # Determine start age/year<br>    start_age = pension.get('startAge', 65)<br>    start_year = pension.get('startYear')<br>    <br>    # Check if pension has started<br>    if start_year:<br>        if current_year < start_year:<br>            return 0  # Pension hasn't started yet<br>    else:<br>        if current_age < start_age:<br>            return 0  # Pension hasn't started yet<br>    <br>    # Pension has started - return monthly amount (adjusted for inflation if indexed)<br>    monthly_amount = pension['monthlyAmount']<br>    annual_amount = monthly_amount * 12<br>    <br>    # Apply inflation indexing if enabled<br>    if pension.get('inflationIndexed', True):<br>        years_since_start = current_age - start_age<br>        inflation_rate = 0.02  # 2% default<br>        annual_amount *= (1 + inflation_rate) ** years_since_start<br>    <br>    return annual_amount<br>```<br><br>**Frontend Form Component:**<br>```tsx<br>// webapp/components/PensionForm.tsx<br><Input<br>  type="number"<br>  label="Pension Start Age"<br>  min={currentAge}<br>  max={85}<br>  value={pension.startAge ?? 65}<br>  onChange={(e) => updatePension({ startAge: parseInt(e.target.value) })}<br>  helpText="Age when you will start receiving pension payments"<br>  required<br>/><br>```<br><br>**Common Pension Start Ages:**<br>- **55-60**: Early retirement pensions (often reduced amounts)<br>- **60-65**: Bridge pensions (until CPP/OAS starts)<br>- **65**: Standard retirement age (most common)<br>- **65+**: Deferred pensions (sometimes with increase)<br><br>**Files to Modify:**<br>1. `webapp/prisma/schema.prisma` - Add startAge/startYear fields<br>2. `juan-retirement-app/modules/simulation.py` - Pension timing logic<br>3. `webapp/components/PensionForm.tsx` - Add start age input<br>4. `webapp/lib/types/simulation.ts` - Update TypeScript types<br>5. `webapp/app/api/pensions/route.ts` - Save/retrieve start date<br>6. `webapp/components/simulation/CashFlowChart.tsx` - Show pension timing |
| **User Impact** | **High** - Many users have pensions that don't start immediately at retirement. Without this feature, simulations show incorrect income timing, leading to inaccurate projections and poor financial planning decisions. This is especially critical for early retirees (age 55-60) whose pensions may not start until 60-65. |
| **Known Issues** | **Current Implementation Gap:**<br>- Current system assumes all pensions start immediately<br>- No way to specify future pension start date<br>- Simulations may overstate early retirement income<br>- Users manually adjust by creating separate scenarios<br><br>**User Pain Points:**<br>- "My pension doesn't start until age 60, but simulation shows income at 55"<br>- "How do I model bridge pension vs full pension?"<br>- "Simulation assumes I get pension now, but I'm 5 years away"<br><br>**Related to US-038**: If user's feedback "pics come due" refers to pension start dates (not CPP/OAS), this story addresses that issue. |
| **Dependencies** | - Prisma schema migration capability<br>- Python backend simulation engine access<br>- Pension data already captured in user profiles<br>- Related to US-003 (Pension Indexing) - both enhance pension modeling |
| **Priority Justification** | **P1 (High)** because:<br>1. **Accuracy critical** - Income timing is fundamental to retirement planning<br>2. **Common scenario** - Many users have pensions with future start dates<br>3. **Easy to implement** - Relatively straightforward 5-pt story<br>4. **High ROI** - Fixes projections for ~30-40% of users with pensions<br>5. **User feedback driven** - May be related to US-038 user complaint<br>6. **Complements US-038** - If "pics" = pensions, this story solves it |
| **Success Metrics** | - [ ] 100% of pensions with future start dates show $0 income before start<br>- [ ] Pension income starts exactly at specified age/year<br>- [ ] Inflation indexing works correctly from start date<br>- [ ] Zero user complaints about incorrect pension timing<br>- [ ] Users report improved accuracy (survey: >80% say "accurate")<br>- [ ] Regression tests pass (existing pensions still work) |
| **Related Stories** | - US-038 (Fix Income Timing Bug) - May be the same issue<br>- US-003 (Pension Indexing) - Both improve pension modeling<br>- US-027 (Educational Guidance) - Document pension start date strategies |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-042** | **Align Withdrawal Strategy Names Between Frontend and Backend** | **2** | **P2** | **üìã To Do** |
| **Description** | As a developer, I want withdrawal strategy internal names to be consistent between the frontend UI and Python backend so that we eliminate the need for mapping dictionaries and reduce the risk of synchronization bugs |
| **Acceptance Criteria** | - [ ] **Audit Phase**: Identify all withdrawal strategy name mismatches between frontend and backend<br>- [ ] **Alignment Phase**: Choose canonical naming scheme (prefer backend names for consistency)<br>- [ ] **Implementation Phase**: Update frontend strategyMap to use backend names<br>- [ ] **Testing Phase**: Verify all withdrawal strategies still display correctly<br>- [ ] **Documentation Phase**: Update any developer docs or comments referencing old names<br>- [ ] Zero TypeScript compilation errors<br>- [ ] All withdrawal strategies render with correct display names<br>- [ ] Backend receives correct strategy values from frontend |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-049** | **Subscription Status Ribbon Display** | **2** | **P2** | **üìã To Do** |
| **Description** | As a user, I want to see a visible ribbon or badge showing whether I'm on the Free or Premium subscription tier so that I'm always aware of my account status and understand which features are available to me |
| **Acceptance Criteria** | - [ ] Subscription status ribbon visible on all dashboard pages<br>- [ ] Shows "Free" badge for free tier users<br>- [ ] Shows "Premium" badge for premium users<br>- [ ] Different visual styling for Free vs Premium (e.g., gray vs gold/blue)<br>- [ ] Clicking on Free badge shows upgrade options<br>- [ ] Clicking on Premium badge shows subscription details<br>- [ ] Mobile-responsive design<br>- [ ] Ribbon position doesn't obstruct main content<br>- [ ] Status updates immediately after subscription change |
| **Tasks** | - [ ] Design ribbon/badge component mockup<br>- [ ] Choose visual styling (colors, icons, placement)<br>- [ ] Create SubscriptionRibbon component<br>- [ ] Fetch user subscription status from session/API<br>- [ ] Implement Free tier badge (gray, with upgrade CTA)<br>- [ ] Implement Premium tier badge (gold/blue, with manage link)<br>- [ ] Add to main layout or navigation bar<br>- [ ] Link Free badge to /pricing or upgrade modal<br>- [ ] Link Premium badge to /account or subscription management<br>- [ ] Test on all dashboard pages<br>- [ ] Test on mobile devices<br>- [ ] Verify status updates after subscription changes |
| **Technical Notes** | **Placement Options:**<br>1. **Top Navigation Bar** - Next to user profile dropdown<br>2. **Sidebar** - Below main navigation items<br>3. **Header** - Small badge near logo<br><br>**Recommended: Top Navigation Bar** (most visible without being intrusive)<br><br>**Component Structure:**<br>```tsx<br>// components/SubscriptionRibbon.tsx<br>function SubscriptionRibbon({ tier }: { tier: 'free' \| 'premium' }) {<br>  if (tier === 'free') {<br>    return (<br>      <Link href="/pricing"><br>        <Badge className="bg-gray-200 text-gray-700 hover:bg-gray-300"><br>          Free Tier<br>          <ArrowUpRight className="w-3 h-3 ml-1" /><br>        </Badge><br>      </Link><br>    );<br>  }<br>  <br>  return (<br>    <Link href="/account"><br>      <Badge className="bg-gradient-to-r from-yellow-400 to-yellow-600 text-white"><br>        <Crown className="w-3 h-3 mr-1" /><br>        Premium<br>      </Badge><br>    </Link><br>  );<br>}<br>```<br><br>**Session Integration:**<br>```typescript<br>// Get subscription tier from session<br>const session = await getSession();<br>const user = await prisma.user.findUnique({<br>  where: { id: session.userId },<br>  select: { subscriptionTier: true }<br>});<br>const tier = user.subscriptionTier; // 'free' or 'premium'<br>```<br><br>**Visual Design:**<br>- **Free Tier**:<br>  - Color: Gray (#E5E7EB background, #374151 text)<br>  - Icon: None or small info icon<br>  - Hover: Slight darkening + "Upgrade" tooltip<br>  <br>- **Premium Tier**:<br>  - Color: Gold gradient (#FCD34D to #F59E0B) or Blue (#3B82F6)<br>  - Icon: Crown or Star<br>  - Hover: Slight brightening + "Manage Subscription" tooltip<br><br>**Files to Create/Modify:**<br>1. `webapp/components/SubscriptionRibbon.tsx` - New component<br>2. `webapp/components/Navigation.tsx` - Add ribbon to nav bar<br>3. `webapp/app/(dashboard)/layout.tsx` - Integrate into layout<br>4. `webapp/lib/types/subscription.ts` - Type definitions (if needed) |
| **User Impact** | **Medium** - Helps users understand their account status at a glance. Provides visibility into tier benefits and creates upgrade awareness for free tier users. Premium users feel valued with distinctive badge. |
| **Priority Justification** | **P2 (Medium)** because:<br>1. **User awareness** - Users should know their subscription status<br>2. **Upgrade conversion** - Visible Free badge reminds users of premium option<br>3. **Quick win** - Only 2 story points, ~4 hours of work<br>4. **Low risk** - Simple UI addition, no complex logic<br>5. **Professional appearance** - Common SaaS pattern users expect |
| **Success Metrics** | - [ ] Subscription badge visible on 100% of dashboard pages<br>- [ ] Click-through rate on Free badge >10% (users exploring upgrade)<br>- [ ] Zero user confusion about which tier they're on<br>- [ ] Premium users report feeling valued (survey feedback)<br>- [ ] Badge loads within 200ms (fast, no performance impact) |
| **Related Stories** | - US-024 (Premium Account Verification) - subscription management<br>- Dual Limit System (Feb 1, 2026) - complements free/premium differentiation |
| **Tasks** | - [ ] **Audit** (3 hours):<br>  - Grep for all withdrawal strategy references in frontend<br>  - Grep for all withdrawal strategy references in Python backend<br>  - Document current mapping (e.g., 'early-rrif-withdrawal' ‚Üí 'rrif-frontload')<br>  - List all files requiring updates<br>- [ ] **Decision** (2 hours):<br>  - Choose canonical naming scheme (recommend: backend names)<br>  - Create migration plan for backward compatibility<br>  - Review with team for approval<br>- [ ] **Implementation** (3 hours):<br>  - Update `webapp/app/(dashboard)/simulation/page.tsx` strategyMap keys<br>  - Update any API calls or form submissions<br>  - Update TypeScript types if needed<br>  - Update database seed data if applicable<br>- [ ] **Validation** (2 hours):<br>  - Run TypeScript compilation<br>  - Test all 6 withdrawal strategies in dev environment<br>  - Verify backend receives correct strategy names<br>  - Check existing user simulations still work |
| **Technical Notes** | **Current Naming Inconsistency:**<br><br>**Frontend** (`webapp/app/(dashboard)/simulation/page.tsx:252`):<br>```typescript<br>const strategyMap: Record<string, string> = {<br>  'minimize-income': 'Income Minimization (GIS-Optimized)',<br>  'balanced-income': 'Balanced Income',<br>  'early-rrif-withdrawal': 'Early RRIF Withdrawals (Income Splitting)', // ‚ö†Ô∏è MISMATCH<br>  'max-tfsa-first': 'Maximize TFSA First',<br>  'corporate-optimized': 'Corporate Account Optimization',<br>  'preserve-estate': 'Estate Preservation',<br>};<br>```<br><br>**Backend** (Python `juan-retirement-app/modules/`):<br>- Uses `'rrif-frontload'` instead of `'early-rrif-withdrawal'`<br><br>**Problem**: Requires mapping dictionaries that can get out of sync<br><br>**Recommended Approach**:<br>1. Use backend names as source of truth (they drive simulation logic)<br>2. Update frontend to use `'rrif-frontload'` key<br>3. Keep display name "Early RRIF Withdrawals (Income Splitting)"<br>4. Check database for any stored strategy values (may need migration)<br><br>**Files to Update**:<br>- `webapp/app/(dashboard)/simulation/page.tsx` (strategyMap keys)<br>- `webapp/components/simulation/*.tsx` (any hardcoded strategy checks)<br>- `webapp/app/api/simulate/route.ts` (API endpoint if validation exists)<br>- `webapp/prisma/schema.prisma` (if enum exists)<br>- Any test files referencing withdrawal strategies |
| **User Impact** | **Low** (internal refactoring) - Users will see no visible changes. This is a developer experience improvement that reduces technical debt and prevents future bugs from mapping dictionary desync. However, it's important for long-term maintainability. |
| **Priority Justification** | **P2 (Medium)** because:<br>1. **Technical debt** - Inconsistent naming creates maintenance burden<br>2. **Low urgency** - Current mapping works, no active bugs reported<br>3. **Quick win** - Only 2 story points, can be completed in 1 day<br>4. **Risk reduction** - Eliminates potential sync bugs in future<br>5. **Developer experience** - Makes codebase easier to understand<br>6. **Good housekeeping** - Should be done before adding new withdrawal strategies |
| **Success Metrics** | - [ ] Zero withdrawal strategy name mappings between frontend/backend<br>- [ ] TypeScript compilation passes with 0 errors<br>- [ ] All 6 withdrawal strategies tested and working<br>- [ ] No user-reported issues after deployment<br>- [ ] Code review passes (naming consistency verified)<br>- [ ] Documentation updated to reflect new naming convention |
| **Related Stories** | - US-025 (Withdrawal Strategy UX) - Uses strategy names in UI<br>- US-026 (Default Withdrawal Strategy) - References strategy selection<br>- Future withdrawal strategy features - Will benefit from consistent naming |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-040** | **Investment Timeline Display - Show Account Lifespan & Key Dates** | **5** | **P1** | **üìã To Do** |
| **Description** | As a user, I want to see a visual timeline showing when my LIRA converts to LRIF, when each investment account will deplete, and how long my investments will last so that I can understand my retirement income timeline |
| **User Feedback** | **Source**: User feedback from rightfooty218@gmail.com (January 30, 2026)<br>**Issue**: "Doesn't give end date for investments"<br>**Context**: User doesn't know when LIRA converts to LRIF (age 71), or when investment accounts will run out |
| **Acceptance Criteria** | - [ ] Show "LIRA‚ÜíLRIF conversion at age 71 (Year YYYY)" prominently<br>- [ ] Display depletion date for each account type (NonReg, RRIF, TFSA)<br>- [ ] Show "Your investments last until age X (Year YYYY)" summary<br>- [ ] Visual Gantt chart of account lifespans (optional, nice-to-have)<br>- [ ] Timeline shows key milestones (age 65 CPP/OAS start, age 71 RRIF conversion, account depletions)<br>- [ ] Mobile-friendly timeline display<br>- [ ] If account never depletes, show "TFSA balance grows to $XXX,XXX at age 95"<br>- [ ] Color-coded timeline (green = active, yellow = converting, red = depleted) |
| **Tasks** | - [ ] **Backend Analysis** (2 hours):<br>  - Query simulation dataframe for account balances by year<br>  - Identify year when each account reaches $0<br>  - Calculate LIRA‚ÜíLRIF conversion year (age 71)<br>  - Identify years with significant account changes<br>- [ ] **UI Design** (2 hours):<br>  - Design timeline component mockup<br>  - Choose visualization style (horizontal timeline, milestone list, or Gantt chart)<br>  - Design mobile-responsive layout<br>  - Review with team for approval<br>- [ ] **Frontend Implementation** (6 hours):<br>  - Create InvestmentTimeline component<br>  - Parse simulation results to extract timeline data<br>  - Implement milestone calculation logic<br>  - Display LIRA‚ÜíLRIF conversion (if user has LIRA)<br>  - Display account depletion dates<br>  - Show "investments last until age X" summary<br>  - Add visual indicators (icons, colors)<br>  - Make responsive for mobile<br>  - Integrate into simulation results page<br>- [ ] **Testing** (2 hours):<br>  - Test with user rightfooty218@gmail.com data (age 67, LIRA)<br>  - Test with different account types (some users have RRIF already)<br>  - Test with accounts that never deplete (TFSA grows)<br>  - Test with accounts that deplete early (age 75-80)<br>  - Test on mobile devices<br>  - Verify accuracy of depletion calculations |
| **Technical Notes** | **Backend Data Available**:<br>From simulation DataFrame, for each year:<br>- `end_rrif_p1`, `end_rrif_p2` - RRIF balances<br>- `end_tfsa_p1`, `end_tfsa_p2` - TFSA balances<br>- `end_nonreg_p1`, `end_nonreg_p2` - NonReg balances<br>- `year`, `age_p1`, `age_p2` - Year and ages<br><br>**Timeline Calculation Logic**:<br>```javascript<br>// Find account depletion years<br>function calculateTimeline(simulationData) {<br>  const timeline = [];<br>  <br>  // LIRA‚ÜíLRIF conversion (if user starts with LIRA/RRSP before age 71)<br>  const liraConversionYear = simulationData.find(y => y.age_p1 === 71);<br>  if (liraConversionYear) {<br>    timeline.push({<br>      age: 71,<br>      year: liraConversionYear.year,<br>      event: 'LIRA converts to LRIF (mandatory)',<br>      type: 'conversion'<br>    });<br>  }<br>  <br>  // Find NonReg depletion<br>  const nonregDepletion = simulationData.find((y, i) => <br>    i > 0 && y.end_nonreg_p1 === 0 && simulationData[i-1].end_nonreg_p1 > 0<br>  );<br>  if (nonregDepletion) {<br>    timeline.push({<br>      age: nonregDepletion.age_p1,<br>      year: nonregDepletion.year,<br>      event: 'Non-Registered account depleted',<br>      type: 'depletion'<br>    });<br>  }<br>  <br>  // Find RRIF depletion<br>  const rrifDepletion = simulationData.find((y, i) => <br>    i > 0 && y.end_rrif_p1 === 0 && simulationData[i-1].end_rrif_p1 > 0<br>  );<br>  if (rrifDepletion) {<br>    timeline.push({<br>      age: rrifDepletion.age_p1,<br>      year: rrifDepletion.year,<br>      event: 'RRIF/LRIF account depleted',<br>      type: 'depletion'<br>    });<br>  }<br>  <br>  // TFSA status (depletion or final balance)<br>  const tfsaDepletion = simulationData.find((y, i) => <br>    i > 0 && y.end_tfsa_p1 === 0 && simulationData[i-1].end_tfsa_p1 > 0<br>  );<br>  if (tfsaDepletion) {<br>    timeline.push({<br>      age: tfsaDepletion.age_p1,<br>      year: tfsaDepletion.year,<br>      event: 'TFSA depleted',<br>      type: 'depletion'<br>    });<br>  } else {<br>    const finalYear = simulationData[simulationData.length - 1];<br>    timeline.push({<br>      age: finalYear.age_p1,<br>      year: finalYear.year,<br>      event: `TFSA balance: $${finalYear.end_tfsa_p1.toLocaleString()}`,<br>      type: 'balance'<br>    });<br>  }<br>  <br>  return timeline;<br>}<br>```<br><br>**UI Component Structure**:<br>```tsx<br><div className="investment-timeline bg-blue-50 rounded-lg p-6 mb-6"><br>  <h3 className="text-lg font-semibold mb-4">Investment Timeline</h3><br>  <br>  {/* Summary */}<br>  <div className="mb-4 p-4 bg-white rounded-lg border-l-4 border-blue-500"><br>    <p className="text-sm text-gray-600">Your investments last until:</p><br>    <p className="text-2xl font-bold text-blue-900"><br>      Age {lastInvestmentAge} ({lastInvestmentYear})<br>    </p><br>  </div><br>  <br>  {/* Milestones */}<br>  <div className="space-y-3"><br>    {timeline.map(event => (<br>      <div key={event.year} className="flex items-start gap-3"><br>        <div className="flex-shrink-0 w-16 text-right"<br>          <span className="text-sm font-medium">Age {event.age}</span><br>          <span className="text-xs text-gray-500">{event.year}</span><br>        </div><br>        <div className="flex-1 p-3 bg-white rounded-lg"<br>          <p className="text-sm">{event.event}</p><br>        </div><br>      </div><br>    ))}<br>  </div><br></div><br>```<br><br>**Files to Update**:<br>- `webapp/components/simulation/InvestmentTimeline.tsx` (new component)<br>- `webapp/app/(dashboard)/simulation/page.tsx` (integrate timeline)<br>- `webapp/lib/utils/timeline.ts` (timeline calculation logic) |
| **User Impact** | **High** - User explicitly requested this feature. Many users don't understand when their LIRA converts to LRIF or when accounts will deplete. This creates confusion and reduces confidence in the tool. Clear timeline visualization addresses a critical information gap. |
| **Examples** | **Example 1: rightfooty218@gmail.com (Age 67)**<br>Timeline shows:<br>- Age 71 (2030): LIRA converts to LRIF<br>- Age 78 (2037): Non-Registered account depleted<br>- Age 88 (2047): RRIF depleted<br>- Age 95 (2054): TFSA balance $459,193 (never depletes)<br>- **Summary**: "Your investments last until age 95 and beyond"<br><br>**Example 2: User with all accounts depleting**<br>Timeline shows:<br>- Age 71 (2030): LIRA converts to LRIF<br>- Age 75 (2034): Non-Registered account depleted<br>- Age 82 (2041): RRIF depleted<br>- Age 85 (2044): TFSA depleted<br>- **Summary**: "Your investments last until age 85 (2044)" |
| **Priority Justification** | **P1 (High)** because:<br>1. **Direct user request** - Explicitly asked for by user<br>2. **High confusion** - "End date for investments" is unclear to many users<br>3. **LIRA/LRIF education** - Many users don't know about age 71 conversion<br>4. **Quick win** - 5 story points, ~12 hours of work<br>5. **High value** - Improves user understanding and confidence<br>6. **Complements other features** - Works alongside simulation results |
| **Success Metrics** | - [ ] 80%+ of users view investment timeline<br>- [ ] User comprehension survey shows >75% understand when accounts deplete<br>- [ ] Reduction in support questions about "when investments run out"<br>- [ ] User feedback rating >4/5 for timeline feature<br>- [ ] Zero user complaints about missing "end date" after feature launch |
| **Related Stories** | - US-041 (Explain Compound Growth) - Both help users understand results<br>- US-038 (CPP/OAS Timing Bug) - Related to income timing issues |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-041** | **Explain Compound Growth - Why Balances Grow Despite Withdrawals** | **3** | **P2** | **üìã To Do** |
| **Description** | As a user, I want to understand why my investment balances might grow (e.g., $300K ‚Üí $400K) even though I'm withdrawing money every year so that I can trust the simulation results and understand compound interest |
| **User Feedback** | **Source**: Related to rightfooty218@gmail.com feedback (January 30, 2026)<br>**Issue**: User doesn't understand why simulation shows high balances at age 90<br>**Context**: Starting with $302K, ending with $392K at age 90 despite $37K/year withdrawals seems counterintuitive |
| **Acceptance Criteria** | - [ ] Tooltip on balance figures explaining compound interest<br>- [ ] Year-by-year breakdown showing: "Growth vs. Withdrawals"<br>- [ ] Visual indicator when growth rate exceeds withdrawal rate<br>- [ ] Simple explanation: "Your investments grow at 5%/year ($15K), but you only withdraw $10K/year, so your balance increases"<br>- [ ] Link to compound interest calculator or educational resource<br>- [ ] Context-sensitive help based on user's specific growth/withdrawal rates<br>- [ ] Mobile-friendly educational content |
| **Tasks** | - [ ] **Analysis** (1 hour):<br>  - Identify years where balance grows despite withdrawals<br>  - Calculate growth rate vs. withdrawal rate for each year<br>  - Determine when to show growth explanation tooltip<br>- [ ] **Content Writing** (1 hour):<br>  - Write clear explanation of compound interest<br>  - Create example with real numbers<br>  - Write tooltip text for balance figures<br>  - Create "Why is my balance growing?" FAQ entry<br>- [ ] **UI Implementation** (4 hours):<br>  - Add tooltip to balance figures in year-by-year table<br>  - Create "Growth vs. Withdrawals" indicator<br>  - Add visual icon (e.g., üìà) when growth exceeds withdrawals<br>  - Implement modal with detailed explanation<br>  - Link to educational resource<br>  - Make responsive for mobile<br>- [ ] **Testing** (1 hour):<br>  - Test with rightfooty218@gmail.com data (growth scenario)<br>  - Test with depletion scenario (withdrawals > growth)<br>  - Test tooltip functionality<br>  - User testing for comprehension |
| **Technical Notes** | **Growth Calculation Logic**:<br>```javascript<br>function calculateGrowthVsWithdrawal(yearData, previousYearData) {<br>  const growth = (<br>    yearData.growth_rrif_p1 + <br>    yearData.growth_tfsa_p1 + <br>    yearData.growth_nonreg_p1<br>  );<br>  <br>  const withdrawals = (<br>    yearData.withdraw_rrif_p1 + <br>    yearData.withdraw_tfsa_p1 + <br>    yearData.withdraw_nonreg_p1<br>  );<br>  <br>  const netChange = growth - withdrawals;<br>  const growthRate = (growth / previousYearData.net_worth_end) * 100;<br>  const withdrawalRate = (withdrawals / previousYearData.net_worth_end) * 100;<br>  <br>  return {<br>    growth,<br>    withdrawals,<br>    netChange,<br>    growthRate,<br>    withdrawalRate,<br>    isGrowing: netChange > 0<br>  };<br>}<br>```<br><br>**Tooltip Content Example**:<br>"Your investments earned $18,500 this year (5.2% growth), but you only withdrew $12,000 for expenses. The $6,500 difference is why your balance increased. This is the power of compound interest!"<br><br>**Visual Indicator**:<br>```tsx<br>{isGrowing && (<br>  <div className="inline-flex items-center gap-2 text-green-600"><br>    <TrendingUp className="w-4 h-4" /><br>    <span className="text-sm">Growing</span><br>    <Tooltip><br>      <TooltipTrigger><InfoIcon /></TooltipTrigger><br>      <TooltipContent><br>        Your 5% growth rate ($15K) exceeds your withdrawal rate<br>        ($10K), so your balance increases by $5K this year.<br>      </TooltipContent><br>    </Tooltip><br>  </div><br>)}<br>```<br><br>**Files to Update**:<br>- `webapp/components/simulation/YearByYearTable.tsx` - Add growth indicator<br>- `webapp/components/simulation/BalanceTooltip.tsx` - New tooltip component<br>- `webapp/components/simulation/CompoundGrowthModal.tsx` - Detailed explanation modal |
| **User Impact** | **Medium-High** - Many users find it counterintuitive when balances grow despite withdrawals. This creates distrust in the simulation. Clear explanations build confidence and help users understand the power of compound interest. |
| **Examples** | **Example 1: rightfooty218@gmail.com (Balance Growing)**<br>Year 2026 (Age 67):<br>- Starting balance: $302,766<br>- Investment growth: +$15,138 (5%)<br>- Withdrawals: -$6,821<br>- Net change: +$8,317<br>- Ending balance: $311,083<br>**Tooltip**: "Your investments grew by $15,138 (5%), but you only needed $6,821 for expenses. Your balance increased by $8,317."<br><br>**Example 2: Balance Declining**<br>Year 2045 (Age 86):<br>- Starting balance: $180,000<br>- Investment growth: +$9,000 (5%)<br>- Withdrawals: -$35,000<br>- Net change: -$26,000<br>- Ending balance: $154,000<br>**Tooltip**: "Your withdrawals ($35K) exceeded your investment growth ($9K) this year, so your balance decreased by $26K." |
| **Priority Justification** | **P2 (Medium)** because:<br>1. **User confusion** - Growing balances seem counterintuitive<br>2. **Trust issue** - Users may distrust results they don't understand<br>3. **Educational value** - Teaches important retirement planning concept<br>4. **Quick win** - Only 3 story points, ~7 hours of work<br>5. **Complements US-040** - Both help users understand results |
| **Success Metrics** | - [ ] 60%+ of users hover over or click growth tooltips<br>- [ ] User comprehension survey shows >70% understand compound growth<br>- [ ] Reduction in support questions about "why is my balance growing?"<br>- [ ] User feedback rating >4/5 for growth explanation<br>- [ ] Zero user complaints about confusing balance growth |
| **Related Stories** | - US-040 (Investment Timeline) - Both help users understand results<br>- US-027 (Educational Guidance) - General retirement education |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-027** | **Educational Guidance: Withdrawal Order to Save Taxes & Avoid Clawback** | **5** | **P1** | **üìã To Do** |
| **Description** | As a user, I want clear educational guidance about the optimal account withdrawal order (TFSA/RRSP/RRIF/NonReg) so that I can minimize taxes and avoid OAS/GIS clawback throughout my retirement |
| **Acceptance Criteria** | - [ ] Educational tooltip/modal explains withdrawal order strategy<br>- [ ] Visual diagram shows recommended withdrawal sequence<br>- [ ] Explanation of tax implications for each account type<br>- [ ] Guidance on OAS clawback threshold and avoidance<br>- [ ] Guidance on GIS income limits and preservation<br>- [ ] Examples showing tax savings from optimal order<br>- [ ] Context-sensitive help based on user's assets<br>- [ ] Mobile-friendly educational content<br>- [ ] Links to CRA resources for verification<br>- [ ] Accessible to users of all financial literacy levels |
| **Tasks** | - [ ] Research optimal withdrawal order strategies<br>- [ ] Create educational content outline<br>- [ ] Design visual diagram for withdrawal order<br>- [ ] Write clear explanations for each account type<br>- [ ] Document OAS clawback threshold (2026: ~$90,997)<br>- [ ] Document GIS income limits (2026: $22,272 single, $29,424 couple)<br>- [ ] Create examples with real numbers<br>- [ ] Design tooltip/modal component<br>- [ ] Implement contextual help integration<br>- [ ] Review content with tax professional or CPA<br>- [ ] User testing for clarity and comprehension<br>- [ ] Update documentation and help center |
| **Technical Notes** | **Current Withdrawal Strategy Implementation:**<br>Backend: `juan-retirement-app/modules/simulation.py`<br>- Lines 784-793: TFSA prioritization for GIS preservation<br>- Lines 625-642: GIS threshold targeting<br>- Lines 824-850: Income addition calculations<br><br>**Withdrawal Order Best Practices:**<br>1. **Before Age 65 (Pre-OAS/GIS)**:<br>   - TFSA first (tax-free, no impact on benefits)<br>   - NonReg second (capital gains only 50% taxable)<br>   - RRSP/RRIF last (100% taxable)<br><br>2. **Age 65-71 (OAS Started, Pre-RRIF)**:<br>   - TFSA first (preserves GIS eligibility)<br>   - RRSP early withdrawals if income low (income splitting)<br>   - NonReg carefully (watch OAS clawback threshold)<br><br>3. **Age 72+ (RRIF Mandatory)**:<br>   - RRIF minimum required<br>   - TFSA to top up (avoid exceeding clawback threshold)<br>   - NonReg as needed<br><br>**Tax Thresholds 2026:**<br>- OAS Clawback starts: ~$90,997<br>- GIS Single threshold: $22,272<br>- GIS Couple threshold: $29,424<br>- Federal Basic Personal Amount: ~$15,705<br><br>**Example Savings:**<br>Scenario: Couple, $600K assets, low pension income<br>- Poor order (RRSP first): $180K total tax, lose $45K GIS<br>- Optimal order (TFSA first): $120K total tax, keep $42K GIS<br>- **Savings: $60K + $42K = $102K over 30 years** |
| **User Impact** | **Very High** - Many users don't understand withdrawal order strategy. This is a critical knowledge gap that can cost tens of thousands of dollars in unnecessary taxes and lost government benefits. Educational guidance empowers users to make informed decisions. |
| **Examples** | **Example 1: GIS-Eligible Couple**<br>Assets: TFSA $100K, RRSP $150K, NonReg $50K<br>Income: CPP $15K, OAS $8K = $23K total<br>Need: $40K/year<br>Optimal Order:<br>1. TFSA ($17K/year) - keeps income at $23K ‚Üí GIS eligible<br>2. When TFSA depleted, carefully balance RRIF + NonReg<br>Result: Receive $8K-12K GIS for 5-10 years<br><br>**Example 2: High-Asset Couple (OAS Clawback Risk)**<br>Assets: RRSP $800K, TFSA $200K, NonReg $300K<br>Income: CPP $28K, OAS $16K = $44K total<br>Need: $80K/year<br>Optimal Order:<br>1. TFSA ($36K/year) - no tax, no clawback impact<br>2. NonReg (capital gains) - only 50% taxable<br>3. RRIF minimum required at 72<br>Result: Avoid OAS clawback, save $15K-20K in taxes<br><br>**Example 3: Single Low-Income Retiree**<br>Assets: TFSA $80K, RRSP $120K<br>Income: CPP $10K, OAS $8K = $18K total<br>Need: $35K/year<br>Optimal Order:<br>1. TFSA ($17K/year) - stay under GIS threshold ($22,272)<br>2. RRIF minimum at 72<br>Result: Receive $4K GIS annually, maximize government benefits |
| **Dependencies** | - US-025 (Strategy Discoverability) - integrate guidance into strategy selector<br>- US-026 (Display Current Strategy) - show guidance when strategy selected<br>- US-023 (GIS Testing) - ensure GIS thresholds accurate |
| **Success Metrics** | - [ ] 80%+ of users view educational content before running simulation<br>- [ ] User comprehension survey shows >70% understand withdrawal order<br>- [ ] Reduction in support questions about withdrawal strategies<br>- [ ] Positive user feedback on helpfulness (>4/5 rating)<br>- [ ] Users able to explain why TFSA-first is often optimal |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-028** | **Update Help Section & Documentation Center** | **8** | **P2** | **üìã To Do** |
| **Description** | As a user, I want a comprehensive, up-to-date help section so that I can learn how to use RetireZest effectively and understand retirement planning concepts |
| **Acceptance Criteria** | - [ ] Help section accessible from main navigation<br>- [ ] Topics organized by category (Getting Started, Features, Concepts, FAQ)<br>- [ ] Search functionality works across all help articles<br>- [ ] Help content covers all major features<br>- [ ] Each help article has clear examples and screenshots<br>- [ ] Mobile-responsive help center<br>- [ ] Contextual help links from relevant pages<br>- [ ] Video tutorials for key workflows<br>- [ ] Glossary of retirement planning terms<br>- [ ] Contact support option visible |
| **Tasks** | - [ ] Audit existing help content (if any)<br>- [ ] Create help center structure/sitemap<br>- [ ] Write help articles for key features:<br>  - [ ] Profile setup and data entry<br>  - [ ] Asset management (TFSA, RRSP, RRIF, NonReg)<br>  - [ ] Income sources (CPP, OAS, pensions)<br>  - [ ] Expense tracking and one-time expenses<br>  - [ ] Withdrawal strategies explained<br>  - [ ] What-If scenarios<br>  - [ ] GIS eligibility and optimization<br>  - [ ] Health score interpretation<br>  - [ ] Reading simulation results<br>  - [ ] Premium features<br>- [ ] Create FAQ section with common questions<br>- [ ] Add retirement planning glossary<br>- [ ] Implement search functionality<br>- [ ] Add contextual help links throughout app<br>- [ ] Create video tutorials (5-10 minutes each)<br>- [ ] Design help center UI/UX<br>- [ ] Implement help center frontend<br>- [ ] User testing for clarity and completeness<br>- [ ] SEO optimization for help articles |
| **Technical Notes** | **Help Center Implementation Options:**<br><br>**Option 1: In-App Help Center**<br>- Create `/help` route in Next.js<br>- Help articles as MDX files<br>- Search using Algolia or custom solution<br>- Full control over design/UX<br><br>**Option 2: Third-Party Solution**<br>- Use Intercom, Zendesk, or Help Scout<br>- Faster implementation<br>- Built-in analytics and search<br>- Monthly subscription cost<br><br>**Option 3: Hybrid Approach**<br>- In-app contextual help (tooltips, modals)<br>- External documentation site (Docusaurus, GitBook)<br>- Video hosting on YouTube/Vimeo<br><br>**Recommended: Option 3 (Hybrid)**<br>- Best user experience<br>- Cost-effective<br>- Easy to maintain and update<br><br>**Content Categories:**<br>1. Getting Started (5 articles)<br>   - Welcome to RetireZest<br>   - Quick start guide<br>   - Understanding your first simulation<br>   - Common questions for new users<br>   - Tour of key features<br><br>2. Managing Your Profile (8 articles)<br>   - Personal information<br>   - Assets (TFSA, RRSP, RRIF, NonReg)<br>   - Income sources (CPP, OAS, pensions, employment)<br>   - Expenses (monthly, annual, one-time)<br>   - Real estate and property<br>   - Partner/spouse information<br>   - Settings and preferences<br>   - Data privacy and security<br><br>3. Running Simulations (6 articles)<br>   - How to run your first simulation<br>   - Understanding withdrawal strategies<br>   - Using What-If scenarios<br>   - Reading simulation results<br>   - Health score explained<br>   - Saving and comparing scenarios<br><br>4. Advanced Features (5 articles)<br>   - GIS optimization strategies<br>   - Tax optimization techniques<br>   - OAS clawback avoidance<br>   - Income splitting strategies<br>   - Premium features guide<br><br>5. Retirement Planning Concepts (10 articles)<br>   - TFSA vs RRSP vs RRIF<br>   - CPP and OAS benefits<br>   - Guaranteed Income Supplement (GIS)<br>   - RRIF minimum withdrawals<br>   - Tax brackets and optimization<br>   - Inflation and purchasing power<br>   - Estate planning basics<br>   - Withdrawal order strategies<br>   - Retirement age considerations<br>   - Market scenarios and risk<br><br>6. FAQ (15-20 questions)<br>   - Is my data secure?<br>   - How accurate are the simulations?<br>   - What withdrawal strategy should I use?<br>   - How does GIS optimization work?<br>   - Can I export my results?<br>   - What's the difference between scenarios?<br>   - How often should I update my profile?<br>   - etc. |
| **User Impact** | **Medium-High** - Good documentation reduces support burden, improves user onboarding, and builds trust. Users who understand the tool are more likely to remain active and recommend it to others. |
| **Dependencies** | - US-027 (Withdrawal Order Guidance) - include in help content<br>- US-025 (Strategy Discoverability) - document strategies in help<br>- All major features should be stable before documenting |
| **Success Metrics** | - [ ] Help center visited by 40%+ of new users<br>- [ ] Average help session duration >3 minutes (reading content)<br>- [ ] Support ticket volume decreases by 30%<br>- [ ] User satisfaction with help content >4/5<br>- [ ] 90%+ of users can find answers to common questions<br>- [ ] Search successfully finds relevant content 80%+ of time |

**Total Story Points**: 15 ‚Üí 20 ‚Üí 28 ‚Üí 33 ‚Üí 38 ‚Üí 40
**User Stories**: US-008 (‚úÖ), US-009, US-010 (‚úÖ), US-025 (‚úÖ), US-026 (‚úÖ), US-027, US-028, US-029 (‚úÖ), US-038, US-039, US-042, US-049

---

#### Epic 5: Simulation Accuracy & Features

**CRITICAL BUG IDENTIFIED**: February 4, 2026 - Employment income not counted before retirement age. See [DANIEL_GONZALEZ_CASHFLOW_GAP_ANALYSIS.md](DANIEL_GONZALEZ_CASHFLOW_GAP_ANALYSIS.md) for full analysis.

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-072** | **üî¥ CRITICAL: Fix Employment Income Not Applied Before Retirement** | **3** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a user with employment income who hasn't retired yet, I want my employment income to be properly included in simulation years before my retirement age so that my cash flow projections are accurate and don't show false gaps |
| **Bug Report** | **User**: danjgonzalezm@gmail.com (Daniel Gonzalez)<br>**Issue**: Simulation shows cash flow GAPS and 1% success rate despite $200K employment income<br>**Evidence**: Tax = $0 in years 2026-2027 (ages 64-65) proves NO income being counted<br>**Impact**: Assets depleted unnecessarily for 2 years, causing false failures<br>**Root Cause**: Python backend `/juan-retirement-app/modules/simulation.py:1357` checks `startAge` but not `endAge` for other_incomes. Employment income with no explicit startAge/endAge may not be applied correctly. |
| **Acceptance Criteria** | - [ ] Employment income applies to ALL years from current age to retirement age - 1<br>- [ ] Employment income does NOT apply at/after retirement age<br>- [ ] Fix handles income with null startAge (defaults to current age)<br>- [ ] Fix handles income with null endAge for employment (defaults to retirement age)<br>- [ ] Year-by-year results show correct taxable income for pre-retirement years<br>- [ ] Test case: Daniel Gonzalez (age 64, retire 66, $200K employment) shows NO gaps in 2026-2027<br>- [ ] Tax > $0 in pre-retirement years (proves income is counted)<br>- [ ] Success rate improves from 1% to 90%+ for Daniel's profile |
| **Tasks** | - [ ] **Reproduce Bug** (1 hour):<br>  - Create test user with Daniel's profile (age 64, retire 66, $200K employment, $58K expenses)<br>  - Run simulation, capture year-by-year results<br>  - Confirm tax = $0 in ages 64-65 (bug present)<br>  - Confirm tax > $0 at age 66+ (retirement logic works)<br>- [ ] **Fix Python Backend** (2 hours):<br>  - Open `/juan-retirement-app/modules/simulation.py`<br>  - Locate income application logic (line ~1349-1369)<br>  - Add endAge check to income filtering<br>  - Special handling for employment income type:<br>    - If type == 'employment' and no endAge, set endAge = retirementAge<br>    - If no startAge, set startAge = currentAge<br>  - Apply income only if startAge <= age < endAge<br>- [ ] **Test Fix** (1 hour):<br>  - Re-run simulation with Daniel's profile<br>  - Verify tax > $0 in 2026-2027 (income now counted)<br>  - Verify success rate increases to 90%+<br>  - Test with other employment scenarios (retire at 55, 60, 65, 70)<br>  - Ensure fix doesn't break retirement income (CPP, OAS, pension)<br>- [ ] **Deploy & Verify** (30 min):<br>  - Deploy Python backend to production<br>  - Re-run Daniel's simulation (notify him)<br>  - Verify results in database<br>  - Monitor for any errors |
| **Technical Notes** | **Current Code** (`simulation.py:1357`):<br>```python<br># BUG: Only checks startAge, never checks endAge<br>for other_income in other_incomes:<br>    income_start_age = other_income.get('startAge')<br>    <br>    # If no startAge specified, income is active<br>    if income_start_age is None or age >= income_start_age:<br>        annual_amount = other_income.get('amount', 0.0)<br>        other_income_total += annual_amount<br>```<br><br>**Fixed Code**:<br>```python<br># FIX: Check both startAge and endAge<br>for other_income in other_incomes:<br>    income_type = other_income.get('type', '')<br>    income_start_age = other_income.get('startAge')<br>    income_end_age = other_income.get('endAge')<br>    <br>    # Special handling for employment income<br>    if income_type == 'employment':<br>        if income_start_age is None:<br>            income_start_age = person.current_age<br>        if income_end_age is None:<br>            income_end_age = person.retirement_age<br>    <br>    # Check if income is active this year<br>    is_active = True<br>    if income_start_age is not None and age < income_start_age:<br>        is_active = False<br>    if income_end_age is not None and age >= income_end_age:<br>        is_active = False<br>    <br>    if is_active:<br>        annual_amount = other_income.get('amount', 0.0)<br>        # Apply inflation...<br>        other_income_total += annual_amount<br>```<br><br>**Test Case Data** (Daniel Gonzalez):<br>```json<br>{<br>  "person1": {<br>    "currentAge": 64,<br>    "retirementAge": 66,<br>    "lifeExpectancy": 85<br>  },<br>  "assets": [<br>    {"type": "rrsp", "balance": 500000},<br>    {"type": "tfsa", "balance": 100000},<br>    {"type": "nonreg", "balance": 50000},<br>    {"type": "property", "balance": 400000}<br>  ],<br>  "income": [<br>    {"type": "employment", "amount": 200000, "startAge": null, "endAge": null}<br>  ],<br>  "expenses": [<br>    {"amount": 58000}<br>  ]<br>}<br>```<br><br>**Expected Results After Fix**:<br>```<br>Year 2026 (Age 64):<br>  ‚úÖ Employment Income: $200,000<br>  ‚úÖ Tax: ~$60,000 (not $0!)<br>  ‚úÖ Net Cash Flow: +$82,000<br>  ‚úÖ Success: ‚úì<br><br>Year 2027 (Age 65):<br>  ‚úÖ Employment Income: $200,000<br>  ‚úÖ Tax: ~$60,000<br>  ‚úÖ Net Cash Flow: +$82,000<br>  ‚úÖ Success: ‚úì<br><br>Year 2028 (Age 66 - Retired):<br>  ‚úÖ Employment Income: $0<br>  ‚úÖ CPP/OAS Income: ~$23,000<br>  ‚úÖ Withdrawals: ~$35,000<br>  ‚úÖ Tax: ~$10,796<br>  ‚úÖ Success: ‚úì<br>``` |
| **User Impact** | **CRITICAL** - Affects ALL users with employment income before retirement:<br>- Creates false cash flow gaps<br>- Artificially lowers success rates (Daniel: 1% instead of 95%+)<br>- Assets depleted unnecessarily before retirement<br>- Users see "failure" when they should see "success"<br>- Undermines trust in simulation accuracy<br>- Similar to US-038 CPP/OAS bug (income timing issue) |
| **Priority Justification** | **P0 (Critical)** because:<br>1. **Active user impact** - Daniel ran 3 simulations today, all wrong<br>2. **Core functionality broken** - Employment income is fundamental<br>3. **Data-driven evidence** - Screenshot proves bug (tax = $0)<br>4. **Systemic issue** - Affects all pre-retirees with employment income<br>5. **Quick fix** - 3 story points, ~4 hours total<br>6. **High confidence** - Root cause identified in code (line 1357) |
| **Success Metrics** | - [ ] Daniel's simulation shows tax > $0 in 2026-2027<br>- [ ] Daniel's success rate increases from 1% to 90%+<br>- [ ] No cash flow gaps in pre-retirement years for any user with employment income<br>- [ ] Zero regression - retirement income (CPP, OAS, pension) still works<br>- [ ] User feedback: "My simulation looks correct now" |
| **Related Stories** | - US-038 (CPP/OAS Income Timing Bug) - Similar income timing issue, fixed Sprint 4<br>- US-011 (GIS Strategy) - Related to income calculations<br>- US-040 (Investment Timeline) - Both affect pre-retirees |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-073** | **Auto-Stop rental_income_annual When Property Is Sold (Downsizing)** | **2** | **P1** üü° | **üìã To Do** |
| **Description** | As a user who plans to sell my rental property via downsizing, I want the rental income to automatically stop when the property is sold so that my retirement projections don't incorrectly count rental income after the property is gone |
| **Bug Report** | **Discovery**: February 4, 2026 - Investigation into rental income and property sales<br>**Issue**: `handle_downsizing()` function at `real_estate.py:111-229` updates property status when selling but does NOT clear `person.rental_income_annual`<br>**Impact**: Rental income continues indefinitely even after property is sold (when `new_home_cost == 0`)<br>**Root Cause**: `handle_downsizing()` only updates property values and mortgage, but never sets `rental_income_annual = 0.0` |
| **Acceptance Criteria** | - [ ] When `handle_downsizing()` runs and `new_home_cost == 0` (selling outright), set `person.rental_income_annual = 0.0`<br>- [ ] When `handle_downsizing()` runs and `new_home_cost > 0` (buying new home), optionally clear rental income (unless new property also generates rental income)<br>- [ ] Test case: User with $24K/year rental income sells property at age 70<br>- [ ] Verify rental income stops at age 70 in simulation results<br>- [ ] Verify no regression - property appreciation and capital gains still work<br>- [ ] Documentation updated to explain rental income stops automatically when property is sold |
| **Tasks** | - [ ] **Update handle_downsizing() function** (1 hour):<br>  - Open `/juan-retirement-app/modules/real_estate.py`<br>  - Locate `handle_downsizing()` function (line 111)<br>  - After updating property status (lines 201-218), add rental income logic:<br>    ```python<br>    # Clear rental income when selling property<br>    if new_home_cost == 0:<br>        # Sold outright - no longer have rental income<br>        person.rental_income_annual = 0.0<br>    else:<br>        # Downsized to new home - assume new home doesn't generate rental income<br>        # (User can manually add rental income if new property is also rental)<br>        person.rental_income_annual = 0.0<br>    ```<br>- [ ] **Create test case** (1 hour):<br>  - Test user: Age 65, $24K/year rental income, plans to sell at 70<br>  - Run simulation, verify rental income present at ages 65-69<br>  - Verify rental income = $0 at age 70+<br>  - Verify other income sources (CPP, OAS) still work<br>- [ ] **Deploy & verify** (30 min):<br>  - Deploy Python backend to production<br>  - Test with production data<br>  - Monitor for any errors |
| **Technical Notes** | **Current Code** (`real_estate.py:201-218`):<br>```python<br># Update person's property status<br>if new_home_cost > 0:<br>    # Bought a new home - update values<br>    person.primary_residence_value = new_home_cost<br>    person.primary_residence_purchase_price = new_home_cost<br>    person.primary_residence_mortgage = 0.0<br>    person.primary_residence_monthly_payment = 0.0<br>else:<br>    # Sold outright - no longer have residence<br>    person.has_primary_residence = False<br>    person.primary_residence_value = 0.0<br>    person.primary_residence_purchase_price = 0.0<br>    person.primary_residence_mortgage = 0.0<br>    person.primary_residence_monthly_payment = 0.0<br>```<br><br>**Fixed Code**:<br>```python<br># Update person's property status<br>if new_home_cost > 0:<br>    # Bought a new home - update values<br>    person.primary_residence_value = new_home_cost<br>    person.primary_residence_purchase_price = new_home_cost<br>    person.primary_residence_mortgage = 0.0<br>    person.primary_residence_monthly_payment = 0.0<br>    # Assume new home doesn't generate rental income<br>    person.rental_income_annual = 0.0<br>else:<br>    # Sold outright - no longer have residence<br>    person.has_primary_residence = False<br>    person.primary_residence_value = 0.0<br>    person.primary_residence_purchase_price = 0.0<br>    person.primary_residence_mortgage = 0.0<br>    person.primary_residence_monthly_payment = 0.0<br>    # Clear rental income<br>    person.rental_income_annual = 0.0<br>``` |
| **User Impact** | **MEDIUM** - Affects users who plan to sell rental properties in retirement. Without this fix, projections incorrectly assume rental income continues forever, leading to overly optimistic cash flow projections. |
| **Priority Justification** | **P1 (High)** because:<br>1. **Data accuracy** - Rental income should stop when property is sold<br>2. **Quick fix** - 2 story points, ~2.5 hours total<br>3. **Low risk** - Only affects downsizing scenarios<br>4. **Common scenario** - Many retirees downsize and sell rental properties |
| **Success Metrics** | - [ ] Rental income stops automatically when property is sold<br>- [ ] Test cases pass for selling at various ages<br>- [ ] No regression - property sale proceeds and capital gains still work<br>- [ ] Documentation updated |
| **Related Stories** | - US-060 (LIF/LRIF Asset Types) - Similar asset lifecycle tracking<br>- US-074 (Auto-stop rental income in other_incomes) - Related rental income fix |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-074** | **Add Automatic endAge for Rental Income in other_incomes Array** | **3** | **P1** üü° | **üìã To Do** |
| **Description** | As a user who adds rental income via the Income table (other_incomes array), I want the system to help me automatically stop rental income when I plan to sell the property so that I don't have to manually remember to set endAge |
| **Bug Report** | **Discovery**: February 4, 2026 - Investigation into rental income and property sales<br>**Issue**: `other_incomes` array with `type='rental'` has NO automatic `endAge` default (unlike employment income which defaults to retirement age)<br>**Impact**: Rental income from `other_incomes` array continues forever unless user manually sets `endAge`<br>**Root Cause**: `simulation.py:1368-1374` has special handling for employment income to default `endAge` to `cpp_start_age`, but no such handling exists for rental income |
| **Acceptance Criteria** | - [ ] UI shows option to link rental income to property sale (downsizing)<br>- [ ] If rental income is linked to downsizing, automatically set `endAge = downsize_year_age`<br>- [ ] If not linked, rental income continues forever (current behavior, intended for investment properties)<br>- [ ] Frontend validation: If rental income entered, ask "Will you sell this property?" Yes ‚Üí set endAge, No ‚Üí leave endAge null<br>- [ ] Test case: User adds $24K rental income, plans to sell property at age 70<br>- [ ] Verify rental income stops at age 70 in simulation results<br>- [ ] Documentation explains rental income lifecycle options |
| **Tasks** | - [ ] **Update Python backend** (2 hours):<br>  - Open `/juan-retirement-app/modules/simulation.py`<br>  - Locate income processing logic (line 1360-1399)<br>  - Add special handling for rental income type:<br>    ```python<br>    # Special handling for rental income: link to downsizing if applicable<br>    if income_type == 'rental':<br>        if income_end_age is None and person.plan_to_downsize:<br>            # Link rental income to property sale<br>            years_until_downsize = person.downsize_year - hh.start_year<br>            rental_end_age = person.start_age + years_until_downsize<br>            income_end_age = rental_end_age<br>    ```<br>- [ ] **Update frontend UI** (1 hour):<br>  - Add checkbox to Income form: "This rental income will stop when I sell the property"<br>  - If checked, link to downsizing year<br>  - If unchecked, rental income continues forever<br>  - Help text: "Check this if you plan to sell the rental property. Otherwise, rental income continues indefinitely."<br>- [ ] **Test cases** (1 hour):<br>  - Test 1: Rental income linked to downsizing ‚Üí stops at downsizing year<br>  - Test 2: Rental income NOT linked ‚Üí continues forever<br>  - Test 3: Multiple rental incomes with different endAge values<br>- [ ] **Deploy & verify** (30 min) |
| **Technical Notes** | **Current Code** (`simulation.py:1368-1374`):<br>```python<br># Special handling for employment income: defaults to retirement age<br>if income_type == 'employment':<br>    if income_start_age is None:<br>        income_start_age = person.start_age<br>    if income_end_age is None:<br>        income_end_age = person.cpp_start_age<br>```<br><br>**Proposed Code**:<br>```python<br># Special handling for employment income<br>if income_type == 'employment':<br>    if income_start_age is None:<br>        income_start_age = person.start_age<br>    if income_end_age is None:<br>        income_end_age = person.cpp_start_age<br><br># Special handling for rental income: link to downsizing if applicable<br>if income_type == 'rental':<br>    if income_end_age is None and person.plan_to_downsize:<br>        # Calculate age when property will be sold<br>        years_until_downsize = person.downsize_year - hh.start_year<br>        rental_end_age = person.start_age + years_until_downsize<br>        income_end_age = rental_end_age<br>```<br><br>**Frontend Changes** (`webapp/app/(dashboard)/profile/income/page.tsx`):<br>```tsx<br>// Add to Income form for type='rental'<br>{incomeType === 'rental' && (<br>  <div className="space-y-2"><br>    <label className="flex items-center gap-2"><br>      <input<br>        type="checkbox"<br>        checked={linkToDownsizing}<br>        onChange={(e) => setLinkToDownsizing(e.target.checked)}<br>      /><br>      <span>This rental income will stop when I sell the property</span><br>    </label><br>    <p className="text-sm text-gray-600"><br>      Check this if you plan to sell the rental property. Otherwise,<br>      rental income continues indefinitely.<br>    </p><br>  </div><br>)}<br>``` |
| **User Impact** | **MEDIUM** - Helps users plan rental income lifecycle correctly. Without this, users must manually calculate and set endAge, which is error-prone and non-obvious. |
| **Priority Justification** | **P1 (High)** because:<br>1. **User convenience** - Automates manual calculation<br>2. **Data accuracy** - Prevents rental income from continuing forever incorrectly<br>3. **Moderate complexity** - 3 story points, ~4.5 hours total<br>4. **Complements US-073** - Handles rental income from different source |
| **Success Metrics** | - [ ] UI shows rental income ‚Üí downsizing linkage option<br>- [ ] Rental income automatically stops when linked to downsizing<br>- [ ] Test cases pass for various rental income scenarios<br>- [ ] User feedback: "Easy to understand rental income options" |
| **Related Stories** | - US-073 (Auto-stop rental_income_annual) - Handles rental income from real estate module<br>- US-072 (Employment income endAge) - Similar automatic endAge logic |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-075** | **Connect Real Estate Downsizing UI to Simulation Engine** | **5** | **P0** üî¥ | **üìã To Do** |
| **Description** | As a user who enters real estate downsizing plans in the UI, I want my property sale plans to actually affect my retirement simulation so that I can see accurate cash flow when I sell my home |
| **Bug Report** | **Discovery**: February 4, 2026 - UI investigation during US-073 implementation<br>**Issue**: Real estate UI collects downsizing data (`planToSell`, `plannedSaleYear`, `downsizeTo`) but this data is NEVER passed to the Python simulation API<br>**Impact**: Users can enter downsizing plans, but they're completely ignored in simulations<br>**Root Cause**: PersonInput interface (webapp/lib/types/simulation.ts) does NOT include real estate fields. The prefill API fetches the data from database but doesn't map it to PersonInput<br>**Affected Users**: ALL users who enter downsizing plans in real estate UI |
| **Acceptance Criteria** | - [ ] PersonInput interface extended with real estate fields:<br>  - `has_primary_residence: boolean`<br>  - `primary_residence_value: number`<br>  - `primary_residence_purchase_price: number`<br>  - `primary_residence_mortgage: number`<br>  - `primary_residence_monthly_payment: number`<br>  - `rental_income_annual: number`<br>  - `plan_to_downsize: boolean`<br>  - `downsize_year: number \| null`<br>  - `downsize_new_home_cost: number \| null`<br>  - `downsize_is_principal_residence: boolean`<br>- [ ] Prefill API maps RealEstateAsset data to PersonInput<br>- [ ] Simulation uses real estate data to calculate downsizing proceeds<br>- [ ] Cash flow shows property sale proceeds in correct year<br>- [ ] Rental income stops when property is sold (integrates with US-073)<br>- [ ] Capital gains calculated correctly for investment properties<br>- [ ] Test case: User plans to sell $600K home at age 70, downsize to $300K<br>- [ ] Verify $300K proceeds appear in simulation cash flow at age 70<br>- [ ] Verify rental income stops at age 70 (if property generates rental income) |
| **Tasks** | - [ ] **Update TypeScript types** (30 min):<br>  - Extend PersonInput interface in `webapp/lib/types/simulation.ts`<br>  - Add real estate fields to defaultPersonInput<br>- [ ] **Update prefill API** (2 hours):<br>  - Open `webapp/app/api/simulation/prefill/route.ts`<br>  - Map RealEstateAsset query results to PersonInput fields<br>  - Handle multiple properties (use primary residence, sum rental income from others)<br>  - Handle joint ownership (split values between person1/person2)<br>- [ ] **Update Python Person model** (30 min):<br>  - Verify Person class in `modules/models.py` has all real estate fields<br>  - Fields already exist (lines 141-154) - just need to be populated from UI<br>- [ ] **Test end-to-end** (1.5 hours):<br>  - Create test user with real estate in UI<br>  - Enter downsizing plan: sell at age 70, downsize to $300K<br>  - Run simulation via UI<br>  - Verify simulation results show property sale proceeds<br>  - Verify rental income stops at correct age<br>  - Verify capital gains calculated correctly<br>- [ ] **Documentation** (30 min):<br>  - Update API_REFERENCE.md with real estate fields<br>  - Document mapping logic in prefill route<br>  - Add example request/response with real estate data |
| **Technical Notes** | **Current State - Data Flow**:<br>1. ‚úÖ User enters real estate data in UI (`/profile/real-estate`)<br>2. ‚úÖ Data saved to `RealEstateAsset` table in database<br>3. ‚úÖ Prefill API fetches data: `realEstateAssets = await prisma.realEstateAsset.findMany(...)`<br>4. ‚ùå **MISSING**: Data NOT mapped to PersonInput<br>5. ‚ùå **MISSING**: PersonInput doesn't have real estate fields<br>6. ‚ùå Python simulation never receives real estate data<br><br>**What Works (US-073 fix)**:<br>- Rental income from `monthlyRentalIncome` field IS converted to annual and added to `other_incomes` array (lines 229-257)<br>- This flows through to simulation correctly<br>- US-073 fix clears `rental_income_annual` when property sold<br><br>**What's Broken**:<br>- Downsizing plans (`planToSell`, `plannedSaleYear`, `downsizeTo`) are IGNORED<br>- `handle_downsizing()` function never executes because data never reaches it<br>- Property sale proceeds never appear in cash flow<br>- Capital gains never calculated<br><br>**Required Mapping Logic** (`prefill/route.ts`):<br>```typescript<br>// Get primary residence (first property with isPrincipalResidence = true or first property)<br>const primaryResidence = realEstateAssets.find(p => p.isPrincipalResidence) || realEstateAssets[0];<br><br>if (primaryResidence) {<br>  const owner = primaryResidence.owner || 'person1';<br>  const ownershipShare = primaryResidence.ownershipPercent / 100;<br>  <br>  // Determine which person to assign to<br>  const targetPerson = owner === 'person2' ? person2Input : person1Input;<br>  <br>  if (targetPerson) {<br>    targetPerson.has_primary_residence = true;<br>    targetPerson.primary_residence_value = primaryResidence.currentValue * ownershipShare;<br>    targetPerson.primary_residence_purchase_price = (primaryResidence.purchasePrice || 0) * ownershipShare;<br>    targetPerson.primary_residence_mortgage = (primaryResidence.mortgageBalance || 0) * ownershipShare;<br>    targetPerson.primary_residence_monthly_payment = (primaryResidence.monthlyMortgagePayment || 0) * ownershipShare;<br>    <br>    // Rental income - already handled in other_incomes array (lines 229-257)<br>    // but also set rental_income_annual for backward compatibility<br>    targetPerson.rental_income_annual = (primaryResidence.monthlyRentalIncome || 0) * 12 * ownershipShare;<br>    <br>    // Downsizing plan<br>    if (primaryResidence.planToSell && primaryResidence.plannedSaleYear) {<br>      targetPerson.plan_to_downsize = true;<br>      targetPerson.downsize_year = primaryResidence.plannedSaleYear;<br>      targetPerson.downsize_new_home_cost = (primaryResidence.downsizeTo || 0) * ownershipShare;<br>      targetPerson.downsize_is_principal_residence = primaryResidence.isPrincipalResidence;<br>    }<br>  }<br>}<br>```<br><br>**PersonInput Type Extension** (`webapp/lib/types/simulation.ts`):<br>```typescript<br>export interface PersonInput {<br>  // ... existing fields ...<br>  <br>  // Real estate (NEW)<br>  has_primary_residence?: boolean;<br>  primary_residence_value?: number;<br>  primary_residence_purchase_price?: number;<br>  primary_residence_mortgage?: number;<br>  primary_residence_monthly_payment?: number;<br>  rental_income_annual?: number;<br>  plan_to_downsize?: boolean;<br>  downsize_year?: number \| null;<br>  downsize_new_home_cost?: number \| null;<br>  downsize_is_principal_residence?: boolean;<br>}<br>```<br><br>**Files to Update**:<br>- `webapp/lib/types/simulation.ts` - Add real estate fields to PersonInput<br>- `webapp/app/api/simulation/prefill/route.ts` - Map RealEstateAsset to PersonInput<br>- `webapp/docs/API_REFERENCE.md` - Document new fields |
| **User Impact** | **CRITICAL** - This is a MAJOR gap. Users enter downsizing plans expecting them to affect their retirement simulation, but they're completely ignored. This could lead to incorrect retirement planning decisions. |
| **Examples** | **Example 1: Downsizing from $600K to $300K**<br>User Input (UI):<br>- Property value: $600,000<br>- Plan to sell: Yes<br>- Sale year: 2031 (age 70)<br>- Downsize to: $300,000<br>- Is principal residence: Yes<br><br>Expected Simulation Result:<br>- Age 70 (2031): Property sale proceeds $300K added to non-registered account<br>- Age 70+: No mortgage payments (was $0 already)<br>- Age 70+: Rental income stops if property was generating rental income<br>- Capital gains tax: $0 (principal residence exemption)<br><br>Current Simulation Result:<br>- ‚ùå Property sale IGNORED<br>- ‚ùå $300K proceeds NEVER appear in cash flow<br>- ‚ùå User retirement projection is INCORRECT<br><br>**Example 2: Selling Rental Property**<br>User Input (UI):<br>- Rental property value: $500,000<br>- Purchase price: $300,000<br>- Plan to sell: Yes<br>- Sale year: 2035 (age 74)<br>- Downsize to: $0 (selling outright)<br>- Is principal residence: No (investment property)<br>- Monthly rental income: $2,000<br><br>Expected Simulation Result:<br>- Ages 65-73: Rental income $24,000/year<br>- Age 74 (2035): Property sale proceeds added to investments<br>- Age 74: Capital gains = $200K, Taxable gain = $100K (50%), Tax = ~$40K<br>- Age 74: Net proceeds = $500K - $40K = $460K added to non-registered<br>- Age 75+: Rental income = $0 (property sold)<br><br>Current Simulation Result:<br>- ‚úÖ Rental income $24,000/year (works via other_incomes array)<br>- ‚ùå Property sale IGNORED<br>- ‚ùå Rental income continues forever (US-074 bug)<br>- ‚ùå Capital gains NEVER calculated<br>- ‚ùå User projection is INCORRECT |
| **Priority Justification** | **P0 (Critical)** because:<br>1. **Major feature gap** - Core real estate feature is non-functional<br>2. **User trust issue** - Users expect downsizing plans to work<br>3. **Data accuracy** - Projections are wrong for users with downsizing plans<br>4. **Quick fix** - Only 5 story points, ~5 hours of work<br>5. **Prerequisite for US-073 & US-074** - Those fixes only work if data flows to simulation<br>6. **High user impact** - Real estate is largest asset for most retirees |
| **Success Metrics** | - [ ] All real estate fields flow from UI ‚Üí Database ‚Üí Prefill API ‚Üí Python API<br>- [ ] Downsizing proceeds appear in simulation cash flow<br>- [ ] Capital gains calculated correctly for investment properties<br>- [ ] Rental income stops at correct year (integrates with US-073)<br>- [ ] Test cases pass for various downsizing scenarios<br>- [ ] User feedback: "Downsizing plan affected my simulation correctly" |
| **Related Stories** | - US-073 (Auto-stop rental_income_annual) - Depends on this data flow<br>- US-074 (Auto-stop rental in other_incomes) - Depends on this data flow<br>- US-037 (Real Estate Management) - Broader real estate features<br>- US-072 (Employment income) - Similar data flow pattern |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-011** | **GIS Strategy Assessment Card** | **8** | **P1** | **‚úÖ Done** |
| **Description** | As a low-income retiree, I want to see if I qualify for GIS and understand the strategy recommendations so that I can maximize my retirement income |
| **Acceptance Criteria** | - [x] Card shows GIS eligibility<br>- [x] Displays recommended strategy<br>- [x] Explains why strategy is recommended<br>- [x] Shows estimated GIS amounts<br>- [x] Accessible color contrast |
| **Status** | Completed in commit 4b78963 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-012** | **Health Score Bug Fixes** | **5** | **P0** | **‚úÖ Done** |
| **Description** | As a user, I want my simulation health score to accurately reflect my retirement plan success so that I can trust the recommendations |
| **Acceptance Criteria** | - [x] Health score calculation fixed<br>- [x] Status badges show correct status<br>- [x] plan_success flag calculated correctly<br>- [x] No negative account balances |
| **Status** | Completed in commit f265820 |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-013** | **RRIF Strategy Validation** | **8** | **P1** | **üìã To Do** |
| **Description** | As a sophisticated user, I want to validate that RRIF withdrawal strategies are working correctly so that I can trust the tax optimization |
| **Acceptance Criteria** | - [ ] All RRIF strategies tested with real scenarios<br>- [ ] Withdrawals match CRA minimum requirements<br>- [ ] OAS clawback avoidance verified<br>- [ ] Income splitting calculations correct<br>- [ ] Documentation of each strategy's logic |
| **Tasks** | - [ ] Create test scenarios for each strategy<br>- [ ] Run simulations and validate outputs<br>- [ ] Compare against manual calculations<br>- [ ] Document validation results<br>- [ ] Fix any discrepancies found |
| **Reference** | See RRIF_STRATEGY_VALIDATION_REPORT.md |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-031** | **Evaluate Early Retirement Feature Value** | **5** | **P2** | **üìã To Do** |
| **Description** | As a product owner, I want to evaluate whether the early retirement calculator provides meaningful value to users so that we can decide whether to invest in improving it or deprecate it |
| **Acceptance Criteria** | - [ ] Usage analytics reviewed (how many users access early retirement feature?)<br>- [ ] User feedback collected (surveys, interviews with users who used it)<br>- [ ] Feature accuracy assessed (does it provide accurate results?)<br>- [ ] Value proposition clarified (what problem does it solve?)<br>- [ ] Comparison with main simulation feature (is it redundant?)<br>- [ ] Recommendation made (keep, improve, or deprecate)<br>- [ ] Decision documented with rationale |
| **Tasks** | - [ ] Review analytics:<br>  - [ ] How many users access /early-retirement page?<br>  - [ ] Completion rate (how many fill out the form?)<br>  - [ ] Retention: Do users who use it stay longer?<br>  - [ ] Conversion: Does it lead to premium subscriptions?<br><br>- [ ] User research:<br>  - [ ] Survey users who used early retirement feature<br>  - [ ] Interview 3-5 users for qualitative feedback<br>  - [ ] Ask: "What value did you get from this feature?"<br>  - [ ] Ask: "How does it compare to the main simulation?"<br><br>- [ ] Technical assessment:<br>  - [ ] Review calculation accuracy<br>  - [ ] Compare with main simulation results<br>  - [ ] Identify any bugs or issues<br>  - [ ] Assess maintenance burden (code complexity)<br><br>- [ ] Feature comparison:<br>  - [ ] What does early retirement do that main simulation doesn't?<br>  - [ ] Is there overlap/redundancy?<br>  - [ ] Could main simulation replace it with minor changes?<br><br>- [ ] Recommendation:<br>  - [ ] Option A: Keep as-is (if high value, low maintenance)<br>  - [ ] Option B: Improve (if high potential, needs work)<br>  - [ ] Option C: Deprecate (if low value, high maintenance)<br>  - [ ] Document decision with data and rationale |
| **Technical Notes** | **Current Implementation:**<br>- Route: `/early-retirement`<br>- API: `/api/early-retirement/calculate`, `/api/early-retirement/profile`<br>- Component: `app/(dashboard)/early-retirement/page.tsx`<br><br>**Questions to Answer:**<br>1. Usage: How many monthly active users?<br>2. Accuracy: Does it match main simulation results?<br>3. Uniqueness: What's different from main simulation?<br>4. Maintenance: How much code is dedicated to this?<br>5. Value: Would users miss it if we removed it?<br><br>**Data Sources:**<br>- Google Analytics or similar (page views, time on page)<br>- Database: Count users who hit `/api/early-retirement/*`<br>- User feedback: In-app surveys, email outreach<br>- Support tickets: Any issues reported with early retirement?<br><br>**Hypothesis:**<br>Early retirement feature may be redundant if main simulation can handle early retirement scenarios. Evaluate if consolidation makes sense. |
| **User Impact** | **Medium** - If feature is low-value, deprecating it simplifies the product. If high-value, we should invest in improving it. Need data to decide. |
| **Success Metrics** | - [ ] Usage data collected for last 90 days<br>- [ ] At least 5 users surveyed<br>- [ ] Feature accuracy verified (matches main simulation within 5%)<br>- [ ] Clear recommendation made (keep/improve/deprecate)<br>- [ ] Decision documented and shared with team |
| **Dependencies** | - Analytics access (Google Analytics, Vercel Analytics, or similar)<br>- Database access to query API usage<br>- User contact list for surveys/interviews<br>- Product roadmap context (what else are we building?) |
| **Possible Outcomes** | **Outcome 1: High Value ‚Üí Keep & Improve**<br>- Evidence: High usage (>20% of users), positive feedback, unique value<br>- Action: Add to roadmap for improvements<br>- Investment: 8-13 story points for enhancements<br><br>**Outcome 2: Medium Value ‚Üí Keep As-Is**<br>- Evidence: Moderate usage (5-20% of users), neutral feedback<br>- Action: Maintain but don't prioritize improvements<br>- Investment: Bug fixes only<br><br>**Outcome 3: Low Value ‚Üí Deprecate**<br>- Evidence: Low usage (<5% of users), negative/no feedback, redundant with main simulation<br>- Action: Plan deprecation over 2-3 months<br>- Investment: 2-3 story points for graceful sunset (notifications, redirects) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-029** | **Modularize Simulation Routine** | **13** | **P2** | **üìã Backlog** |
| **Description** | As a developer, I want the simulation routine refactored into smaller, modular functions so that the code is easier to maintain, test, and extend |
| **Acceptance Criteria** | - [ ] simulation.py refactored into logical modules (tax calculations, withdrawals, benefits, cash flow)<br>- [ ] Each module has clear single responsibility<br>- [ ] Module interfaces well-defined with type hints<br>- [ ] Unit tests added for each module (>80% coverage)<br>- [ ] No change in simulation output (regression tests pass)<br>- [ ] Code complexity reduced (cyclomatic complexity <10 per function)<br>- [ ] Documentation added for each module |
| **Tasks** | - [ ] Analyze current simulation.py structure (~2800 lines)<br>- [ ] Design modular architecture (modules: taxes, withdrawals, benefits, cash_flow, strategy)<br>- [ ] Extract tax calculation logic into taxes.py module<br>- [ ] Extract withdrawal logic into withdrawals.py module<br>- [ ] Extract government benefits logic into benefits.py module<br>- [ ] Extract cash flow calculations into cash_flow.py module<br>- [ ] Extract strategy logic into strategy.py module<br>- [ ] Create comprehensive regression test suite<br>- [ ] Refactor simulation.py to use new modules<br>- [ ] Run regression tests (compare old vs new output)<br>- [ ] Fix any discrepancies found<br>- [ ] Update unit tests for each module<br>- [ ] Update documentation and code comments<br>- [ ] Performance benchmark (ensure no slowdown) |
| **Technical Notes** | **Current State:**<br>- `juan-retirement-app/modules/simulation.py` is ~2800 lines<br>- Contains tax calculations, withdrawal strategies, GIS logic, RRIF calculations, cash flow, all in one file<br>- High cyclomatic complexity makes testing difficult<br>- Adding new features requires navigating large monolithic file<br><br>**Proposed Modular Architecture:**<br>```<br>juan-retirement-app/modules/<br>‚îú‚îÄ‚îÄ simulation.py (orchestrator, main run_simulation function)<br>‚îú‚îÄ‚îÄ taxes.py (federal/provincial tax calculations)<br>‚îú‚îÄ‚îÄ withdrawals.py (TFSA, RRSP, RRIF, NonReg withdrawal logic)<br>‚îú‚îÄ‚îÄ benefits.py (CPP, OAS, GIS calculations)<br>‚îú‚îÄ‚îÄ cash_flow.py (annual cash flow, balance tracking)<br>‚îú‚îÄ‚îÄ strategy.py (withdrawal strategy implementations)<br>‚îî‚îÄ‚îÄ types.py (shared type definitions)<br>```<br><br>**Key Functions to Extract:**<br>1. Tax Calculations (~300 lines)<br>   - calculate_federal_tax()<br>   - calculate_provincial_tax()<br>   - calculate_total_tax()<br><br>2. Withdrawal Logic (~500 lines)<br>   - withdraw_from_tfsa()<br>   - withdraw_from_rrsp()<br>   - withdraw_from_rrif()<br>   - withdraw_from_nonreg()<br>   - apply_withdrawal_strategy()<br><br>3. Government Benefits (~400 lines)<br>   - calculate_cpp()<br>   - calculate_oas()<br>   - calculate_gis()<br>   - apply_oas_clawback()<br><br>4. Cash Flow (~300 lines)<br>   - calculate_annual_cash_flow()<br>   - update_account_balances()<br>   - track_withdrawals()<br><br>5. Strategy Logic (~400 lines)<br>   - minimize_income_strategy()<br>   - balanced_income_strategy()<br>   - early_rrif_strategy()<br>   - max_tfsa_first_strategy()<br><br>**Benefits:**<br>- Easier to write unit tests for isolated functions<br>- Reduced cognitive load when reading code<br>- Easier to add new withdrawal strategies<br>- Easier to fix bugs (smaller search space)<br>- Better code reusability<br>- Easier onboarding for new developers<br><br>**Risks:**<br>- Regression bugs if refactoring introduces subtle changes<br>- Must maintain exact same simulation output<br>- Need comprehensive test coverage before refactoring |
| **User Impact** | **Low (Direct)** - No user-facing changes<br>**High (Indirect)** - Improved code quality enables faster feature development, fewer bugs, easier bug fixes |
| **Dependencies** | - US-015 (Unit Test Coverage) - should establish test baseline first<br>- US-013 (RRIF Strategy Validation) - ensures strategies work correctly before refactoring |
| **Success Metrics** | - [ ] All regression tests pass (100% output match)<br>- [ ] Code complexity reduced by 50%+<br>- [ ] Unit test coverage increased from <20% to >80%<br>- [ ] Average function length reduced from ~150 lines to <50 lines<br>- [ ] Developer velocity increases in Sprint 4+ (faster feature development) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-023** | **AI-Powered GIS Enhancement - Testing, Verification & Deployment** | **13** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want comprehensive testing, verification, and production deployment of the AI-powered GIS strategy enhancements so that low-income retirees receive accurate, trustworthy advice |
| **Acceptance Criteria** | - [ ] All GIS calculation logic verified against CRA 2026 rates<br>- [ ] TFSA prioritization strategy tested with multiple scenarios<br>- [ ] GIS threshold targeting validated (single vs couple thresholds)<br>- [ ] GIS income room calculations accurate<br>- [ ] Strategy effectiveness ratings (0-10) validated<br>- [ ] AI-generated recommendations reviewed for accuracy<br>- [ ] Key milestone timeline verified for correctness<br>- [ ] GISInsightsCard UI renders correctly with all data<br>- [ ] Edge cases tested (zero RRIF, high assets, age transitions)<br>- [ ] Production deployment completed with monitoring<br>- [ ] User acceptance testing with real scenarios<br>- [ ] Performance benchmarks met (<500ms for insights generation) |
| **Tasks** | - [ ] Review strategy_insights.py logic for accuracy<br>- [ ] Create comprehensive test suite (unit + integration)<br>- [ ] Test GIS feasibility calculation (30-year projection)<br>- [ ] Validate RRIF minimum percentage tables<br>- [ ] Test single vs couple threshold logic<br>- [ ] Test "preserve_gis" mode activation ($5K+ GIS)<br>- [ ] Verify TFSA prioritization in minimize-income strategy<br>- [ ] Test GIS impact analysis tracking<br>- [ ] Validate AI-generated recommendations quality<br>- [ ] Test GISInsightsCard component rendering<br>- [ ] Performance testing (load testing, response times)<br>- [ ] Create production deployment plan<br>- [ ] Deploy to production with feature flag<br>- [ ] Monitor production metrics (usage, errors, performance)<br>- [ ] Collect user feedback on insights quality<br>- [ ] Document deployment results and lessons learned |
| **Technical Notes** | **Backend Components:**<br>- `juan-retirement-app/modules/strategy_insights.py` - AI insights generation<br>- `juan-retirement-app/modules/simulation.py` - GIS optimization logic<br>- `juan-retirement-app/api/models/responses.py` - Data models<br><br>**Frontend Components:**<br>- `webapp/components/simulation/GISInsightsCard.tsx` - Insights UI<br>- `webapp/lib/types/simulation.ts` - TypeScript types<br><br>**Key Features to Validate:**<br>1. GIS feasibility calculation (lines 12-200 in strategy_insights.py)<br>2. TFSA prioritization (lines 784-793 in simulation.py)<br>3. GIS threshold targeting (lines 625-642 in simulation.py)<br>4. Income addition calculations (lines 824-850 in simulation.py)<br>5. Recommendation generation logic<br>6. Milestone timeline accuracy<br><br>**CRA 2026 Rates to Verify:**<br>- GIS threshold single: $22,272<br>- GIS threshold couple (both OAS): $29,424<br>- GIS threshold couple (one OAS): $53,808<br>- RRIF minimum percentages by age (65-95) |
| **User Impact** | **Critical** - This feature directly impacts financial decisions for low-income retirees. Incorrect GIS advice could cost users thousands of dollars in lost benefits. AI-generated insights must be accurate, trustworthy, and validated. |
| **Known Issues** | - Current implementation already deployed (Jan 2026) but needs comprehensive testing<br>- Test scripts exist: test_gis_improvements.py, run-gis-tests.js<br>- Documentation exists: GIS_STRATEGY_ASSESSMENT.md, GIS_STRATEGY_ENHANCEMENT_SUMMARY.md<br>- No formal verification against CRA calculations yet<br>- No user acceptance testing conducted<br>- Performance benchmarks not established |
| **Success Metrics** | - [ ] 100% accuracy on 20+ test scenarios vs CRA calculations<br>- [ ] AI recommendations rated 4.5/5+ by subject matter expert review<br>- [ ] Zero critical bugs in production for 30 days<br>- [ ] 95th percentile response time <500ms<br>- [ ] Positive user feedback (>80% find insights helpful)<br>- [ ] No user reports of incorrect GIS advice |
| **Dependencies** | - US-013 (RRIF Strategy Validation) - should complete first<br>- Access to CRA 2026 GIS benefit calculator for validation<br>- Subject matter expert (SME) review of AI recommendations<br>- Production monitoring infrastructure |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-036** | **RRIF Tax Withholding Strategy for Excess Withdrawals** | **8** | **P2** | **üìã To Do** |
| **Description** | As a retiree with RRIF accounts, I want to understand and optimize tax withholding when withdrawing more than the minimum so that I can manage cash flow and avoid large year-end tax bills or refunds |
| **Acceptance Criteria** | **Calculation & Display:**<br>- [ ] Simulation accurately calculates CRA withholding tax when RRIF withdrawals exceed minimum<br>- [ ] Withholding rates applied correctly: 10% (‚â§$5K), 20% ($5K-$15K), 30% (>$15K)<br>- [ ] Quebec withholding rates applied when province is Quebec: 5%/10%/15% (plus federal)<br>- [ ] Withholding tax shown separately from final tax owing in results<br>- [ ] Cash flow reflects net amount received (gross - withholding)<br><br>**Strategy Integration:**<br>- [ ] Withdrawal strategies account for withholding impact on cash flow<br>- [ ] Strategies can optimize to minimize excess withholding (e.g., spread withdrawals)<br>- [ ] Strategy recommendations explain withholding implications<br>- [ ] Comparison tool shows withholding differences between strategies<br><br>**User Education:**<br>- [ ] Help text explains RRIF withholding rules<br>- [ ] Tooltip shows withholding calculation breakdown<br>- [ ] Warning shown when large excess withdrawal triggers 30% withholding<br>- [ ] Guidance on how to reduce withholding (multiple smaller withdrawals vs one large)<br><br>**Edge Cases:**<br>- [ ] Handles RRIF conversions at age 71 (first year minimum = 0)<br>- [ ] Handles multiple RRIF accounts (withholding per account)<br>- [ ] Minimum withdrawal has zero withholding<br>- [ ] Year-end tax reconciliation accounts for withholding paid |
| **Tasks** | **Research & Planning:**<br>- [ ] Review CRA RRIF withholding tax rules (2026)<br>- [ ] Document provincial variations (especially Quebec)<br>- [ ] Identify how withholding affects cash flow vs final tax<br>- [ ] Research best practices for minimizing excess withholding<br><br>**Backend Implementation:**<br>- [ ] Add withholding calculation to RRIF withdrawal logic (`withdrawal_strategies.py`)<br>- [ ] Implement tiered withholding rates (10%/20%/30%)<br>- [ ] Add Quebec-specific withholding rates<br>- [ ] Track withholding separately from final tax owing<br>- [ ] Update simulation cash flow to reflect net withdrawals<br>- [ ] Add withholding to annual tax summary<br><br>**Frontend Implementation:**<br>- [ ] Display withholding tax in simulation results<br>- [ ] Add withholding breakdown tooltip/card<br>- [ ] Show net vs gross RRIF withdrawals<br>- [ ] Add warning for high withholding scenarios (>20%)<br>- [ ] Create educational content for RRIF withholding<br>- [ ] Update strategy comparison to show withholding impact<br><br>**Testing:**<br>- [ ] Test minimum withdrawal (0% withholding)<br>- [ ] Test $3K excess withdrawal (10% withholding)<br>- [ ] Test $10K excess withdrawal (20% withholding)<br>- [ ] Test $20K excess withdrawal (30% withholding)<br>- [ ] Test Quebec vs other provinces<br>- [ ] Test multiple RRIF accounts<br>- [ ] Test age 71 conversion year<br>- [ ] Validate against CRA examples<br><br>**Documentation:**<br>- [ ] Document withholding calculation logic<br>- [ ] Create user guide: "Managing RRIF Tax Withholding"<br>- [ ] Add FAQ: "Why is my RRIF withdrawal less than expected?"<br>- [ ] Document strategy implications |
| **Technical Notes** | **CRA Withholding Rules (2026):**<br><br>**Federal Rates (All Provinces Except Quebec):**<br>- Excess withdrawal ‚â§ $5,000: **10% withholding**<br>- Excess withdrawal $5,001 - $15,000: **20% withholding**<br>- Excess withdrawal > $15,000: **30% withholding**<br><br>**Quebec Rates:**<br>- Federal: 5% / 10% / 15% (same tiers)<br>- Provincial: 5% / 10% / 15% (same tiers)<br>- **Combined: 10% / 20% / 30%** (same as rest of Canada)<br><br>**Minimum Withdrawal:**<br>- RRIF minimum withdrawal has **ZERO withholding**<br>- Only amounts **exceeding** minimum are subject to withholding<br><br>**Example:**<br>```<br>RRIF Balance: $100,000<br>Age: 72<br>Minimum %: 7.48%<br>Minimum Amount: $7,480 (no withholding)<br><br>Scenario 1: Withdraw $10,000<br>  Excess: $2,520<br>  Withholding: $252 (10% of excess)<br>  Net: $9,748<br><br>Scenario 2: Withdraw $20,000<br>  Excess: $12,520<br>  Withholding: $2,504 (20% of excess)<br>  Net: $17,496<br><br>Scenario 3: Withdraw $30,000<br>  Excess: $22,520<br>  Withholding: $6,756 (30% of excess)<br>  Net: $23,244<br>```<br><br>**Key Insight:**<br>Withholding is NOT the final tax owing. It's a prepayment. At year-end:<br>- If actual tax < withholding ‚Üí **Refund**<br>- If actual tax > withholding ‚Üí **Additional tax owing**<br><br>**Files to Modify:**<br>- `juan-retirement-app/modules/rrif_calculations.py` - Add withholding logic<br>- `juan-retirement-app/modules/simulation.py` - Track withholding in cash flow<br>- `webapp/components/simulation/RRIFWithholdingCard.tsx` - New component (display withholding)<br>- `webapp/lib/types/simulation.ts` - Add withholding fields to types<br><br>**Calculation Logic:**<br>```python<br>def calculate_rrif_withholding(withdrawal_amount, minimum_amount, province):<br>    excess = max(0, withdrawal_amount - minimum_amount)<br>    <br>    if excess <= 5000:<br>        rate = 0.10<br>    elif excess <= 15000:<br>        rate = 0.20<br>    else:<br>        rate = 0.30<br>    <br>    # Quebec has same combined rate but different federal/provincial split<br>    withholding = excess * rate<br>    net_withdrawal = withdrawal_amount - withholding<br>    <br>    return {<br>        'gross': withdrawal_amount,<br>        'minimum': minimum_amount,<br>        'excess': excess,<br>        'withholding': withholding,<br>        'net': net_withdrawal,<br>        'rate': rate<br>    }<br>```<br><br>**Strategy Implications:**<br>1. **Income Minimization (GIS):** May deliberately keep withdrawals at minimum to avoid withholding<br>2. **RRIF Splitting:** Splitting reduces per-person withdrawal, may drop to lower withholding tier<br>3. **Balanced:** Should consider withholding impact on cash flow<br>4. **TFSA First:** Delays RRIF withdrawals, potentially reduces years of high withholding |
| **User Impact** | **High** - Withholding significantly impacts monthly cash flow. Users withdrawing $30K from RRIF might expect $30K but only receive $23K (30% withheld). This can cause budgeting issues if not understood. |
| **Known Issues** | **Current Implementation Gap:**<br>- Current simulation does NOT calculate withholding tax<br>- Users may be surprised by lower-than-expected RRIF withdrawals<br>- Cash flow projections may be overstated (not accounting for withholding)<br>- Strategies don't optimize for withholding minimization<br><br>**User Pain Points:**<br>- "Why did I only receive $17K when I withdrew $20K from my RRIF?"<br>- "How can I avoid the 30% withholding rate?"<br>- "Should I withdraw minimum and top up from TFSA instead?" |
| **Success Metrics** | - [ ] Withholding calculations match CRA examples (100% accuracy)<br>- [ ] Users understand withholding (survey: >80% say "clear")<br>- [ ] Strategies minimize unnecessary withholding (A/B test shows lower withholding with optimization)<br>- [ ] Cash flow projections accurate (within 2% of actual after withholding)<br>- [ ] Zero user complaints about unexpected withholding |
| **Dependencies** | - US-013 (RRIF Strategy Validation) - must complete first to ensure RRIF calculations correct<br>- Province data (ensure user province is captured in profile)<br>- RRIF minimum calculation already working<br>- Cash flow tracking in simulation |
| **Related Stories** | US-013 (RRIF Strategy Validation), US-027 (Educational Guidance) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-037** | **Real Estate Management in Withdrawal Strategies & Retirement Plans** | **8** | **P2** | **üìã To Do** |
| **Description** | As a homeowner planning for retirement, I want to understand how my real estate (primary residence, rental properties, vacation homes) is incorporated into withdrawal strategies and retirement planning so that I can make informed decisions about selling, downsizing, or leveraging home equity |
| **Acceptance Criteria** | **Real Estate in Simulation:**<br>- [ ] Primary residence tracked separately from investment assets<br>- [ ] Primary residence NOT used for retirement income (principal residence exemption)<br>- [ ] Rental properties generate rental income in simulation<br>- [ ] Rental properties have capital gains on sale (if user chooses to sell)<br>- [ ] Vacation/secondary properties can be sold for retirement funding<br>- [ ] Home equity lines of credit (HELOC) supported as income source<br>- [ ] Downsizing scenarios modeled (sell high-value home, buy lower-cost, pocket difference)<br><br>**Withdrawal Strategy Integration:**<br>- [ ] Strategies explain when/if to sell real estate<br>- [ ] Strategies optimize timing of real estate sales (tax implications)<br>- [ ] Reverse mortgage option presented (if applicable)<br>- [ ] Rental income factored into GIS/OAS clawback calculations<br>- [ ] Capital gains from property sales factored into tax calculations<br><br>**User Planning Tools:**<br>- [ ] "Downsizing Calculator" shows impact of selling primary residence<br>- [ ] "Rental Property Analysis" shows income vs expenses vs sale proceeds<br>- [ ] "Reverse Mortgage Estimator" shows loan amount vs interest cost<br>- [ ] Scenario comparison: keep home vs downsize vs reverse mortgage<br><br>**User Education:**<br>- [ ] Help content explains principal residence exemption<br>- [ ] Help content explains capital gains on rental/vacation properties<br>- [ ] Help content explains reverse mortgages (pros/cons)<br>- [ ] Help content explains downsizing timing strategies<br><br>**Edge Cases:**<br>- [ ] User has multiple properties (primary + rental + vacation)<br>- [ ] User plans to sell property at specific age/year<br>- [ ] User expects property appreciation over time<br>- [ ] User has mortgage on properties (debt tracking) |
| **Tasks** | **Research & Planning:**<br>- [ ] Review CRA rules: principal residence exemption<br>- [ ] Review CRA rules: rental property income and capital gains<br>- [ ] Research reverse mortgage products (CHIP, HomeEquity Bank)<br>- [ ] Research downsizing trends (when do retirees typically downsize?)<br>- [ ] Interview users: How do you plan to use your home in retirement?<br><br>**Backend Implementation:**<br>- [ ] Extend RealEstate data model:<br>  - [ ] Add `propertyType` (primary, rental, vacation)<br>  - [ ] Add `rentalIncome` (monthly)<br>  - [ ] Add `rentalExpenses` (property tax, maintenance, insurance)<br>  - [ ] Add `mortgageBalance` and `mortgagePayment`<br>  - [ ] Add `plannedSaleYear` (optional)<br>  - [ ] Add `expectedAppreciation` (% per year)<br>  - [ ] Add `reverseMortgage` (boolean + details)<br>- [ ] Implement rental income in simulation cash flow<br>- [ ] Implement capital gains calculation on property sale<br>- [ ] Implement principal residence exemption (zero tax on primary)<br>- [ ] Implement downsizing scenario (sell + buy smaller + pocket difference)<br>- [ ] Implement reverse mortgage cash flow (receive lump sum, pay interest)<br>- [ ] Integrate real estate into withdrawal strategies:<br>  - [ ] "Income Minimization" - may suggest delaying rental property sale to avoid GIS clawback<br>  - [ ] "Capital Gains Optimized" - may suggest selling rental property in low-income years<br>  - [ ] "Balanced" - may suggest downsizing at specific age<br><br>**Frontend Implementation:**<br>- [ ] Update real estate form to capture new fields<br>- [ ] Create "Real Estate Impact Card" in simulation results<br>- [ ] Create "Downsizing Calculator" component<br>- [ ] Create "Rental Property Analysis" component<br>- [ ] Add real estate to cash flow visualization (rental income, sale proceeds)<br>- [ ] Add real estate to strategy recommendations<br>- [ ] Create educational content: "Real Estate in Retirement"<br><br>**Testing:**<br>- [ ] Test primary residence (no income, no capital gains)<br>- [ ] Test rental property (income + expenses + capital gains on sale)<br>- [ ] Test vacation home (capital gains on sale)<br>- [ ] Test downsizing scenario (sell $800K, buy $400K, pocket $400K)<br>- [ ] Test reverse mortgage (receive $200K, pay 6% interest)<br>- [ ] Test multiple properties<br>- [ ] Test rental income impact on GIS/OAS clawback<br>- [ ] Validate capital gains calculations vs CRA rules<br><br>**Documentation:**<br>- [ ] Document real estate data model<br>- [ ] Create user guide: "Managing Real Estate in Retirement"<br>- [ ] Create FAQ: "Should I downsize or take a reverse mortgage?"<br>- [ ] Document strategy implications for real estate |
| **Technical Notes** | **CRA Rules - Real Estate:**<br><br>**1. Principal Residence Exemption:**<br>- Capital gains on sale of primary residence are **TAX-FREE** (100% exempt)<br>- Can only designate ONE property as principal residence per family<br>- Must be "ordinarily inhabited" by owner<br><br>**2. Rental Property:**<br>- Rental income is **fully taxable** (reported on T776)<br>- Expenses deductible: property tax, insurance, maintenance, mortgage interest<br>- Capital gains on sale: **50% taxable** (same as stocks)<br><br>**3. Vacation/Secondary Property:**<br>- Not eligible for principal residence exemption<br>- Capital gains on sale: **50% taxable**<br><br>**4. Reverse Mortgage:**<br>- Loan secured by home equity<br>- Receive lump sum or monthly payments<br>- No monthly payments required (interest compounds)<br>- Loan repaid when home is sold or owner passes away<br>- Interest rates: 6-8% typically<br>- Maximum loan: 55% of home value (age 55+)<br><br>**Example - Rental Property:**<br>```<br>Purchase Price: $300,000 (year 2000)<br>Sale Price: $600,000 (year 2026)<br>Capital Gain: $300,000<br>Taxable Gain: $150,000 (50%)<br>Tax (40% marginal rate): $60,000<br>Net Proceeds: $540,000<br><br>Annual Rental Income: $24,000<br>Annual Expenses: $8,000 (tax, insurance, maintenance)<br>Net Rental Income: $16,000/year (fully taxable)<br>```<br><br>**Example - Downsizing:**<br>```<br>Sell Primary Residence: $800,000 (no capital gains tax)<br>Buy Smaller Home: $400,000<br>Pocket Difference: $400,000<br>Use $400K to fund retirement:<br>  - Option 1: Invest in TFSA/RRIF<br>  - Option 2: Use as cash flow supplement<br>  - Option 3: Pay off debts<br>```<br><br>**Example - Reverse Mortgage:**<br>```<br>Home Value: $500,000<br>Age: 70<br>Max Loan: 55% of value = $275,000<br>Take Reverse Mortgage: $200,000<br>Interest Rate: 6%/year (compounding)<br><br>Year 1: Owe $212,000<br>Year 5: Owe $267,645<br>Year 10: Owe $358,170<br>Year 15: Owe $479,655<br><br>If home sold in Year 10:<br>  Home Value (3% appreciation): $671,958<br>  Loan Owed: $358,170<br>  Net Equity: $313,788<br>```<br><br>**Files to Modify:**<br>- `webapp/prisma/schema.prisma` - Extend RealEstate model<br>- `juan-retirement-app/modules/real_estate.py` - New module for real estate logic<br>- `juan-retirement-app/modules/simulation.py` - Integrate real estate into cash flow<br>- `webapp/components/RealEstateForm.tsx` - Update form for new fields<br>- `webapp/components/simulation/RealEstateImpactCard.tsx` - New component<br>- `webapp/lib/types/simulation.ts` - Add real estate types<br><br>**Prisma Schema Extension:**<br>```prisma<br>model RealEstate {<br>  id                  String   @id @default(cuid())<br>  userId              String<br>  propertyType        String   // "primary", "rental", "vacation"<br>  address             String?<br>  currentValue        Float<br>  purchasePrice       Float?<br>  purchaseYear        Int?<br>  expectedAppreciation Float   @default(2.0) // % per year<br>  <br>  // Rental properties<br>  monthlyRentalIncome  Float?<br>  monthlyExpenses      Float?<br>  <br>  // Mortgage<br>  mortgageBalance      Float?<br>  monthlyMortgagePayment Float?<br>  <br>  // Sale planning<br>  plannedSaleYear      Int?<br>  <br>  // Reverse mortgage<br>  hasReverseMortgage   Boolean  @default(false)<br>  reverseMortgageAmount Float?<br>  reverseMortgageRate  Float?<br>  reverseMortgageYear  Int?<br>  <br>  createdAt           DateTime @default(now())<br>  updatedAt           DateTime @updatedAt<br>  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)<br>}<br>```<br><br>**Strategy Implications:**<br>1. **Income Minimization (GIS):**<br>   - May recommend deferring rental property sale to avoid capital gains spike<br>   - May recommend downsizing primary residence to avoid GIS clawback from rental income<br><br>2. **Capital Gains Optimized:**<br>   - May recommend selling rental/vacation properties in low-income years<br>   - May recommend reverse mortgage instead of property sale (no capital gains)<br><br>3. **Balanced:**<br>   - May recommend downsizing at age 75-80 (reduce home maintenance burden)<br>   - May balance rental income with RRIF withdrawals |
| **User Impact** | **Critical** - Real estate is often the largest asset for retirees (50-70% of net worth). Proper planning for downsizing, rental income, or reverse mortgages can add $100K-$500K to retirement funding. |
| **Known Issues** | **Current Implementation Gap:**<br>- Real estate is tracked but NOT integrated into withdrawal strategies<br>- No rental income in simulation cash flow<br>- No downsizing scenarios modeled<br>- No reverse mortgage option<br>- No capital gains calculations for property sales<br>- No strategic guidance on when to sell/downsize<br><br>**User Pain Points:**<br>- "Should I sell my rental property now or wait?"<br>- "When is the best time to downsize?"<br>- "Should I take a reverse mortgage or sell my home?"<br>- "How much income will my rental property generate in retirement?" |
| **Success Metrics** | - [ ] Real estate income accurately reflected in cash flow (100% of users with rental properties)<br>- [ ] Downsizing scenarios show correct tax implications (0% tax on primary residence)<br>- [ ] Capital gains calculations match CRA rules (100% accuracy)<br>- [ ] Users understand real estate options (survey: >80% say "clear")<br>- [ ] Strategic recommendations for real estate rated helpful (>4/5 by users) |
| **Dependencies** | - US-009 (Skip Real Estate Step) - may conflict if users skip real estate but then want to model it<br>- Province data (capital gains tax rates vary slightly)<br>- Mortgage tracking (if not already implemented)<br>- Real estate data model update (Prisma migration) |
| **Related Stories** | US-009 (Skip Real Estate Step), US-013 (RRIF Strategy Validation), US-021 (Configurable Yields), US-027 (Educational Guidance) |

---

### Medium Priority (Sprints 3-4)

#### Epic 6: Testing & Quality

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-014** | **E2E Test Suite - Critical Paths** | **13** | **P2** | **üìã Backlog** |
| **Description** | As a developer, I want automated end-to-end tests for critical user flows so that I can deploy with confidence |
| **Acceptance Criteria** | - [ ] Onboarding flow fully tested<br>- [ ] Simulation creation tested<br>- [ ] Strategy comparison tested<br>- [ ] Profile updates tested<br>- [ ] Tests run in CI/CD pipeline |
| **Tasks** | - [ ] Set up Playwright/Cypress<br>- [ ] Write onboarding tests<br>- [ ] Write simulation tests<br>- [ ] Write profile tests<br>- [ ] Integrate with GitHub Actions<br>- [ ] Document test writing process |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-015** | **Unit Test Coverage - Backend** | **8** | **P3** | **üìã Backlog** |
| **Description** | As a developer, I want comprehensive unit tests for the simulation engine so that I can refactor safely |
| **Acceptance Criteria** | - [ ] >80% code coverage for simulation.py<br>- [ ] All tax calculations tested<br>- [ ] All withdrawal strategies tested<br>- [ ] Edge cases covered<br>- [ ] Tests run in CI/CD |
| **Tasks** | - [ ] Set up pytest framework<br>- [ ] Write tax calculation tests<br>- [ ] Write withdrawal strategy tests<br>- [ ] Write GIS calculation tests<br>- [ ] Add coverage reporting<br>- [ ] Fix any bugs found |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-022** | **What-If Scenario Slider Testing & Fixes** | **5** | **P1** | **‚úÖ Done** |
| **Description** | As a user, I want the What-If scenario sliders to work correctly and provide accurate simulation comparisons so that I can confidently explore different retirement scenarios |
| **Acceptance Criteria** | - [x] All sliders respond correctly to user input<br>- [x] Slider values map correctly to adjustments (e.g., spending 50-150%, retirement age -5 to +5)<br>- [x] "Run What-If Scenario" button executes simulation successfully<br>- [x] Results display shows accurate comparison (original vs what-if)<br>- [x] Health score delta calculated correctly<br>- [x] Final estate delta calculated correctly<br>- [x] Error handling works for invalid scenarios<br>- [x] Reset button clears all adjustments<br>- [x] Slider state persists during interaction (no unexpected resets) |
| **Completion** | ‚úÖ Completed January 29, 2026 (commit 2487294). Fixed state timing bug where `hasChanges` would not update correctly on first slider adjustment. See WHATIF_SLIDER_TEST_REPORT.md for complete testing documentation. |
| **Tasks** | - [ ] Audit WhatIfSliders.tsx component for bugs<br>- [ ] Test slider value mapping (spending, retirement age, CPP age, OAS age)<br>- [ ] Test /api/simulation/what-if endpoint with various adjustments<br>- [ ] Verify adjustment calculations (lines 43-45 in WhatIfSliders.tsx)<br>- [ ] Test edge cases (min/max values, boundary conditions)<br>- [ ] Fix checkHasChanges() function if needed (line 48-55)<br>- [ ] Test error handling for failed API calls<br>- [ ] Verify comparison UI renders correctly (health score, estate)<br>- [ ] Create automated E2E test for What-If feature<br>- [ ] Document known limitations and expected behavior |
| **Technical Notes** | Component located at: `webapp/components/simulation/WhatIfSliders.tsx`<br>API endpoint: `webapp/app/api/simulation/what-if/route.ts`<br>Potential issues:<br>- Slider value offsets (+5 for retirement/CPP sliders) may cause confusion<br>- handleAdjustmentChange may not trigger hasChanges update correctly<br>- Error state may not clear properly between runs<br>- What-If result may show stale data |
| **User Impact** | High - What-If scenarios are critical for users to explore different retirement strategies. Bugs here undermine confidence in the tool. |
| **Known Issues** | - **OAS Start Age slider does not update the displayed age value** (reported Jan 29, 2026 with screenshot)<br>  - Slider moves but "Age 65" text does not change<br>  - Help text updates correctly ("Start OAS 3 years earlier") but age badge is stuck<br>  - Likely issue: State binding or rendering bug in OAS slider component<br>  - Impact: User cannot see what OAS age they're selecting<br>- User reported issues via screenshot (needs investigation)<br>- Multiple test scripts exist but may not cover all scenarios<br>- Scripts: test-what-if-comprehensive.ts, test-what-if-accuracy.ts, test-what-if-sliders.ts |

---

| **US-035** | **E2E Testing - All Withdrawal Strategies** | **8** | **P2** | **üìã To Do** |
| **Description** | As a developer, I want comprehensive end-to-end tests for all 6 withdrawal strategies so that I can ensure each strategy produces correct results and behaves as documented |
| **Acceptance Criteria** | **Test Coverage:**<br>- [ ] All 6 withdrawal strategies tested end-to-end<br>- [ ] Each strategy tested with multiple household profiles<br>- [ ] Tax calculations verified for each strategy<br>- [ ] Withdrawal order validated for each strategy<br>- [ ] Edge cases tested (zero balances, high income, low income)<br>- [ ] Cross-strategy comparison validates differences<br><br>**Test Quality:**<br>- [ ] Tests run in CI/CD pipeline<br>- [ ] Tests are deterministic (no flaky tests)<br>- [ ] Clear assertions with meaningful error messages<br>- [ ] Test data represents realistic scenarios<br>- [ ] Performance benchmarks established<br><br>**Documentation:**<br>- [ ] Each strategy's expected behavior documented<br>- [ ] Test scenarios described in detail<br>- [ ] Known limitations documented<br>- [ ] Comparison matrix created (when to use each strategy) |
| **Tasks** | **Test Infrastructure:**<br>- [ ] Set up Playwright E2E test framework (if not already)<br>- [ ] Create test fixtures for 6 household profiles<br>- [ ] Create utility functions for strategy testing<br>- [ ] Set up test database with known data<br><br>**Strategy Tests (6 strategies):**<br><br>1. **Corporate Optimized** (US-035-1)<br>   - [ ] Test with corporate account ($100K)<br>   - [ ] Verify corporate accounts drawn first<br>   - [ ] Verify corporate tax minimization<br>   - [ ] Test with no corporate accounts (fallback behavior)<br><br>2. **Income Minimization (GIS-Optimized)** (US-035-2)<br>   - [ ] Test with low-income senior (GIS eligible)<br>   - [ ] Verify TFSA/capital gains prioritized<br>   - [ ] Verify taxable income stays below GIS clawback<br>   - [ ] Test with high income (GIS not applicable)<br>   - [ ] Verify OAS clawback avoided if possible<br><br>3. **RRIF Splitting** (US-035-3)<br>   - [ ] Test with couple (both >65)<br>   - [ ] Verify pension income splitting applied<br>   - [ ] Verify tax reduction vs no splitting<br>   - [ ] Test with single person (no splitting)<br>   - [ ] Test with age <65 (ineligible)<br><br>4. **Capital Gains Optimized** (US-035-4)<br>   - [ ] Test with large non-reg account ($200K+)<br>   - [ ] Verify capital gains drawn first<br>   - [ ] Verify 50% inclusion rate applied<br>   - [ ] Compare tax vs RRIF withdrawals<br>   - [ ] Test with zero non-reg balance<br><br>5. **TFSA First** (US-035-5)<br>   - [ ] Test with $50K TFSA balance<br>   - [ ] Verify TFSA fully depleted before RRIF<br>   - [ ] Verify zero tax on TFSA withdrawals<br>   - [ ] Test with zero TFSA balance<br>   - [ ] Verify flexibility benefit (no tax impact)<br><br>6. **Balanced** (US-035-6)<br>   - [ ] Test with all account types<br>   - [ ] Verify proportional withdrawals<br>   - [ ] Compare results to other strategies<br>   - [ ] Verify tax optimization is moderate<br>   - [ ] Confirm it's the default strategy<br><br>**Cross-Strategy Tests:**<br>- [ ] Same household, all 6 strategies, compare results<br>- [ ] Verify health scores differ appropriately<br>- [ ] Verify final estates differ<br>- [ ] Verify tax totals differ<br>- [ ] Document which strategy is best for which profile<br><br>**Regression Tests:**<br>- [ ] Test against known-good simulation results<br>- [ ] Verify Python backend changes don't break strategies<br>- [ ] Test with production data (anonymized)<br><br>**Documentation:**<br>- [ ] Create WITHDRAWAL_STRATEGIES_TEST_REPORT.md<br>- [ ] Document expected behavior for each strategy<br>- [ ] Create strategy selection guide<br>- [ ] Add test examples to documentation |
| **Technical Notes** | **Withdrawal Strategies (6 total):**<br><br>1. **Corporate Optimized** (`corporate-optimized`)<br>   - Prioritizes corporate account withdrawals<br>   - Minimizes corporate tax<br>   - Best for: Business owners with corporate accounts<br><br>2. **Income Minimization** (`minimize-income`)<br>   - Prioritizes TFSA and capital gains<br>   - Preserves GIS eligibility<br>   - Avoids OAS clawback<br>   - Best for: Low-income seniors, GIS recipients<br><br>3. **RRIF Splitting** (`rrif-splitting`)<br>   - Uses pension income splitting for couples<br>   - Requires both partners >65<br>   - Reduces household tax burden<br>   - Best for: Couples with large RRIF balances<br><br>4. **Capital Gains Optimized** (`capital-gains-optimized`)<br>   - Prioritizes non-registered accounts<br>   - Leverages 50% inclusion rate<br>   - Best for: High net worth, large non-reg accounts<br><br>5. **TFSA First** (`tfsa-first`)<br>   - Depletes TFSA before taxable accounts<br>   - Maximizes flexibility (no tax reporting)<br>   - Best for: Users wanting zero-tax withdrawals first<br><br>6. **Balanced** (`balanced`) - DEFAULT<br>   - Proportional withdrawals across accounts<br>   - Moderate tax optimization<br>   - Best for: Most users, simple approach<br><br>**Test Framework:**<br>- Use Playwright for E2E tests (`e2e/` directory)<br>- Test household profiles stored in `e2e/fixtures/`<br>- Simulation API: `/api/simulation/run`<br>- Python backend validation: `juan-retirement-app/modules/withdrawal_strategies.py`<br><br>**Test Data:**<br>Each test profile should include:<br>- Household info (names, ages, province)<br>- Assets (TFSA, RRSP, RRIF, NonReg, Corporate, RealEstate)<br>- Income (CPP, OAS, pensions, employment)<br>- Expenses (Go-Go, Slow-Go, No-Go)<br>- Expected results (for regression testing)<br><br>**Validation:**<br>- Compare health score (success_rate)<br>- Compare final estate<br>- Compare total taxes paid<br>- Compare withdrawal amounts by year<br>- Compare tax by year<br>- Verify correct account depletion order<br><br>**Related Code:**<br>- Frontend: `webapp/lib/types/simulation.ts` (strategyOptions)<br>- Backend: `juan-retirement-app/modules/withdrawal_strategies.py`<br>- Tests: `webapp/e2e/withdrawal-strategies.spec.ts` (to be created) |
| **User Impact** | **High** - Withdrawal strategy choice significantly impacts retirement outcomes. Incorrect strategy behavior leads to suboptimal plans, tax overpayment, or benefit loss. Users trust these strategies for critical financial decisions. |
| **Known Issues** | - No comprehensive E2E tests for strategies currently<br>- Strategy behavior not fully documented<br>- Users may not understand when to use each strategy<br>- No visual comparison tool for strategies<br>- Python backend changes may break strategies without detection<br>- RRIF Splitting strategy recently implemented (needs validation)<br>- Corporate Optimized strategy may have edge cases<br>- Income Minimization GIS calculations complex |
| **Success Metrics** | - [ ] 100% of 6 strategies have E2E tests<br>- [ ] All tests pass in CI/CD<br>- [ ] Zero strategy-related bugs in production<br>- [ ] Test coverage >90% for withdrawal logic<br>- [ ] Regression test suite catches breaking changes<br>- [ ] Strategy selection guide created<br>- [ ] User complaints about strategy behavior <1% |
| **Dependencies** | - Python backend (`juan-retirement-app/`) functional<br>- Simulation API (`/api/simulation/run`) working<br>- Playwright E2E framework set up<br>- Test fixtures and utilities created<br>- Access to anonymized production data for realistic tests |
| **Related Stories** | US-013 (RRIF Strategy Validation), US-022 (What-If Slider Testing), US-027 (Educational Guidance) |

---

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-040** | **GIC Calculator Module Unit Tests** | **3** | **P1** | **üìã To Do** |
| **Description** | As a developer, I want comprehensive unit tests for the gic_calculator.py module so that I can ensure GIC maturity calculations are accurate and reliable |
| **Acceptance Criteria** | - [ ] Test calculate_gic_maturity_value() with all compounding frequencies (annual, semi-annual, monthly, at-maturity)<br>- [ ] Test calculate_gic_interest() for accuracy<br>- [ ] Test process_gic_maturity_events() with multiple GICs (matured and locked)<br>- [ ] Test apply_reinvestment_strategy() for all strategies (auto-renew, cash-out, transfer-to-tfsa, transfer-to-nonreg)<br>- [ ] Test get_gic_balance_locked() for locked balance calculation<br>- [ ] Test edge cases (zero principal, zero rate, invalid dates)<br>- [ ] 90%+ code coverage for gic_calculator.py<br>- [ ] All tests pass in CI/CD pipeline<br>- [ ] Test results documented |
| **Tasks** | - [ ] Set up pytest framework in juan-retirement-app/<br>- [ ] Create tests/test_gic_calculator.py file<br>- [ ] Test 1: Compound interest calculation (annual compounding)<br>  - [ ] $50,000 @ 4.5% for 5 years = $62,309.10<br>  - [ ] Verify rounding to 2 decimal places<br>- [ ] Test 2: Compound interest calculation (semi-annual compounding)<br>  - [ ] $20,000 @ 3.8% for 2 years = $21,559.70<br>  - [ ] Compare to annual compounding (should be higher)<br>- [ ] Test 3: Compound interest calculation (monthly compounding)<br>  - [ ] Test with $10,000 @ 5.0% for 3 years<br>  - [ ] Verify monthly compounds more than annual<br>- [ ] Test 4: Simple interest (at-maturity)<br>  - [ ] $30,000 @ 4.0% for 3 years = $33,600.00<br>  - [ ] Verify uses simple interest formula<br>- [ ] Test 5: Interest-only calculation<br>  - [ ] Verify calculate_gic_interest() = maturity - principal<br>- [ ] Test 6: GIC maturity event processing (single GIC matures)<br>  - [ ] GIC with maturity date = current year<br>  - [ ] Verify maturity event created with correct values<br>  - [ ] Verify total_matured_value calculated<br>- [ ] Test 7: GIC maturity event processing (multiple GICs)<br>  - [ ] 3 GICs: 1 matured, 2 locked<br>  - [ ] Verify only matured GIC in matured_gics list<br>  - [ ] Verify locked GICs in locked_gics list<br>- [ ] Test 8: GIC maturity event processing (no GICs mature)<br>  - [ ] All GICs have future maturity dates<br>  - [ ] Verify empty matured_gics list<br>  - [ ] Verify total_matured_value = 0<br>- [ ] Test 9: Auto-renew reinvestment strategy<br>  - [ ] Verify new GIC created with maturity value as principal<br>  - [ ] Verify new maturity date = current year + term<br>  - [ ] Verify new GIC uses same rate (conservative)<br>- [ ] Test 10: Cash-out reinvestment strategy<br>  - [ ] Verify destination = "liquid-assets"<br>  - [ ] Verify amount = total maturity value<br>- [ ] Test 11: Transfer-to-TFSA reinvestment strategy<br>  - [ ] Verify destination = "tfsa"<br>  - [ ] Verify amount = total maturity value<br>- [ ] Test 12: Transfer-to-nonreg reinvestment strategy<br>  - [ ] Verify destination = "nonreg"<br>- [ ] Test 13: Locked balance calculation<br>  - [ ] 2 GICs: $50K (matures 2030), $20K (matures 2026)<br>  - [ ] In year 2027: locked balance = $50K<br>  - [ ] In year 2030: locked balance = $0<br>- [ ] Test 14: Edge case - Zero principal<br>  - [ ] Verify returns 0.0<br>- [ ] Test 15: Edge case - Zero term<br>  - [ ] Verify returns principal unchanged<br>- [ ] Test 16: Edge case - Invalid maturity date<br>  - [ ] Verify handles gracefully (skip GIC)<br>- [ ] Add pytest.ini configuration<br>- [ ] Add coverage reporting with pytest-cov<br>- [ ] Run tests locally and verify 90%+ coverage<br>- [ ] Document test results in GIC_CALCULATOR_TEST_REPORT.md<br>- [ ] Add tests to CI/CD pipeline (GitHub Actions) |
| **Technical Notes** | **File to Test**: `juan-retirement-app/modules/gic_calculator.py`<br><br>**Test Framework**: pytest<br><br>**Functions to Test**:<br>1. `calculate_gic_maturity_value()` - Compound interest formula<br>2. `calculate_gic_interest()` - Interest-only calculation<br>3. `process_gic_maturity_events()` - Event processing<br>4. `apply_reinvestment_strategy()` - Reinvestment logic<br>5. `get_gic_balance_locked()` - Locked balance<br><br>**Test File Structure**:<br>```python<br># tests/test_gic_calculator.py<br>import pytest<br>from modules.gic_calculator import (<br>    calculate_gic_maturity_value,<br>    calculate_gic_interest,<br>    process_gic_maturity_events,<br>    apply_reinvestment_strategy,<br>    get_gic_balance_locked<br>)<br><br>class TestGICMaturityCalculations:<br>    def test_annual_compounding(self):<br>        # Test 5-year GIC at 4.5% annual<br>        maturity = calculate_gic_maturity_value(50000, 4.5, 5, "annual")<br>        assert abs(maturity - 62309.10) < 0.01<br><br>    def test_semi_annual_compounding(self):<br>        # Test 2-year GIC at 3.8% semi-annual<br>        maturity = calculate_gic_maturity_value(20000, 3.8, 2, "semi-annual")<br>        assert abs(maturity - 21559.70) < 0.01<br><br>    # ... more tests<br>```<br><br>**Coverage Target**: 90%+<br><br>**Known Test Values** (from module docstrings):<br>- $50,000 @ 4.5% for 5 years (annual) = $62,309.09<br>- $20,000 @ 3.8% for 2 years (semi-annual) = $21,559.70<br>- $30,000 @ 4.0% for 3 years (at-maturity) = $33,600.00 |
| **User Impact** | **High** - GIC maturity calculations directly affect retirement projections for 40-50% of Canadian retirees who use GICs. Incorrect calculations lead to inaccurate retirement plans and loss of user trust. Unit tests ensure accuracy and prevent regressions. |
| **Dependencies** | - gic_calculator.py module complete (‚úÖ Done - US-038 Phase 2)<br>- pytest framework set up in juan-retirement-app/<br>- pytest-cov for coverage reporting |
| **Related Stories** | US-038 (GIC Maturity Tracking), US-041 (GIC Integration Tests), US-015 (Backend Unit Tests) |

---

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-041** | **GIC Integration Tests - Simulation Engine** | **5** | **P1** | **üìã To Do** |
| **Description** | As a developer, I want integration tests for GIC maturity processing in the simulation engine so that I can ensure GICs work correctly end-to-end in retirement simulations |
| **Acceptance Criteria** | - [ ] Test single GIC maturity with cash-out strategy<br>- [ ] Test GIC ladder (5 GICs, staggered maturities) with auto-renew strategy<br>- [ ] Test GIC maturity with TFSA transfer strategy<br>- [ ] Test locked GIC exclusion from withdrawal strategies<br>- [ ] Test GIC maturity across multiple simulation years<br>- [ ] Test reinvestment strategies integrate with account balances correctly<br>- [ ] Test edge cases (GIC matures in final year, multiple GICs same year)<br>- [ ] Verify GIC maturity events appear in simulation results<br>- [ ] Integration tests pass in CI/CD pipeline<br>- [ ] Test results documented with example scenarios |
| **Tasks** | - [ ] Create tests/test_gic_integration.py file<br>- [ ] Set up test fixtures (household with GIC assets)<br><br>**Test 1: Single GIC Maturity (Cash-Out)**<br>- [ ] Create household with 1 GIC ($50K, 4.5%, 5-year, cash-out)<br>- [ ] GIC matures in year 2029<br>- [ ] Run simulation from 2024-2035<br>- [ ] Verify GIC maturity event appears in year 2029 results<br>- [ ] Verify $62,309 added to non-reg balance in 2029<br>- [ ] Verify GIC no longer in locked_gics after maturity<br>- [ ] Verify non-reg balance available for withdrawals in 2030+<br><br>**Test 2: GIC Ladder (Auto-Renew)**<br>- [ ] Create household with 5 GICs ($20K each, matures 2026-2030)<br>- [ ] All GICs set to auto-renew strategy<br>- [ ] Run simulation from 2024-2040<br>- [ ] Verify 1 GIC matures each year 2026-2030<br>- [ ] Verify new GICs created with maturity values (~$21.5K each)<br>- [ ] Verify renewed GICs have new maturity dates (5 years later)<br>- [ ] Verify GIC ladder continues beyond 2030<br>- [ ] Verify locked balance updates correctly each year<br><br>**Test 3: TFSA Transfer Strategy**<br>- [ ] Create household with 1 GIC ($30K, 4.0%, 3-year, transfer-to-tfsa)<br>- [ ] TFSA has available contribution room ($40K)<br>- [ ] GIC matures in 2027<br>- [ ] Run simulation from 2024-2035<br>- [ ] Verify GIC maturity event in 2027<br>- [ ] Verify funds transferred to TFSA (up to available room)<br>- [ ] Verify TFSA balance increases by maturity value<br>- [ ] If TFSA full, verify excess goes to non-reg<br><br>**Test 4: Locked GIC Exclusion from Withdrawals**<br>- [ ] Create household with 1 locked GIC ($100K, matures 2035)<br>- [ ] Non-reg account has $50K cash + $100K locked GIC<br>- [ ] Person needs $40K withdrawal in 2027<br>- [ ] Run simulation for year 2027<br>- [ ] Verify withdrawal strategy only considers $50K (not $150K)<br>- [ ] Verify locked GIC balance excluded from available balance<br>- [ ] Verify withdrawal succeeds from $50K cash portion<br><br>**Test 5: Multiple GICs Mature Same Year**<br>- [ ] Create household with 3 GICs all maturing in 2029<br>- [ ] Different reinvestment strategies (cash-out, auto-renew, tfsa)<br>- [ ] Run simulation through 2029<br>- [ ] Verify all 3 GICs process correctly<br>- [ ] Verify each reinvestment strategy executed<br>- [ ] Verify total_matured_value = sum of all 3 GICs<br><br>**Test 6: GIC Matures in Final Simulation Year**<br>- [ ] Create household with GIC maturing in 2050 (final year)<br>- [ ] Run simulation 2024-2050<br>- [ ] Verify GIC maturity event appears<br>- [ ] Verify funds available in final year<br>- [ ] Verify final estate includes maturity value<br><br>**Test 7: GIC Integration with Person Model**<br>- [ ] Verify Person.gic_assets field populated correctly<br>- [ ] Verify GIC assets passed to simulation engine<br>- [ ] Verify GIC maturity events in YearResult<br>- [ ] Verify simulation results include GIC events<br><br>**Test 8: Withdrawal Strategy Integration**<br>- [ ] Test Income Minimization strategy with locked GICs<br>- [ ] Test TFSA First strategy with GIC maturity<br>- [ ] Test Corporate Optimized with GIC assets<br>- [ ] Verify strategies correctly handle GIC liquidity<br><br>- [ ] Add integration test fixtures to tests/fixtures/<br>- [ ] Document test scenarios in GIC_INTEGRATION_TEST_REPORT.md<br>- [ ] Add integration tests to CI/CD pipeline<br>- [ ] Create test data generators for GIC scenarios |
| **Technical Notes** | **Files to Test**:<br>- `juan-retirement-app/modules/gic_calculator.py` (already tested in US-040)<br>- `juan-retirement-app/modules/simulation.py` (integration point)<br>- `juan-retirement-app/modules/models.py` (Person, YearResult models)<br>- `juan-retirement-app/modules/withdrawal_strategies.py` (GIC exclusion logic)<br><br>**Integration Points to Test**:<br>1. **Person Model** - gic_assets field<br>2. **YearResult Model** - gic_maturity_events field<br>3. **simulate_year()** - GIC maturity processing<br>4. **Reinvestment Logic** - Account balance updates<br>5. **Withdrawal Strategies** - Locked balance exclusion<br><br>**Test Data Structure**:<br>```python<br># Test household with GIC<br>household = Household(<br>    p1=Person(<br>        name="Test User",<br>        start_age=60,<br>        nonreg_balance=50000,<br>        gic_assets=[{<br>            "name": "TD 5-Year GIC",<br>            "balance": 50000,<br>            "gicMaturityDate": "2029-01-15",<br>            "gicInterestRate": 4.5,<br>            "gicTermMonths": 60,<br>            "gicCompoundingFrequency": "annual",<br>            "gicReinvestStrategy": "cash-out",<br>            "owner": "person1"<br>        }]<br>    )<br>)<br>```<br><br>**Verification Points**:<br>- Year result contains maturity event<br>- Account balances updated correctly<br>- Locked GICs excluded from withdrawals<br>- Reinvestment strategies executed<br>- New GICs created for auto-renew<br>- Simulation completes successfully<br><br>**Integration with GIC_INTEGRATION_PLAN.md**:<br>This test suite validates all integration steps documented in the GIC Integration Plan. |
| **User Impact** | **High** - Integration tests ensure GIC maturity tracking works correctly in real-world simulations. Prevents bugs like:<br>- GICs not maturing at correct time<br>- Maturity values calculated incorrectly<br>- Reinvestment strategies not executing<br>- Locked GICs being withdrawn early<br>- Account balances not updating after maturity<br><br>Comprehensive integration tests protect 40-50% of Canadian users who rely on GICs. |
| **Known Issues** | - Integration not yet implemented (blocked by US-038 Phase 3)<br>- Person model needs gic_assets field added<br>- YearResult model needs gic_maturity_events field added<br>- simulate_year() needs GIC maturity processing logic |
| **Success Metrics** | - [ ] All 8 integration test scenarios pass<br>- [ ] Tests run in <30 seconds<br>- [ ] Zero GIC-related bugs in production after deployment<br>- [ ] Integration test coverage >80% for GIC code paths<br>- [ ] Test failures caught in CI/CD before deployment |
| **Dependencies** | - US-038 Phase 2 complete (gic_calculator.py module) ‚úÖ<br>- US-038 Phase 3 complete (integration into simulation.py) ‚è≥<br>- US-040 complete (unit tests) ‚è≥<br>- Person model updated with gic_assets field<br>- YearResult model updated with gic_maturity_events field<br>- pytest framework set up |
| **Related Stories** | US-038 (GIC Maturity Tracking), US-040 (GIC Unit Tests), US-015 (Backend Unit Tests) |

---

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-050** | **Python API Monitoring & Alerting System** | **3** | **P1** | **üìã To Do** |
| **Description** | As a developer, I want automated monitoring and alerting for the Python simulation API so that I'm immediately notified when the service goes down and can prevent user-facing simulation failures |
| **User Feedback** | **Source**: Recent production incident (January 31, 2026 - Feb 1, 2026)<br>**Issue**: Python API went down, causing simulation button to be permanently disabled<br>**Impact**: Complete simulation failure, users unable to run any simulations<br>**Root Cause**: Python API health check failing, no monitoring alert sent<br>**Recovery Time**: Hours (manual discovery and restart required) |
| **Acceptance Criteria** | - [ ] Health check endpoint monitoring Python API (/health or /api/health)<br>- [ ] Alert triggers if API down for >5 minutes<br>- [ ] Alert sent via email (to developer email)<br>- [ ] Alert includes: timestamp, error type, API URL, suggested fix<br>- [ ] Monitoring runs every 1-2 minutes<br>- [ ] Dashboard shows API status (up/down, uptime percentage)<br>- [ ] Alert includes automatic restart instructions<br>- [ ] False positive rate <1% (reliable alerts)<br>- [ ] Recovery time <10 minutes (from downtime to alert to restart) |
| **Tasks** | **Option 1: Simple Script + Cron (Free, 2 hours)**<br>- [ ] Create monitoring script: `scripts/monitor-python-api.sh`<br>- [ ] Script curls `http://localhost:8000/health` every 2 minutes<br>- [ ] If 3 consecutive failures (6 minutes), send email alert<br>- [ ] Email via sendmail or curl to Resend API<br>- [ ] Set up cron job: `*/2 * * * * /path/to/monitor-python-api.sh`<br>- [ ] Test monitoring with intentional API shutdown<br>- [ ] Document setup in README<br><br>**Option 2: UptimeRobot (Free Tier, 1 hour)**<br>- [ ] Sign up for UptimeRobot free tier<br>- [ ] Add monitor for `https://retirezest.com/api/health` (Next.js proxy)<br>- [ ] Create proxy endpoint: `/api/health` that checks Python API<br>- [ ] Configure 5-minute alert threshold<br>- [ ] Add email alert contact<br>- [ ] Test monitoring<br>- [ ] Document setup<br><br>**Option 3: Vercel Monitoring (If available, 30 min)**<br>- [ ] Check if Vercel plan includes monitoring<br>- [ ] Set up alerts for API failures<br>- [ ] Configure notification email<br><br>**Recommended: Option 1 (Simple Script)**<br>- No external dependencies<br>- No monthly cost<br>- Full control over alert logic<br>- Works with localhost Python API |
| **Technical Notes** | **Monitoring Script (`scripts/monitor-python-api.sh`):**<br>```bash<br>#!/bin/bash<br># Monitor Python API health and alert if down<br><br>API_URL="http://localhost:8000/health"<br>ALERT_EMAIL="dev@retirezest.com"<br>LOG_FILE="/var/log/python-api-monitor.log"<br>FAILURE_COUNT_FILE="/tmp/python-api-failures.txt"<br><br># Initialize failure count<br>if [ ! -f "$FAILURE_COUNT_FILE" ]; then<br>  echo "0" > "$FAILURE_COUNT_FILE"<br>fi<br><br># Check API health<br>if curl -f -s "$API_URL" > /dev/null; then<br>  echo "$(date): Python API is UP" >> "$LOG_FILE"<br>  echo "0" > "$FAILURE_COUNT_FILE"  # Reset counter<br>else<br>  echo "$(date): Python API is DOWN" >> "$LOG_FILE"<br>  <br>  # Increment failure count<br>  FAILURES=$(cat "$FAILURE_COUNT_FILE")<br>  FAILURES=$((FAILURES + 1))<br>  echo "$FAILURES" > "$FAILURE_COUNT_FILE"<br>  <br>  # Send alert after 3 consecutive failures (6 minutes)<br>  if [ "$FAILURES" -ge 3 ]; then<br>    # Send email via Resend API<br>    curl -X POST https://api.resend.com/emails \<br>      -H "Authorization: Bearer $RESEND_API_KEY" \<br>      -H "Content-Type: application/json" \<br>      -d '{<br>        "from": "alerts@retirezest.com",<br>        "to": ["'$ALERT_EMAIL'"],<br>        "subject": "üö® CRITICAL: Python API Down",<br>        "html": "<p><strong>Python API is DOWN</strong></p><p>The Python simulation API has been down for 6+ minutes.</p><p><strong>Immediate Action Required:</strong></p><ol><li>SSH into server</li><li>Check Python process: <code>lsof -ti:8000</code></li><li>Restart API: <code>cd juan-retirement-app && python -m uvicorn main:app --host 0.0.0.0 --port 8000 &</code></li><li>Verify health: <code>curl http://localhost:8000/health</code></li></ol><p>Timestamp: '$(date)'</p>"<br>      }'<br>    <br>    echo "$(date): ALERT SENT - Python API down for 6+ minutes" >> "$LOG_FILE"<br>    echo "0" > "$FAILURE_COUNT_FILE"  # Reset to avoid spam<br>  fi<br>fi<br>```<br><br>**Cron Job Setup:**<br>```bash<br># Edit crontab<br>crontab -e<br><br># Add monitoring job (every 2 minutes)<br>*/2 * * * * /home/ubuntu/retirezest/scripts/monitor-python-api.sh<br>```<br><br>**Python API Health Endpoint** (if doesn't exist):<br>```python<br># juan-retirement-app/main.py<br>@app.get("/health")<br>async def health_check():<br>    return {"status": "ok", "timestamp": datetime.now().isoformat()}<br>```<br><br>**Next.js Proxy Endpoint** (for external monitoring):<br>```typescript<br>// webapp/app/api/health/route.ts<br>export async function GET() {<br>  try {<br>    const pythonHealth = await fetch('http://localhost:8000/health');<br>    if (pythonHealth.ok) {<br>      return NextResponse.json({ status: 'ok' });<br>    }<br>    return NextResponse.json({ status: 'error' }, { status: 503 });<br>  } catch {<br>    return NextResponse.json({ status: 'error' }, { status: 503 });<br>  }<br>}<br>```<br><br>**Files to Create/Modify:**<br>1. `scripts/monitor-python-api.sh` - Monitoring script<br>2. `juan-retirement-app/main.py` - Add /health endpoint (if missing)<br>3. `webapp/app/api/health/route.ts` - Proxy for external monitoring<br>4. `README.md` - Document monitoring setup<br>5. `.env` - Add RESEND_API_KEY for alerts |
| **User Impact** | **Critical** - Python API downtime = complete simulation failure. Users cannot run simulations, health check blocks UI, no way to recover without developer intervention. Monitoring reduces downtime from hours to minutes, improving reliability from ~95% to ~99.9%. |
| **Priority Justification** | **P1 (High)** because:<br>1. **Production incident** - Just happened (Jan 31 - Feb 1, 2026)<br>2. **Complete service failure** - No simulations work when API down<br>3. **Manual discovery** - No alert, required user report + developer investigation<br>4. **High recovery time** - Hours to discover and fix<br>5. **Quick win** - Only 3 story points, 2-3 hours of work<br>6. **Prevents future incidents** - Catches downtime in 5-10 minutes instead of hours<br>7. **Low cost** - Free solution (bash script + cron) |
| **Success Metrics** | - [ ] Monitoring running 24/7 (check cron logs)<br>- [ ] Alert received within 10 minutes of API downtime<br>- [ ] False positive rate <1% (no spam alerts)<br>- [ ] Recovery time <15 minutes (alert ‚Üí restart ‚Üí verified)<br>- [ ] Zero user-reported API outages (monitoring catches first)<br>- [ ] API uptime improves from ~95% to >99% |
| **Related Stories** | - CRITICAL_BUG_FIX_SIMULATION_BUTTON_DISABLED.md (Feb 1, 2026)<br>- US-016 (Performance Monitoring)<br>- Epic 6: Quality & Testing |

---

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-051** | **User Apology & Service Recovery Campaign** | **2** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want to send a personalized apology email to users affected by the simulation button bug (Jan 31 - Feb 1) so that we can restore user trust, demonstrate accountability, and retain valuable users |
| **Affected User** | **Steven Morehouse** (steven.morehouse@gmail.com)<br>- Signed up: January 31, 2026<br>- Attempted simulation: Failed (button disabled)<br>- Impact: Unable to use core feature on first visit<br>- Recovery: Python API restarted February 1, 2026<br>- Status: Likely poor first impression, at risk of churn |
| **Acceptance Criteria** | - [ ] Personalized apology email drafted and reviewed<br>- [ ] Email sent to steven.morehouse@gmail.com<br>- [ ] Email explains what happened (Python API outage)<br>- [ ] Email acknowledges frustration and impact<br>- [ ] Email confirms issue is fixed<br>- [ ] Email offers compensation (1 month free Premium, or extended trial)<br>- [ ] Email invites feedback and questions<br>- [ ] Email includes direct contact (reply-to: founder/dev email)<br>- [ ] Follow-up scheduled if no response within 7 days |
| **Tasks** | - [ ] **Draft Email** (1 hour):<br>  - Personalized greeting ("Dear Steven")<br>  - Acknowledge sign-up date (Jan 31)<br>  - Explain bug: "Python simulation engine was temporarily offline"<br>  - Apologize sincerely: "We're sorry for the frustration this caused"<br>  - Confirm fix: "Issue resolved as of Feb 1, all simulations working"<br>  - Offer compensation:<br>    - Option A: 1 month free Premium ($X value)<br>    - Option B: Extended free trial (30 days instead of 14)<br>    - Option C: Direct offer to help with first simulation<br>  - Invite feedback: "Your experience matters to us"<br>  - Provide direct contact: "Reply to this email or call [phone]"<br>  - Sign with name + title (e.g., "Juan, Founder")<br>- [ ] **Review Email** (30 min):<br>  - Check tone (apologetic but not groveling)<br>  - Check clarity (explains issue without jargon)<br>  - Check action items (clear next steps for user)<br>  - Spell check and grammar<br>- [ ] **Send Email** (15 min):<br>  - Send via Resend API<br>  - BCC founder email (for record)<br>  - Tag email: "apology-jan31-incident"<br>  - Log in CRM/database<br>- [ ] **Follow-Up** (30 min, 7 days later):<br>  - Check if user responded<br>  - Check if user logged in again<br>  - If no response: Send gentle follow-up<br>  - If logged in: Monitor usage, offer help if needed |
| **Technical Notes** | **Email Draft Template:**<br>```<br>Subject: Our Apologies - RetireZest Simulation Issue Resolved<br><br>Dear Steven,<br><br>I'm reaching out personally to apologize for the technical issue you encountered when you signed up for RetireZest on January 31st.<br><br>Our Python simulation engine unexpectedly went offline, which prevented you from running your first retirement simulation. I can only imagine how frustrating that must have been, especially as a new user trying out our tool for the first time.<br><br>I want you to know that:<br>1. ‚úÖ The issue has been fully resolved as of February 1st<br>2. ‚úÖ We've implemented monitoring to prevent this in the future<br>3. ‚úÖ All simulation features are now working perfectly<br><br>As a sincere apology, I'd like to offer you [compensation choice]:<br>- 1 month of RetireZest Premium (normally $XX) completely free<br>- OR: I'll personally help you set up your first simulation via email or call<br><br>Your experience matters to us, and we're committed to providing you with accurate, reliable retirement planning tools. If you have any questions, concerns, or feedback, please reply to this email directly - I read every message.<br><br>Thank you for giving RetireZest a chance. I hope we can make your second experience much better than your first.<br><br>Warmly,<br>Juan<br>Founder, RetireZest<br>juan@retirezest.com<br><br>P.S. - If you'd like to try running a simulation now, everything is working and I'm here to help if you need it.<br>```<br><br>**Send via Resend API:**<br>```bash<br>curl -X POST https://api.resend.com/emails \<br>  -H "Authorization: Bearer $RESEND_API_KEY" \<br>  -H "Content-Type: application/json" \<br>  -d '{<br>    "from": "Juan <juan@retirezest.com>",<br>    "to": ["steven.morehouse@gmail.com"],<br>    "reply_to": "juan@retirezest.com",<br>    "subject": "Our Apologies - RetireZest Simulation Issue Resolved",<br>    "html": "[HTML version of email above]"<br>  }'<br>```<br><br>**Files to Create:**<br>- `scripts/send_apology_email_steven.js` - Script to send email<br>- `docs/USER_APOLOGY_JAN31_INCIDENT.md` - Document incident + response<br>- `CRITICAL_BUG_FIX_SIMULATION_BUTTON_DISABLED.md` - Update with follow-up action |
| **User Impact** | **High** - First impressions matter. Steven signed up and immediately hit a critical bug. Without outreach, high probability of churn (90% of users don't return after failed first experience). Apology email:<br>1. Shows we care about users<br>2. Demonstrates accountability<br>3. Provides context (not a permanent problem)<br>4. Offers tangible compensation<br>5. Opens communication channel<br><br>Expected outcome: 40-60% chance of re-engagement (vs 5-10% without email) |
| **Priority Justification** | **P1 (High)** because:<br>1. **User retention** - Steven at high risk of churn<br>2. **Brand reputation** - Poor first impression needs repair<br>3. **Quick win** - Only 2 story points, 2-3 hours total<br>4. **Low cost** - Just an email, optional compensation<br>5. **High ROI** - Potential to save a customer ($XX LTV)<br>6. **Demonstrates values** - Shows we care about users<br>7. **Time sensitive** - Apology most effective within 2-3 days |
| **Success Metrics** | - [ ] Email sent within 48 hours of incident<br>- [ ] Steven opens email (track with Resend)<br>- [ ] Steven logs in again within 14 days<br>- [ ] Steven runs at least 1 successful simulation<br>- [ ] Steven responds positively (or doesn't churn)<br>- [ ] Retention rate: >50% (vs expected 5-10% without outreach) |
| **Related Stories** | - CRITICAL_BUG_FIX_SIMULATION_BUTTON_DISABLED.md (Feb 1, 2026)<br>- US-050 (Python API Monitoring) - Prevents future incidents<br>- Epic 1: User Retention |

---

#### Epic 7: Performance & Optimization

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-016** | **Simulation Performance - Large Datasets** | **8** | **P3** | **üìã Backlog** |
| **Description** | As a user with complex finances, I want simulations to run in <3 seconds so that I can iterate quickly on different scenarios |
| **Acceptance Criteria** | - [ ] Simulations complete in <3 seconds<br>- [ ] Progress indicator for long operations<br>- [ ] Database queries optimized<br>- [ ] Python backend performance profiled<br>- [ ] Caching implemented where appropriate |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-044** | **Fix Cash Flow Gap Detection with High Asset Balances** | **5** | **P0** | **üìã To Do** |
| **Description** | As a user with substantial assets, I want the simulation to correctly fund my spending from available account balances so that I don't see false "funding gap" alerts when I have over $600K in assets |
| **User Feedback** | **Source**: Direct user report (January 30, 2026)<br>**User**: juanclavierb@gmail.com<br>**Issue**: "cashflow...is detecting a gap in the simulation for example...in year 2033 but there is assets over 600K, and it is not funding using the tfsa"<br>**Evidence**: Year 2033 shows:<br>- Net Worth: $613,492<br>- Total Outflows: $111,776 (spending target)<br>- Net Cash Flow: -$22,781 (Gap detected)<br>- TFSA Balance: $172,795 (not being used to fund gap)<br>- RRIF Balance: $316,512<br>- Non-Reg Balance: $124,186<br>**Expected**: Simulation should draw from TFSA ($172K available) to fund $22K gap<br>**Actual**: Simulation shows funding gap despite $600K+ assets available |
| **Acceptance Criteria** | **Investigation Phase:**<br>- [ ] Query juanclavierb@gmail.com scenario data (year 2033)<br>- [ ] Review withdrawal strategy selection<br>- [ ] Check TFSA withdrawal logic in strategy<br>- [ ] Verify withdrawal priority order in Python backend<br>- [ ] Reproduce gap with same inputs<br>- [ ] Identify root cause (locked assets? withdrawal order bug?)<br><br>**Fix Phase:**<br>- [ ] TFSA withdrawals correctly prioritized when needed<br>- [ ] Withdrawal strategies respect priority order (TFSA before Gap)<br>- [ ] Cash flow calculation accounts for all available accounts<br>- [ ] Gap only shown when truly no funds available<br>- [ ] Locked assets (GICs) properly excluded from available balance<br>- [ ] Non-locked TFSA/RRIF/NonReg properly included in available balance<br><br>**Validation:**<br>- [ ] Year 2033 for juanclavierb@gmail.com shows no gap<br>- [ ] TFSA balance decreases to fund spending<br>- [ ] Net cash flow = $0 or positive (no gap)<br>- [ ] Other years with surplus funds work correctly<br>- [ ] Test with different withdrawal strategies<br>- [ ] Test with locked vs unlocked assets |
| **Tasks** | **Week 1: Investigation (8 hours)**<br>- [ ] Query user scenario from database<br>- [ ] Review simulation inputs (age, assets, expenses, strategy)<br>- [ ] Check year 2033 detailed calculation:<br>  - [ ] Gross income sources (CPP, OAS, GIS, RRIF, etc.)<br>  - [ ] Outflows (spending target, taxes, TFSA contrib)<br>  - [ ] Withdrawals by account (RRIF, TFSA, NonReg, Corporate)<br>  - [ ] Available balances (locked vs unlocked)<br>- [ ] Review withdrawal strategy Python code:<br>  - [ ] `juan-retirement-app/modules/withdrawal_strategies.py`<br>  - [ ] Check withdrawal priority order<br>  - [ ] Check TFSA withdrawal logic<br>  - [ ] Check cash flow calculation logic<br>- [ ] Create test case reproducing the gap<br>- [ ] Document findings in US-044_INVESTIGATION_REPORT.md<br><br>**Week 2: Root Cause Analysis (4 hours)**<br>- [ ] Determine if bug is in:<br>  - [ ] Withdrawal strategy (wrong order?)<br>  - [ ] Cash flow calculation (missing accounts?)<br>  - [ ] Available balance (locked assets counted?)<br>  - [ ] Gap detection (threshold too strict?)<br>- [ ] Check if specific to certain strategies or all strategies<br>- [ ] Check if related to TFSA contribution logic (contrib before withdrawal?)<br>- [ ] Check if related to tax withholding calculations<br>- [ ] Check if year 2033 is special (age triggers? account changes?)<br><br>**Week 3: Fix Implementation (6 hours)**<br>- [ ] Update withdrawal strategy to prioritize TFSA when gap exists<br>- [ ] Ensure withdrawal order: Income ‚Üí TFSA ‚Üí RRIF ‚Üí NonReg ‚Üí Gap<br>- [ ] Fix cash flow calculation if missing accounts<br>- [ ] Fix available balance calculation if counting locked assets<br>- [ ] Update gap detection threshold if too sensitive<br>- [ ] Add logging to help debug future cash flow issues<br>- [ ] Write unit tests for withdrawal logic<br>- [ ] Write integration test for cash flow with high balances<br><br>**Week 4: Validation & Deployment (4 hours)**<br>- [ ] Re-run juanclavierb@gmail.com scenario with fix<br>- [ ] Verify year 2033 shows no gap<br>- [ ] Verify TFSA decreases appropriately<br>- [ ] Test with other user scenarios<br>- [ ] Regression test (ensure existing simulations still work)<br>- [ ] Deploy to production<br>- [ ] Follow up with user to confirm fix |
| **Technical Notes** | **Withdrawal Strategy Priority Order (Expected):**<br><br>For most strategies (minimize-income, balanced, tfsa-first), the withdrawal order should be:<br>1. **Government Benefits** (CPP, OAS, GIS) - automatic<br>2. **Pension Income** - automatic<br>3. **RRIF Minimum Withdrawal** - required by law<br>4. **Additional withdrawals to meet spending** (priority order):<br>   - TFSA (tax-free, preserves GIS)<br>   - Non-Reg (capital gains, 50% taxable)<br>   - RRIF (fully taxable)<br>   - Corporate (if applicable)<br>5. **Gap Alert** - only if all accounts depleted<br><br>**Bug Hypothesis**:<br><br>**Hypothesis 1: Withdrawal order reversed**<br>- RRIF withdrawn before TFSA (wrong priority)<br>- Results in RRIF depletion while TFSA sits unused<br>- Eventually triggers gap when RRIF empty<br><br>**Hypothesis 2: TFSA contribution blocks withdrawal**<br>- Simulation contributes to TFSA early in year<br>- Contribution not immediately available for withdrawal<br>- Causes temporary gap despite high TFSA balance<br><br>**Hypothesis 3: Available balance excludes TFSA**<br>- Cash flow calculation only considers RRIF + NonReg<br>- TFSA balance not included in "available funds"<br>- Triggers gap despite $172K TFSA<br><br>**Hypothesis 4: Locked GIC balance counted as available**<br>- If user has locked GICs in TFSA or NonReg<br>- Locked GICs counted in balance but not withdrawable<br>- Causes gap when trying to access locked funds<br><br>**Hypothesis 5: Tax withholding miscalculation**<br>- Withdrawal amount calculated before tax withholding<br>- Net cash received less than expected<br>- Creates cash flow gap despite adequate gross withdrawals<br><br>**Files to Investigate:**<br>1. `juan-retirement-app/modules/withdrawal_strategies.py` - Priority order<br>2. `juan-retirement-app/modules/simulation.py` - Cash flow calculation<br>3. `juan-retirement-app/modules/accounts.py` - Available balance logic<br>4. `juan-retirement-app/modules/models.py` - YearResult, Account models<br><br>**Database Query to Get User Scenario:**<br>```sql<br>SELECT s.id, s.name, s.householdInput, s.result<br>FROM Scenario s<br>JOIN User u ON u.id = s.userId<br>WHERE u.email = 'juanclavierb@gmail.com'<br>ORDER BY s.createdAt DESC<br>LIMIT 1;<br>```<br><br>**Test Data for Reproduction:**<br>```python<br># Year 2033 (from screenshot)<br>year_result = {<br>  'year': 2033,<br>  'age': [72, 70],  # Person 1 age 72, Person 2 age 70<br>  'spending_target': 111776,<br>  'gross_income': 88996,<br>  'total_outflows': 111776,<br>  'net_cash_flow': -22781,  # GAP!<br>  'tfsa_balance': 172795,  # Available but not used?<br>  'rrif_balance': 316512,<br>  'nonreg_balance': 124186,<br>  'net_worth': 613492,<br>}<br>```<br><br>**Expected After Fix:**<br>```python<br># Year 2033 (after fix)<br>year_result = {<br>  'year': 2033,<br>  'age': [72, 70],<br>  'spending_target': 111776,<br>  'gross_income': 88996,<br>  'tfsa_withdrawal': 22781,  # NEW: Withdraw from TFSA to cover gap<br>  'total_outflows': 111776,<br>  'net_cash_flow': 0,  # NO GAP!<br>  'tfsa_balance': 150014,  # Decreased by withdrawal<br>  'rrif_balance': 316512,<br>  'nonreg_balance': 124186,<br>  'net_worth': 613492,<br>}<br>``` |
| **User Impact** | **CRITICAL** - False funding gap alerts undermine user confidence in the tool. When users see "Gap" warnings despite having $600K+ in assets, they lose trust in simulation accuracy. This is especially problematic for users with TFSA balances who expect those funds to be used for retirement spending. |
| **Root Cause Hypothesis** | **Most Likely**: Withdrawal strategy not prioritizing TFSA withdrawals to cover spending gaps. The simulation engine may be:<br>1. Only withdrawing RRIF minimums (not additional amounts)<br>2. Not accessing TFSA when additional funds needed<br>3. Incorrectly calculating available balance (excluding TFSA)<br>4. Processing TFSA contribution before withdrawal (timing issue)<br><br>**Less Likely**:<br>- Locked GICs preventing TFSA access (would need to confirm user has GICs)<br>- Tax withholding creating larger-than-expected gap<br>- Strategy-specific bug (only affects certain withdrawal strategies) |
| **Dependencies** | - Access to juanclavierb@gmail.com scenario data<br>- Python backend simulation engine (`juan-retirement-app/`)<br>- Withdrawal strategy implementation<br>- Cash flow calculation logic |
| **Priority Justification** | **P0 (Critical)** because:<br>1. **User Trust Issue** - False gap alerts destroy confidence<br>2. **Data Accuracy** - Simulation showing incorrect cash flow<br>3. **High Asset Impact** - Users with $600K+ assets expect accurate results<br>4. **TFSA Feature** - TFSA withdrawals are core feature not working<br>5. **Withdrawal Strategy Bug** - May affect all users, not just one<br>6. **User Satisfaction Risk** - Could lead to account deletion |
| **Success Metrics** | - [ ] juanclavierb@gmail.com year 2033 shows zero gap<br>- [ ] TFSA balance used to fund spending shortfalls<br>- [ ] All simulations with surplus assets (>$100K) show zero gaps<br>- [ ] Withdrawal strategies correctly prioritize accounts<br>- [ ] User reports simulation is now accurate<br>- [ ] Zero false gap alerts in production (next 30 days) |
| **Related Stories** | - US-013 (RRIF Strategy Validation) - Withdrawal order<br>- US-035 (E2E Withdrawal Strategy Tests) - Testing<br>- US-016 (Simulation Performance) - Cash flow calculation |
| **Next Steps** | 1. ‚úÖ Create user story (US-044) and add to backlog<br>2. Query juanclavierb@gmail.com scenario data<br>3. Reproduce gap in test environment<br>4. Investigate withdrawal strategy code<br>5. Identify and fix root cause<br>6. Deploy fix to production<br>7. Verify with user scenario |
| **Tasks** | - [ ] Profile current performance<br>- [ ] Identify bottlenecks<br>- [ ] Optimize database queries<br>- [ ] Add caching layer<br>- [ ] Test with large datasets<br>- [ ] Document performance benchmarks |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-017** | **Mobile Responsiveness - Simulation Results** | **5** | **P3** | **üìã Backlog** |
| **Description** | As a mobile user, I want simulation results to be readable and interactive on my phone so that I can review my plan anywhere |
| **Acceptance Criteria** | - [ ] Charts render correctly on mobile<br>- [ ] Tables are scrollable/collapsible<br>- [ ] Touch gestures work (pinch zoom)<br>- [ ] All buttons/links are tappable<br>- [ ] Text is readable without zooming |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-043** | **Mobile: Change Withdrawal Strategy After Simulation Results** | **3** | **P2** | **üìã To Do** |
| **Description** | As a mobile user, I want to change the withdrawal strategy after viewing simulation results so that I can compare different strategies without re-entering my profile data |
| **Acceptance Criteria** | - [ ] **Strategy Selector Visible**: Withdrawal strategy dropdown/selector visible on mobile after simulation runs<br>- [ ] **Mobile-Friendly UI**: Strategy selector uses mobile-optimized component (large touch targets, native select or bottom sheet)<br>- [ ] **Immediate Re-Simulation**: Changing strategy triggers new simulation run automatically<br>- [ ] **Loading State**: Shows loading indicator while re-simulating<br>- [ ] **Results Update**: Simulation results update in-place (no page reload)<br>- [ ] **Strategy Label Displayed**: Current strategy name shown clearly above/below results<br>- [ ] **Desktop Parity**: Works identically to desktop version (feature parity)<br>- [ ] **No Scrolling Issues**: Strategy selector accessible without excessive scrolling<br>- [ ] **Touch Target Size**: Minimum 44x44px touch targets (iOS/Android guidelines)<br>- [ ] **Works in Portrait & Landscape**: Responsive in both orientations |
| **Tasks** | - [ ] **Investigation** (1 hour):<br>  - Inspect current desktop implementation of strategy switching<br>  - Identify CSS/responsive breakpoints causing mobile issues<br>  - Check if component is hidden on mobile (display: none at breakpoints)<br>  - Review mobile simulation results layout<br>  - Screenshot current mobile behavior for before/after<br>- [ ] **Design** (1 hour):<br>  - Choose mobile UI pattern:<br>    - Option A: Native `<select>` dropdown (simplest)<br>    - Option B: Bottom sheet modal with strategy cards<br>    - Option C: Horizontal scrollable strategy pills<br>  - Design placement: Top of results, sticky header, or inline section<br>  - Create mobile mockup/wireframe<br>  - Review with team for approval<br>- [ ] **Frontend Implementation** (4 hours):<br>  - Update simulation results component responsive styles<br>  - Make strategy selector visible at mobile breakpoints<br>  - Increase touch target sizes (min 44x44px)<br>  - Add mobile-specific styling (larger text, spacing)<br>  - Implement strategy change handler (trigger re-simulation)<br>  - Add loading state during re-simulation<br>  - Update results in-place (no page reload)<br>  - Show current strategy label above results<br>  - Test in portrait and landscape orientations<br>- [ ] **Testing** (2 hours):<br>  - Test on iOS Safari (iPhone 12, 13, 14)<br>  - Test on Android Chrome (Samsung, Pixel)<br>  - Test on tablet (iPad, Android tablet)<br>  - Verify touch targets are tappable<br>  - Verify dropdown opens correctly<br>  - Verify simulation re-runs on strategy change<br>  - Verify results update without page reload<br>  - Test with all 6 withdrawal strategies<br>  - Test with slow network (loading state)<br>- [ ] **Documentation** (1 hour):<br>  - Update user documentation<br>  - Screenshot mobile strategy switching flow<br>  - Document responsive breakpoints used<br>  - Add to release notes |
| **Technical Notes** | **Current Issue**:<br>- Strategy selector likely hidden on mobile via CSS media query<br>- Or has insufficient touch target size<br>- Or positioned off-screen due to layout constraints<br><br>**Files to Update**:<br>- `webapp/app/(dashboard)/simulation/page.tsx` - Main simulation results page<br>- `webapp/components/simulation/StrategySelector.tsx` - Strategy selector component (if exists)<br>- Styles in CSS modules or Tailwind classes<br><br>**Implementation Approach**:<br>```tsx<br>// Add responsive visibility<br>className="block w-full md:w-auto" // visible on all screen sizes<br><br>// Mobile-optimized select<br><select<br>  className="w-full p-3 text-base rounded-lg" // larger padding, text<br>  style={{ minHeight: '44px' }} // iOS touch target<br>  onChange={(e) => {<br>    setStrategy(e.target.value);<br>    runSimulation(e.target.value); // immediate re-run<br>  }}<br>><br>  {strategyOptions.map(s => (<br>    <option key={s.value} value={s.value}>{s.label}</option><br>  ))}<br></select><br><br>// Show current strategy<br><div className="mb-4 p-3 bg-blue-50 rounded-lg"><br>  <p className="text-sm text-gray-600">Current Strategy:</p><br>  <p className="text-lg font-semibold">{currentStrategyLabel}</p><br></div><br>```<br><br>**Responsive Breakpoints**:<br>- Mobile: < 640px (Tailwind `sm:`)<br>- Tablet: 640px - 1024px (Tailwind `md:` to `lg:`)<br>- Desktop: > 1024px (Tailwind `lg:` and up)<br><br>**Alternative: Bottom Sheet Modal** (for enhanced UX):<br>- Use shadcn/ui Sheet component<br>- Shows all 6 strategies as cards with descriptions<br>- Better for discovery and education<br>- More development effort (6 hours instead of 4)<br><br>**Related Code**:<br>- Strategy map: `webapp/app/(dashboard)/simulation/page.tsx:252`<br>- Withdrawal strategies: 6 total (minimize-income, balanced-income, early-rrif-withdrawal, max-tfsa-first, corporate-optimized, preserve-estate)<br>- API endpoint: `/api/simulation/run` (already supports strategy parameter) |
| **User Impact** | **High** - Mobile users currently cannot compare withdrawal strategies without navigating away from results. This creates friction and prevents users from exploring different options. Many users review retirement plans on mobile devices (30-40% of traffic), so this is a critical UX gap. |
| **Known Issues** | **Current Behavior**:<br>- Desktop: Strategy selector visible and functional ‚úÖ<br>- Mobile: Strategy selector hidden, not accessible, or too small to use ‚ùå<br>- User must go back to profile/settings to change strategy<br>- Loses context of current results when navigating away<br>- Frustrating user experience on mobile<br><br>**User Feedback** (implied):<br>"Able to change the simulation strategy in mobile version once it has run and provided the result" - Direct user request |
| **Priority Justification** | **P2 (Medium)** because:<br>1. **High mobile usage** - 30-40% of users on mobile devices<br>2. **Feature parity** - Desktop has this, mobile should too<br>3. **User request** - Explicitly requested by user<br>4. **Quick win** - Only 3 story points, ~8 hours of work<br>5. **High impact** - Significantly improves mobile UX<br>6. **Low risk** - Feature already works on desktop, just needs responsive fixes<br>7. **Comparison critical** - Users need to compare strategies to make informed decisions |
| **Success Metrics** | - [ ] Strategy selector visible on mobile devices (100% of screen sizes)<br>- [ ] Touch target size ‚â• 44x44px (iOS/Android guidelines met)<br>- [ ] Strategy change triggers re-simulation in < 1 second<br>- [ ] 0 user complaints about mobile strategy switching<br>- [ ] Mobile conversion rate (strategy changes) equals desktop rate<br>- [ ] User testing shows >90% can successfully change strategies on mobile<br>- [ ] Works on iOS Safari, Android Chrome, mobile Firefox |
| **User Journey** | **Before (Current - Broken)**:<br>1. User runs simulation on mobile<br>2. Views results<br>3. Wants to try different strategy<br>4. ‚ùå Cannot find strategy selector<br>5. Navigates back to profile or settings<br>6. Changes strategy setting (if exists)<br>7. Re-runs simulation<br>8. Frustration and lost context<br><br>**After (Fixed)**:<br>1. User runs simulation on mobile ‚úÖ<br>2. Views results ‚úÖ<br>3. Sees current strategy label ("Income Minimization") ‚úÖ<br>4. Taps strategy dropdown/selector ‚úÖ<br>5. Selects "Balanced Income" ‚úÖ<br>6. Simulation automatically re-runs (loading indicator) ‚úÖ<br>7. Results update in-place ‚úÖ<br>8. Compares new results to previous ‚úÖ<br>9. Tries 3-4 different strategies easily ‚úÖ<br>10. Makes informed decision ‚úÖ |
| **Dependencies** | - Simulation API working (`/api/simulation/run`)<br>- Desktop strategy switching functional (already working)<br>- Mobile responsive framework (Tailwind already in use)<br>- No backend changes required (API already supports strategy parameter) |
| **Related Stories** | - US-017 (Mobile Responsiveness) - Related mobile UX improvement<br>- US-025 (Strategy Discoverability) - Uses strategy selector component<br>- US-026 (Display Current Strategy) - Shows current strategy label<br>- US-042 (Strategy Name Alignment) - Ensures consistent naming |
| **Examples** | **Example 1: Low-Income Senior**<br>- Runs simulation with "Balanced Income" strategy<br>- Views results: Health Score 75%, $200K final estate<br>- Switches to "Income Minimization (GIS-Optimized)" on mobile<br>- New results: Health Score 85%, $220K final estate, +$40K GIS received<br>- Realizes GIS strategy is better, saves plan<br><br>**Example 2: Couple Comparing Strategies**<br>- Runs "Early RRIF Withdrawals (Income Splitting)"<br>- Switches to "TFSA First" on mobile<br>- Compares tax totals and final estates<br>- Decides on best strategy based on comparison<br>- All done on mobile without desktop access |
| **Tasks** | - [ ] Audit mobile experience<br>- [ ] Fix chart responsiveness<br>- [ ] Add mobile-friendly tables<br>- [ ] Test on iOS and Android<br>- [ ] Optimize touch targets |

---

### Low Priority (Future Sprints)

#### Epic 8: Advanced Features

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-018** | **Scenario Comparison - Side-by-Side** | **13** | **P4** | **üìã Backlog** |
| **Description** | As a user, I want to compare 2-3 simulations side-by-side so that I can make informed decisions about retirement strategies |
| **Acceptance Criteria** | - [ ] Select up to 3 saved simulations<br>- [ ] View key metrics in comparison table<br>- [ ] Charts overlay different scenarios<br>- [ ] Highlight differences/tradeoffs<br>- [ ] Export comparison to PDF |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-019** | **Monte Carlo Simulation** | **21** | **P4** | **üìã Backlog** |
| **Description** | As a sophisticated user, I want to see probability distributions for my retirement outcomes so that I can understand risk levels |
| **Acceptance Criteria** | - [ ] Run 1000+ simulation iterations<br>- [ ] Show probability of success (10th, 50th, 90th percentile)<br>- [ ] Configurable variables (returns, inflation)<br>- [ ] Visual confidence intervals<br>- [ ] Performance optimized (<10 seconds) |

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-020** | **Social Security Integration (US)** | **34** | **P5** | **üìã Icebox** |
| **Description** | As a US user, I want to plan retirement with Social Security instead of CPP/OAS so that I can use RetireZest for US retirement planning |
| **Acceptance Criteria** | - [ ] SSA benefit calculator integrated<br>- [ ] Country selector in profile<br>- [ ] US tax calculations<br>- [ ] Medicare cost estimates<br>- [ ] State tax variations |
| **Notes** | Large effort, low ROI. Focus on Canadian market first. |

---

#### Epic 9: Security & Compliance

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-030** | **Comprehensive Security Controls Audit** | **13** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want a comprehensive security audit of the application to identify and remediate vulnerabilities so that user data remains protected and we comply with industry best practices |
| **Acceptance Criteria** | - [ ] Authentication security reviewed (password hashing, session management)<br>- [ ] Authorization controls audited (role-based access, admin controls)<br>- [ ] Input validation reviewed (SQL injection, XSS prevention)<br>- [ ] API security assessed (CSRF protection, rate limiting)<br>- [ ] Data encryption verified (at rest and in transit)<br>- [ ] Environment variable security confirmed (no secrets in code)<br>- [ ] Third-party dependencies audited (npm audit, known CVEs)<br>- [ ] OWASP Top 10 checklist completed<br>- [ ] Security headers configured (CSP, HSTS, X-Frame-Options)<br>- [ ] File upload security reviewed (if applicable)<br>- [ ] Logging and monitoring for security events<br>- [ ] Incident response plan documented |
| **Tasks** | - [ ] Authentication Audit:<br>  - [ ] Review password hashing (bcrypt/argon2)<br>  - [ ] Check session token security<br>  - [ ] Verify password reset flow security<br>  - [ ] Test for session fixation vulnerabilities<br>  - [ ] Audit email verification process<br><br>- [ ] Authorization Audit:<br>  - [ ] Review admin access controls (requireAdmin)<br>  - [ ] Test for privilege escalation vulnerabilities<br>  - [ ] Verify user data isolation (users can't access others' data)<br>  - [ ] Check API endpoint authorization<br>  - [ ] Review premium feature gating security<br><br>- [ ] Input Validation:<br>  - [ ] Test all forms for XSS vulnerabilities<br>  - [ ] Review SQL injection prevention (Prisma parameterization)<br>  - [ ] Check for command injection risks<br>  - [ ] Validate file upload security (if any)<br>  - [ ] Test for path traversal vulnerabilities<br><br>- [ ] API Security:<br>  - [ ] Verify CSRF protection on all POST/PUT/DELETE routes<br>  - [ ] Implement rate limiting on sensitive endpoints<br>  - [ ] Review CORS configuration<br>  - [ ] Check for API enumeration vulnerabilities<br>  - [ ] Audit webhook security (Stripe webhooks)<br><br>- [ ] Data Protection:<br>  - [ ] Verify database encryption at rest (Neon/Vercel Postgres)<br>  - [ ] Confirm TLS/SSL for all connections<br>  - [ ] Review PII handling (email, financial data)<br>  - [ ] Check for sensitive data in logs<br>  - [ ] Audit account deletion flow (GDPR compliance)<br><br>- [ ] Infrastructure Security:<br>  - [ ] Review Vercel security settings<br>  - [ ] Audit environment variable management<br>  - [ ] Check for secrets in git history<br>  - [ ] Review deployment access controls<br>  - [ ] Verify database access restrictions<br><br>- [ ] Dependency Security:<br>  - [ ] Run npm audit and fix vulnerabilities<br>  - [ ] Review critical dependencies (Next.js, Prisma, Stripe)<br>  - [ ] Check for outdated packages with known CVEs<br>  - [ ] Implement Dependabot or Snyk monitoring<br><br>- [ ] Security Headers:<br>  - [ ] Configure Content-Security-Policy<br>  - [ ] Enable HSTS (Strict-Transport-Security)<br>  - [ ] Set X-Frame-Options to prevent clickjacking<br>  - [ ] Configure X-Content-Type-Options<br>  - [ ] Set Referrer-Policy<br><br>- [ ] Logging & Monitoring:<br>  - [ ] Log authentication failures (brute force detection)<br>  - [ ] Monitor admin access (audit trail)<br>  - [ ] Alert on suspicious activity (rate limit violations)<br>  - [ ] Log payment failures and webhook errors<br>  - [ ] Set up Sentry or similar error monitoring<br><br>- [ ] Compliance:<br>  - [ ] OWASP Top 10 checklist review<br>  - [ ] GDPR compliance verification (account deletion, data export)<br>  - [ ] PCI DSS considerations (Stripe handles cards, but verify)<br>  - [ ] Privacy policy review<br>  - [ ] Terms of service review |
| **Technical Notes** | **Critical Areas to Audit:**<br><br>**1. Authentication (app/api/auth/):**<br>- Login: `app/api/auth/login/route.ts`<br>- Register: `app/api/auth/register/route.ts`<br>- Password reset: `app/api/auth/forgot-password/route.ts`, `app/api/auth/reset-password/route.ts`<br>- Email verification: `app/api/auth/verify-email/route.ts`<br>- Session management: Cookie-based or JWT?<br><br>**2. Authorization (lib/admin-auth.ts, middleware):**<br>- `requireAdmin()` function security<br>- User data isolation in Prisma queries<br>- Premium feature gating logic<br><br>**3. Sensitive Endpoints:**<br>- `/api/admin/*` - Admin-only access<br>- `/api/profile/*` - User data CRUD<br>- `/api/subscription/*` - Payment processing<br>- `/api/simulation/*` - Financial calculations<br>- `/api/webhooks/stripe` - Stripe webhook handler<br><br>**4. CSRF Protection:**<br>- `/api/csrf` endpoint provides token<br>- Verify all mutating operations validate CSRF token<br><br>**5. Environment Variables:**<br>- DATABASE_URL (should not be in code)<br>- STRIPE_SECRET_KEY (must be secure)<br>- RESEND_API_KEY (email service)<br>- JWT_SECRET or SESSION_SECRET<br><br>**6. Known Issues from Build:**<br>- 25 npm vulnerabilities (1 low, 14 moderate, 8 high, 2 critical)<br>- Need to prioritize and remediate<br><br>**7. Security Headers (next.config.js or middleware):**<br>```typescript<br>const securityHeaders = [<br>  { key: 'X-Frame-Options', value: 'DENY' },<br>  { key: 'X-Content-Type-Options', value: 'nosniff' },<br>  { key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' },<br>  { key: 'Strict-Transport-Security', value: 'max-age=31536000; includeSubDomains' },<br>  { key: 'Content-Security-Policy', value: "default-src 'self'; ..." }<br>];<br>```<br><br>**8. Rate Limiting (consider implementing):**<br>- Login attempts: 5 per 15 minutes<br>- Password reset: 3 per hour<br>- API calls: 100 per minute per user<br>- Admin endpoints: 50 per minute |
| **User Impact** | **Critical** - Security breaches can result in:<br>- Loss of user trust and reputation damage<br>- Financial liability (GDPR fines, legal costs)<br>- User data exposure (PII, financial data)<br>- Service disruption from attacks<br>- Regulatory compliance issues |
| **Known Security Features (to verify):**<br>- ‚úÖ CSRF protection exists (`/api/csrf`)<br>- ‚úÖ Admin access control (`requireAdmin`)<br>- ‚úÖ Prisma ORM (SQL injection protection)<br>- ‚úÖ HTTPS enforced (Vercel)<br>- ‚ö†Ô∏è Rate limiting: Unknown<br>- ‚ö†Ô∏è Security headers: Unknown<br>- ‚ö†Ô∏è Input validation: Needs review<br>- ‚ö†Ô∏è Session security: Needs review |
| **Success Metrics** | - [ ] Zero critical vulnerabilities found<br>- [ ] All OWASP Top 10 risks mitigated<br>- [ ] 100% of npm critical/high vulnerabilities fixed<br>- [ ] Security headers score A+ on securityheaders.com<br>- [ ] Penetration testing completed (manual or automated)<br>- [ ] Security incident response plan documented<br>- [ ] All team members trained on security best practices |
| **Dependencies** | - Access to production environment (for header testing)<br>- Security testing tools (OWASP ZAP, Burp Suite, or similar)<br>- npm audit and Snyk/Dependabot setup<br>- Security expert review (internal or external consultant) |
| **References** | - OWASP Top 10: https://owasp.org/www-project-top-ten/<br>- Next.js Security: https://nextjs.org/docs/app/building-your-application/configuring/content-security-policy<br>- Vercel Security: https://vercel.com/docs/security<br>- Prisma Security: https://www.prisma.io/docs/concepts/components/prisma-client/security |

---

#### Epic 10: Monetization & Revenue

| ID | User Story | Story Points | Priority | Status |
|----|------------|--------------|----------|--------|
| **US-024** | **Premium Account Verification & Payment Acceptance Testing** | **8** | **P0** | **üìã To Do** |
| **Description** | As a product owner, I want comprehensive testing and verification of the Stripe premium subscription system so that users can successfully subscribe and access premium features without payment failures |
| **Acceptance Criteria** | - [ ] Stripe checkout session creation works (monthly & yearly plans)<br>- [ ] Payment processing completes successfully for test cards<br>- [ ] Webhook handlers process subscription events correctly<br>- [ ] User account upgraded to premium after successful payment<br>- [ ] Premium features unlock immediately after payment<br>- [ ] Billing portal allows users to manage subscriptions<br>- [ ] Cancellation flow works correctly<br>- [ ] Failed payment handling works (retry logic, notifications)<br>- [ ] Subscription renewal works for existing subscribers<br>- [ ] Edge cases tested (promo codes, refunds, disputes)<br>- [ ] Production Stripe credentials configured correctly<br>- [ ] Monitoring and alerting set up for payment failures |
| **Tasks** | - [ ] Test monthly subscription ($5.99/month)<br>- [ ] Test yearly subscription ($47.00/year)<br>- [ ] Test Stripe Checkout redirect flow<br>- [ ] Verify webhook endpoint receives events<br>- [ ] Test checkout.session.completed webhook<br>- [ ] Test customer.subscription.created webhook<br>- [ ] Test customer.subscription.updated webhook<br>- [ ] Test customer.subscription.deleted webhook<br>- [ ] Test invoice.payment_succeeded webhook<br>- [ ] Test invoice.payment_failed webhook<br>- [ ] Verify user isPremium flag updates correctly<br>- [ ] Test premium feature gating (early retirement, scenarios, reports)<br>- [ ] Test billing portal redirect<br>- [ ] Test subscription cancellation<br>- [ ] Test subscription reactivation<br>- [ ] Test failed payment retry logic<br>- [ ] Load test checkout flow (100+ concurrent users)<br>- [ ] Verify Stripe Dashboard shows correct data<br>- [ ] Document common payment issues and resolutions<br>- [ ] Create monitoring dashboard for payment metrics |
| **Technical Notes** | **Frontend Components:**<br>- `app/(dashboard)/subscribe/page.tsx` - Subscription page<br>- `app/(dashboard)/subscribe/success/page.tsx` - Success page<br>- `app/(dashboard)/account/billing/page.tsx` - Billing portal<br><br>**Backend API Routes:**<br>- `app/api/subscription/create-checkout/route.ts` - Checkout session creation<br>- `app/api/subscription/billing-portal/route.ts` - Billing portal access<br>- `app/api/webhooks/stripe/route.ts` - Webhook event handling<br><br>**Stripe Configuration:**<br>- `lib/stripe.ts` - Stripe client and utilities<br>- Environment variables: STRIPE_SECRET_KEY, STRIPE_PREMIUM_MONTHLY_PRICE_ID, STRIPE_PREMIUM_YEARLY_PRICE_ID<br><br>**Price IDs to Verify:**<br>- Monthly: $5.99/month<br>- Yearly: $47.00/year (saves $25/year)<br><br>**Test Cards:**<br>- Success: 4242 4242 4242 4242<br>- Decline: 4000 0000 0000 0002<br>- Requires Auth: 4000 0025 0000 3155 |
| **User Impact** | **Critical** - Revenue depends on working payment system. Payment failures result in lost subscriptions and revenue. Users expect seamless checkout experience. |
| **Known Issues** | - Stripe integration already deployed to production<br>- Monthly/yearly plans configured<br>- Webhook endpoint exists but needs comprehensive testing<br>- No load testing conducted yet<br>- No monitoring dashboard for payment metrics<br>- Unclear if production credentials are configured correctly<br>- Test scripts exist: check-production-stripe.ts, get-stripe-prices.ts |
| **Success Metrics** | - [ ] 100% success rate on test card transactions<br>- [ ] <2% payment failure rate in production<br>- [ ] 100% of webhooks processed within 5 seconds<br>- [ ] Zero missed subscription activations<br>- [ ] 95% uptime for payment infrastructure<br>- [ ] <1% customer support tickets related to payment issues |
| **Dependencies** | - Stripe account with production access<br>- Production environment variables configured<br>- Webhook endpoint registered with Stripe<br>- Test credit cards for various scenarios |

---

| **US-032** | **Premium Benefits Verification & End-to-End Testing** | **8** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want to verify that all premium features work correctly end-to-end and that the premium value proposition is clear to users, so that premium subscribers get full value for their subscription |
| **Acceptance Criteria** | **Premium Feature Testing:**<br>- [ ] Early retirement calculator accessible only to premium users<br>- [ ] Multiple market scenarios (pessimistic, neutral, optimistic) work correctly<br>- [ ] CSV export functionality works for all data types<br>- [ ] PDF report generation works and includes all sections<br>- [ ] Full data export includes all user data<br>- [ ] Interactive retirement age slider functions correctly<br>- [ ] Detailed year-by-year projections display properly<br>- [ ] Advanced charts render correctly<br>- [ ] Priority email support auto-routes correctly<br><br>**Feature Gating:**<br>- [ ] Free users see upgrade prompts for premium features<br>- [ ] Premium users see no upgrade prompts<br>- [ ] Feature gate UI is clear and non-intrusive<br>- [ ] Upgrade flow from feature gate works seamlessly<br><br>**User Experience:**<br>- [ ] Premium badge shows on account page<br>- [ ] Premium features highlighted in UI<br>- [ ] Value proposition clear on subscription page<br>- [ ] Premium benefits documented in help section<br><br>**Edge Cases:**<br>- [ ] Subscription expiration handled gracefully<br>- [ ] Downgrade from premium to free works<br>- [ ] Mid-use feature access revoked correctly<br>- [ ] Premium features persist across sessions |
| **Tasks** | **E2E Premium User Journey:**<br>- [ ] Test signup ‚Üí subscribe ‚Üí use premium features flow<br>- [ ] Test free user ‚Üí hit feature gate ‚Üí upgrade ‚Üí access feature<br>- [ ] Test premium user ‚Üí cancel ‚Üí downgrade ‚Üí restricted access<br>- [ ] Test premium user ‚Üí subscription expires ‚Üí grace period ‚Üí downgrade<br><br>**Individual Feature Testing:**<br>- [ ] Early retirement calculator (calculations accurate)<br>- [ ] Market scenarios (3 scenarios generate different results)<br>- [ ] CSV export (all columns present, data accurate)<br>- [ ] PDF report (all sections render, data matches dashboard)<br>- [ ] Data export (JSON structure complete, no PII leaks)<br>- [ ] Retirement age slider (smooth interaction, recalculates correctly)<br>- [ ] Year-by-year projections (accurate, complete, formatted)<br>- [ ] Advanced charts (responsive, interactive, data-driven)<br><br>**Feature Gate UI Testing:**<br>- [ ] Audit all premium feature gates in codebase<br>- [ ] Test each gate with free and premium accounts<br>- [ ] Verify upgrade modal appearance and messaging<br>- [ ] Test "Upgrade to Premium" button flows<br><br>**Documentation:**<br>- [ ] Create premium features testing checklist<br>- [ ] Document expected vs actual behavior for each feature<br>- [ ] Screenshot all premium features for reference<br>- [ ] Create premium feature demo video |
| **Technical Notes** | **Premium Features List:**<br>1. Early retirement calculator (`/early-retirement`)<br>2. Multiple market scenarios (pessimistic, neutral, optimistic)<br>3. CSV export (`/api/simulation/export/csv`)<br>4. PDF report generation (html2pdf.js)<br>5. Full data export (`/api/account/export`)<br>6. Interactive retirement age slider<br>7. Detailed year-by-year projections<br>8. Advanced charts (all chart components)<br>9. Priority email support<br><br>**Feature Gate Components:**<br>- `components/modals/UpgradeModal.tsx`<br>- Feature checks: `isPremium` flag in session<br>- Premium routes: Check `/app/(dashboard)` for premium-only pages<br><br>**Test Accounts Needed:**<br>- Free account (to test gates)<br>- Premium account (to test features)<br>- Expired premium account (to test downgrade)<br><br>**Data to Verify:**<br>- CSV: All account types, income sources, expenses<br>- PDF: Health score, charts, action plan, year-by-year<br>- Export: Complete user profile without sensitive data |
| **User Impact** | **High** - Premium users pay for features and expect them to work. Feature gates must not frustrate free users. Clear value proposition increases conversion rate. |
| **Known Issues** | - Premium features implemented incrementally<br>- No comprehensive E2E test suite for premium flow<br>- Feature gates may be inconsistent across app<br>- PDF generation may have formatting issues<br>- CSV export columns may be incomplete<br>- No automated testing for premium features<br>- Upgrade modal styling may vary across pages |
| **Success Metrics** | - [ ] 100% of premium features functional<br>- [ ] Zero critical bugs in premium features<br>- [ ] <5% premium support tickets about feature access<br>- [ ] 10%+ conversion rate from free to premium (via feature gates)<br>- [ ] 90%+ premium subscriber satisfaction (feature quality)<br>- [ ] <1% churn due to feature issues |
| **Dependencies** | - US-024 completed (payment system working)<br>- Premium Stripe subscription active for testing<br>- Access to Stripe test environment<br>- PDF generation library (html2pdf.js) functional<br>- CSV export tested with real user data |
| **Related Stories** | US-024 (Premium Payment Testing), US-008 (Wizard Pre-fill) |

---

| **US-033** | **PDF Report Content & Formatting Improvements** | **5** | **P2** | **üìã To Do** |
| **Description** | As a premium user, I want professional, well-formatted PDF reports that display correctly on both web and mobile devices, so that I can share my retirement plan with family, advisors, or save for my records |
| **Acceptance Criteria** | **Content Completeness:**<br>- [ ] Cover page with user name, generation date, and branding<br>- [ ] Executive summary (health score, key insights, final estate)<br>- [ ] Household information (names, ages, province, planning horizon)<br>- [ ] Assets breakdown (TFSA, RRSP, RRIF, NonReg, Real Estate)<br>- [ ] Income sources (CPP, OAS, GIS, pensions, employment)<br>- [ ] Expenses summary (Go-Go, Slow-Go, No-Go phases + one-time)<br>- [ ] Withdrawal strategy explanation<br>- [ ] Health score breakdown (success rate, years funded)<br>- [ ] All major charts (portfolio, tax, spending, benefits)<br>- [ ] Year-by-year projection table (key years)<br>- [ ] Action plan with prioritized recommendations<br>- [ ] Assumptions and methodology<br>- [ ] Disclaimer and contact information<br><br>**Formatting & Design:**<br>- [ ] Professional layout with proper spacing<br>- [ ] Page breaks in logical places<br>- [ ] Headers/footers with page numbers<br>- [ ] Consistent typography (fonts, sizes, weights)<br>- [ ] Brand colors and styling<br>- [ ] High-resolution charts (no pixelation)<br>- [ ] Tables formatted with borders and alignment<br>- [ ] Print-friendly (no wasted ink/space)<br>- [ ] Portrait orientation (standard letter size)<br><br>**Web & Mobile Rendering:**<br>- [ ] PDF renders correctly in Chrome, Safari, Firefox<br>- [ ] Mobile browsers can download and view PDF<br>- [ ] Tablets display PDF correctly<br>- [ ] File size optimized (<5MB for typical report)<br>- [ ] Loading state shows generation progress<br>- [ ] Error handling if generation fails<br><br>**User Experience:**<br>- [ ] "Generate PDF Report" button prominent in results<br>- [ ] Premium gate shows for free users<br>- [ ] Generation takes <10 seconds<br>- [ ] Filename includes user name and date<br>- [ ] Option to email PDF to self (future)<br>- [ ] Preview option before download (future) |
| **Tasks** | **Content Review:**<br>- [ ] Audit current PDF content (what's included?)<br>- [ ] Identify missing sections<br>- [ ] Review competitor PDF reports for best practices<br>- [ ] Get user feedback on desired content<br><br>**Design & Layout:**<br>- [ ] Design PDF template mockup (Figma/similar)<br>- [ ] Define typography system (fonts, sizes)<br>- [ ] Create color scheme (brand + print-friendly)<br>- [ ] Design chart rendering (size, placement)<br>- [ ] Plan page breaks and sections<br>- [ ] Design cover page<br>- [ ] Design footer with page numbers<br><br>**Implementation:**<br>- [ ] Refactor PDF generation code (currently ad-hoc)<br>- [ ] Implement template system (reusable components)<br>- [ ] Improve chart rendering (canvas ‚Üí high-res image)<br>- [ ] Add missing content sections<br>- [ ] Implement proper page breaks<br>- [ ] Add headers/footers<br>- [ ] Optimize file size (compress images, remove bloat)<br>- [ ] Add loading state with progress indicator<br>- [ ] Implement error handling and retry logic<br><br>**Testing:**<br>- [ ] Test PDF generation with various data (small, large, edge cases)<br>- [ ] Test on Chrome, Safari, Firefox (desktop)<br>- [ ] Test on iOS Safari, Chrome Mobile, Android Chrome<br>- [ ] Test on tablets (iPad, Android tablet)<br>- [ ] Test printing from PDF (real printer)<br>- [ ] Test file sizes (<5MB goal)<br>- [ ] Test generation performance (<10 sec goal)<br>- [ ] User testing for readability and usefulness<br><br>**Documentation:**<br>- [ ] Document PDF generation process<br>- [ ] Create troubleshooting guide<br>- [ ] Add help article: "Understanding Your PDF Report"<br>- [ ] Screenshot sections for documentation |
| **Technical Notes** | **Current Implementation:**<br>- Library: `html2pdf.js` (now at v0.14.0, fixed XSS vulnerability)<br>- Component: Likely in dashboard or results page<br>- Approach: Renders HTML ‚Üí converts to PDF<br><br>**Challenges:**<br>1. **Chart Rendering**: Recharts uses SVG/Canvas, may not export well<br>   - Solution: Convert charts to high-res images before PDF generation<br><br>2. **Page Breaks**: html2pdf.js has limited control<br>   - Solution: Use `page-break-before` CSS carefully<br>   - Test thoroughly to avoid orphaned content<br><br>3. **Mobile File Size**: Large PDFs fail on mobile<br>   - Solution: Compress images, optimize chart resolution<br>   - Target: 2-3 MB for typical report<br><br>4. **Generation Time**: Complex reports can take 15-30 seconds<br>   - Solution: Show progress indicator, optimize rendering<br>   - Consider server-side PDF generation (Puppeteer) for speed<br><br>**Alternative Libraries (if html2pdf.js insufficient):**<br>- **jsPDF**: More control, but lower-level API<br>- **pdfmake**: Good for tables and text, limited chart support<br>- **Puppeteer (server-side)**: Faster, more reliable, but requires backend<br><br>**Recommended Approach:**<br>1. Start with html2pdf.js improvements (already integrated)<br>2. If issues persist, consider server-side generation<br><br>**Content Sections (Prioritized):**<br>1. Cover page (branding, date)<br>2. Executive summary (1 page)<br>3. Household info (0.5 page)<br>4. Portfolio chart + breakdown (1 page)<br>5. Health score analysis (1 page)<br>6. Tax analysis chart (1 page)<br>7. Action plan (1-2 pages)<br>8. Year-by-year table (2-3 pages, key years only)<br>9. Assumptions and methodology (1 page)<br>10. Disclaimer (0.5 page)<br><br>**Total Pages**: 10-15 pages typical |
| **User Impact** | **High** - PDF reports are a key premium feature. Users expect professional quality comparable to financial planning tools. Poor formatting reduces perceived value. |
| **Known Issues** | - Current PDF generation may be basic/unformatted<br>- Charts may not render well<br>- Missing key sections (cover page, assumptions)<br>- No page numbers or headers/footers<br>- File sizes may be large<br>- Mobile rendering untested<br>- Generation may be slow<br>- No error handling for failures |
| **Success Metrics** | - [ ] 90%+ of premium users generate PDF reports<br>- [ ] <5% PDF generation failures<br>- [ ] Average file size <3MB<br>- [ ] Generation time <10 seconds<br>- [ ] User satisfaction with PDF quality >4/5<br>- [ ] <2% support tickets about PDF issues<br>- [ ] PDFs shared externally (indicates quality/trust) |
| **Dependencies** | - html2pdf.js library (v0.14.0, already updated in BUILD-FIX)<br>- jspdf library (v4.0.0, already updated in BUILD-FIX)<br>- Chart components functional<br>- Simulation data complete and accurate |
| **Related Stories** | US-032 (Premium Benefits Testing - includes PDF testing), US-024 (Premium Payment) |

---

| **US-034** | **Premium Features Review & Monetization Analysis** | **5** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want to review the effectiveness of premium features and analyze monetization performance so that I can optimize pricing, features, and conversion strategies |
| **Acceptance Criteria** | **Premium Feature Usage Analysis:**<br>- [ ] Track usage frequency of each premium feature<br>- [ ] Identify most/least used premium features<br>- [ ] Analyze feature adoption rate by cohort<br>- [ ] Compare expected vs actual feature usage<br><br>**Conversion & Retention Metrics:**<br>- [ ] Free-to-premium conversion rate<br>- [ ] Premium subscription churn rate<br>- [ ] Average time to conversion (days from signup)<br>- [ ] Conversion rate by feature gate touchpoint<br>- [ ] Monthly Recurring Revenue (MRR) growth<br>- [ ] Annual vs monthly plan split<br><br>**User Behavior Analysis:**<br>- [ ] Feature usage patterns (which features drive value?)<br>- [ ] Correlation between features and retention<br>- [ ] Premium user engagement vs free user engagement<br>- [ ] User feedback on premium features (support tickets, ratings)<br><br>**Monetization Optimization:**<br>- [ ] Evaluate pricing strategy ($5.99/mo, $47/yr)<br>- [ ] Compare to competitor pricing<br>- [ ] Identify opportunities for upsells/add-ons<br>- [ ] Assess value perception (is premium worth it?)<br>- [ ] Identify feature gaps (what premium users want)<br><br>**Financial Metrics:**<br>- [ ] Customer Acquisition Cost (CAC) for premium<br>- [ ] Lifetime Value (LTV) of premium subscribers<br>- [ ] LTV/CAC ratio (should be >3)<br>- [ ] Break-even point (when do we recover CAC?)<br>- [ ] Revenue per premium user<br>- [ ] Projected revenue at 100/500/1000 premium users |
| **Tasks** | **Data Collection:**<br>- [ ] Implement premium feature usage tracking (analytics events)<br>- [ ] Create premium user dashboard (analytics)<br>- [ ] Set up conversion funnel tracking<br>- [ ] Query Stripe for subscription metrics<br>- [ ] Survey premium users (feature satisfaction, value perception)<br><br>**Analysis:**<br>- [ ] Generate premium feature usage report<br>- [ ] Analyze conversion funnel (where do users drop off?)<br>- [ ] Calculate CAC, LTV, LTV/CAC ratio<br>- [ ] Benchmark against industry standards<br>- [ ] Identify most impactful conversion touchpoints<br>- [ ] Review competitor pricing and features<br><br>**Optimization Recommendations:**<br>- [ ] Prioritize features to build/improve based on data<br>- [ ] Recommend pricing adjustments (if needed)<br>- [ ] Suggest new premium features to add<br>- [ ] Identify low-value features to deprecate/move to free<br>- [ ] Optimize feature gate messaging<br>- [ ] Create retention strategies for premium users<br><br>**Documentation:**<br>- [ ] Write monetization analysis report<br>- [ ] Create premium features dashboard (ongoing tracking)<br>- [ ] Document pricing strategy and rationale<br>- [ ] Update product roadmap based on findings<br>- [ ] Present findings to stakeholders |
| **Technical Notes** | **Current Premium Features (9 total):**<br>1. **Early Retirement Calculator**: Unlimited calculations (free: 10/day)<br>   - Usage metric: API calls to `/api/early-retirement/calculate`<br>   - Value hypothesis: High - enables retirement planning<br><br>2. **Scenario Persistence**: Save/load simulations<br>   - Usage metric: API calls to `/api/scenarios/save`, `/api/scenarios/route`<br>   - Value hypothesis: Medium - convenience for repeat users<br><br>3. **CSV Export**: Download simulation data<br>   - Usage metric: Button clicks, downloads completed<br>   - Value hypothesis: Medium - useful for advisors<br><br>4. **PDF Report**: Professional retirement report<br>   - Usage metric: Button clicks, PDFs generated<br>   - Value hypothesis: High - shareable, professional<br><br>5. **Interactive Retirement Age Slider**: What-if scenarios<br>   - Usage metric: Slider interactions, simulations run<br>   - Value hypothesis: High - enables exploration<br><br>6. **Multiple Market Scenarios**: Pessimistic/neutral/optimistic<br>   - Usage metric: Scenario switches, comparisons made<br>   - Value hypothesis: Medium - risk assessment<br><br>7. **Detailed Year-by-Year Projections**: Full data<br>   - Usage metric: Table views, expansions<br>   - Value hypothesis: Medium - transparency<br><br>8. **Advanced Charts**: Enhanced visualizations<br>   - Usage metric: Chart interactions, views<br>   - Value hypothesis: Low-Medium - aesthetic value<br><br>9. **Priority Email Support**: Faster responses<br>   - Usage metric: Support tickets from premium users, response time<br>   - Value hypothesis: Low - rarely used<br><br>**Key Questions to Answer:**<br>1. Which premium feature drives the most conversions?<br>2. Do premium users use all 9 features, or just 1-2?<br>3. What's the average time from signup to conversion?<br>4. Do users convert on first feature gate, or after multiple encounters?<br>5. Is the yearly plan ($47) more popular than monthly ($5.99)?<br>6. What's the churn rate for premium subscribers?<br>7. Why do premium users churn? (exit survey)<br>8. Are we leaving money on the table (underpriced)?<br>9. Should we add more tiers (e.g., Pro, Enterprise)?<br>10. What features should we add to increase value?<br><br>**Financial Calculations:**<br>- CAC = (Marketing + Sales Cost) / New Premium Subscribers<br>- LTV = (Monthly Revenue √ó Gross Margin) / Churn Rate<br>- Target LTV/CAC: >3 (ideally 5-7)<br>- Break-even: When does revenue > CAC?<br><br>**Competitive Benchmarks:**<br>- NewRetirement: $120/year (~$10/month)<br>- Boldin (formerly NewRetirement): $95/year<br>- Personal Capital: Free (monetizes through wealth management)<br>- Wealthica: $50/year CAD (~$36 USD)<br>- RetireZest: $47/year (~$4/month) - competitive! |
| **User Impact** | **Critical** - Monetization success determines business viability. Underpriced = leaving money on table. Overpriced = low conversion. Wrong features = low retention. This analysis guides product strategy. |
| **Known Issues** | - No analytics tracking for premium feature usage yet<br>- Conversion funnel not instrumented<br>- No user satisfaction surveys<br>- Limited data (new feature, few premium users yet)<br>- CAC unknown (no marketing spend tracked)<br>- Competitive pricing research not done<br>- No A/B testing of pricing/features |
| **Success Metrics** | - [ ] Data-driven recommendation for pricing optimization<br>- [ ] Identify top 3 value-driving features<br>- [ ] Achieve LTV/CAC ratio >3<br>- [ ] Increase free-to-premium conversion by 20%<br>- [ ] Reduce premium churn to <5% monthly<br>- [ ] Premium user satisfaction >4.5/5<br>- [ ] Clear product roadmap for premium features<br>- [ ] Monetization dashboard created (ongoing tracking) |
| **Dependencies** | - US-024 (Premium Payment System) complete<br>- US-032 (Premium Benefits Testing) complete<br>- Analytics platform (Posthog/Mixpanel) integrated<br>- At least 20-50 premium users for meaningful data<br>- Access to Stripe subscription data<br>- User survey tool (Typeform, Google Forms) |
| **Related Stories** | US-024 (Premium Payment), US-032 (Premium Benefits Testing), US-033 (PDF Reports) |

---

| **US-045** | **Implement 10-Simulation Limit for Free Tier** | **5** | **P1** | **üìã To Do** |
| **Description** | As a product owner, I want to limit free-tier users to 10 lifetime simulations and require a Premium upgrade for unlimited simulations, so that we can monetize power users while keeping the product accessible to casual users |
| **Acceptance Criteria** | **Backend Enforcement:**<br>- [ ] Free users can run exactly 10 simulations (lifetime limit)<br>- [ ] 11th simulation attempt is blocked with clear error message<br>- [ ] Premium users (`subscriptionTier === 'premium'`) have unlimited simulations<br>- [ ] API route `/api/simulation/run` enforces limit before running simulation<br>- [ ] Simulation count incremented in database after successful simulation<br>- [ ] Error response includes `requiresUpgrade: true` and `upgradeUrl: '/subscribe'`<br><br>**Frontend UI:**<br>- [ ] Simulation count badge displays "X/10 simulations used" for free users<br>- [ ] Warning banner appears at 8/10 and 9/10 simulations<br>- [ ] Upgrade modal appears automatically when limit reached<br>- [ ] Clear messaging: "Upgrade to Premium for unlimited simulations"<br>- [ ] Premium users see "Unlimited simulations" badge (no counter)<br><br>**User Experience:**<br>- [ ] Free users at 0-7 simulations: Small badge, no blocking<br>- [ ] Free users at 8-9 simulations: Warning banner with upgrade CTA<br>- [ ] Free users at 10 simulations: Blocked with upgrade modal<br>- [ ] Premium users: No limits, no warnings, seamless experience<br>- [ ] Upgrade flow: Free ‚Üí Premium removes limit immediately<br><br>**Edge Cases:**<br>- [ ] Users who already ran >10 simulations are grandfathered (not blocked)<br>- [ ] Failed simulations don't count toward limit<br>- [ ] Saved scenarios: Re-running counts as new simulation<br>- [ ] Early retirement calculator: Separate limit (not affected by this story)<br><br>**Analytics:**<br>- [ ] Track when users hit the 10-simulation limit<br>- [ ] Track conversion rate: limit reached ‚Üí Premium upgrade<br>- [ ] Log simulation count distribution (how many users at 1, 2, 3... 10 sims?) |
| **Tasks** | **Backend Implementation (4 hours):**<br>- [ ] Update `/api/simulation/run/route.ts` with limit check (after email verification)<br>- [ ] Create `/api/user/simulation-count/route.ts` endpoint to fetch count<br>- [ ] Count existing `SimulationRun` records for user<br>- [ ] Return error if count >= 10 and user is not premium<br>- [ ] Increment count after successful simulation (create SimulationRun record)<br>- [ ] Add `requiresUpgrade` flag to error response<br><br>**Frontend UI Implementation (3 hours):**<br>- [ ] Add simulation count state to simulation page<br>- [ ] Fetch count on page load (if not premium)<br>- [ ] Display badge: "X/10 simulations used (Free)"<br>- [ ] Add warning banner component (8/10, 9/10)<br>- [ ] Handle limit exceeded error (show upgrade modal)<br>- [ ] Update UpgradeModal to highlight "unlimited simulations"<br>- [ ] Show "Premium - Unlimited simulations" for premium users<br><br>**Testing (2 hours):**<br>- [ ] Test free user: 0 ‚Üí 10 simulations (each increments counter)<br>- [ ] Test 11th simulation is blocked<br>- [ ] Test upgrade modal appears on limit<br>- [ ] Test premium user has no limits<br>- [ ] Test free ‚Üí premium upgrade removes limit immediately<br>- [ ] Test simulation count displays correctly in UI<br>- [ ] Test warning banners at 8/10 and 9/10<br>- [ ] Test grandfathered users (>10 sims already)<br><br>**Documentation (1 hour):**<br>- [ ] Update `/subscribe` page to highlight "unlimited simulations"<br>- [ ] Add FAQ: "How many simulations can I run on the free plan?"<br>- [ ] Update premium features list<br>- [ ] Create help article: "Understanding Free vs. Premium Limits"<br><br>**Analytics Setup (30 min):**<br>- [ ] Add event: `simulation_limit_reached`<br>- [ ] Add event: `simulation_limit_upgrade` (when user upgrades after hitting limit)<br>- [ ] Create dashboard to track limit impact on conversions |
| **Technical Notes** | **Database Schema:**<br>- SimulationRun table exists (tracks individual simulations)<br>- User table has `subscriptionTier` field ("free" or "premium")<br>- No counter field needed initially (use COUNT query)<br>- Future optimization: Add `simulationCount` field to User table<br><br>**Implementation Approach:**<br>```typescript<br>// In /api/simulation/run/route.ts (after line 64)<br>const isPremium = user.subscriptionTier === 'premium' &&<br>                  user.subscriptionStatus === 'active';<br><br>if (!isPremium) {<br>  const count = await prisma.simulationRun.count({<br>    where: { userId: session.userId }<br>  });<br><br>  if (count >= 10) {<br>    return NextResponse.json({<br>      success: false,<br>      message: 'Free tier limit reached',<br>      error: 'Upgrade to Premium for unlimited simulations',<br>      requiresUpgrade: true,<br>      simulationCount: count,<br>      simulationLimit: 10,<br>      upgradeUrl: '/subscribe',<br>    }, { status: 403 });<br>  }<br>}<br>```<br><br>**Frontend Display:**<br>```typescript<br>// Show counter for free users<br>{!isPremium && simulationCount !== null && (<br>  <Badge variant={simulationCount >= 8 ? 'warning' : 'default'}><br>    {simulationCount}/10 simulations used<br>  </Badge><br>)}<br><br>// Show premium badge<br>{isPremium && (<br>  <Badge variant="premium"><br>    Premium - Unlimited simulations<br>  </Badge><br>)}<br>```<br><br>**Grandfathering Logic:**<br>- Users created before feature launch date: No limit<br>- Implementation: `if (user.createdAt < FEATURE_LAUNCH_DATE) return;`<br>- Or: Don't enforce limit, just show counter (soft launch)<br><br>**Performance Consideration:**<br>- COUNT query on SimulationRun table is fast (indexed userId)<br>- If performance issue: Add `simulationCount` counter field to User<br>- Counter field requires migration and careful increment logic<br><br>**Files to Create:**<br>- `/api/user/simulation-count/route.ts` (new)<br><br>**Files to Modify:**<br>- `/api/simulation/run/route.ts` (add limit check)<br>- `/app/(dashboard)/simulation/page.tsx` (add counter UI)<br>- `/components/modals/UpgradeModal.tsx` (update messaging)<br>- `/app/(dashboard)/subscribe/page.tsx` (highlight unlimited sims) |
| **User Impact** | **High** - This is a key monetization feature. Directly drives free-to-premium conversions. Must balance revenue goals with user experience. Poor messaging or aggressive limits can cause churn. |
| **Known Issues** | - Feature not currently implemented (users have unlimited simulations)<br>- No tracking of simulation counts per user<br>- No analytics on conversion from limit<br>- Need to decide on grandfathering existing users<br>- May cause backlash if announced poorly (communicate value of Premium)<br>- Early retirement calculator has separate limit (3/day) - may cause confusion |
| **Success Metrics** | **Conversion:**<br>- [ ] 15%+ conversion rate from users who hit limit<br>- [ ] 10%+ conversion rate from users who see 8/10 warning<br><br>**Engagement:**<br>- [ ] <10% user churn after hitting limit (acceptable drop-off)<br>- [ ] Users who upgrade run 2x more simulations post-upgrade<br><br>**Revenue:**<br>- [ ] 20%+ increase in Premium subscriptions within 30 days<br>- [ ] LTV of users who convert via limit > $100<br><br>**User Satisfaction:**<br>- [ ] <5% negative feedback about limit<br>- [ ] Clear understanding of free vs premium (survey)<br>- [ ] Premium users feel value justified by unlimited access |
| **Dependencies** | - Premium subscription system working (US-024)<br>- SimulationRun records being created correctly<br>- User subscriptionTier field accurate<br>- Upgrade flow tested and working |
| **Related Stories** | US-024 (Premium Payment System), US-032 (Premium Benefits Testing), US-034 (Monetization Analysis) |
| **Documentation** | See detailed implementation guide: `PREMIUM_FEATURE_SIMULATION_LIMIT.md` |

---

| **US-046** | **Improve Low Success Rate Messaging** | **8** | **P0** | **üìã To Do** |
| **Description** | As a user with a low success rate retirement plan, I want clear explanations of why my plan is failing and specific recommendations to fix it, so that I can make informed adjustments rather than being confused by a low percentage |
| **Acceptance Criteria** | **Low Success Rate Detection:**<br>- [ ] Detect when simulation success rate < 10%<br>- [ ] Show contextual warning modal with specific failure reasons<br>- [ ] Identify exact issues: low savings, early retirement, no income, high expenses, etc.<br>- [ ] Calculate income gap years (retirement age to CPP/OAS eligibility)<br>- [ ] Display 3-5 actionable recommendations ranked by impact<br><br>**Warning Modal Content:**<br>- [ ] Clear headline: "Your Retirement Plan Needs Attention"<br>- [ ] Explain what success rate means (% of scenarios where money lasts to age 95)<br>- [ ] Show specific reasons for failure (e.g., "Retiring at 50 with $0 assets won't cover expenses until CPP starts at 60")<br>- [ ] Provide calculations: years to bridge √ó annual expenses = funding needed<br>- [ ] List recommendations: delay retirement, add savings, reduce expenses, plan for income gap<br>- [ ] Link to relevant help docs (early retirement guide, withdrawal strategies)<br><br>**User Actions:**<br>- [ ] "Adjust My Plan" button navigates back to simulation form with guidance<br>- [ ] "Talk to an Advisor" button links to contact/support<br>- [ ] "I Understand, Continue" option allows user to proceed with acknowledgement<br>- [ ] Warning can be dismissed but shows again on next simulation if success rate still low<br><br>**Analytics:**<br>- [ ] Track how many users see low success rate warning<br>- [ ] Track which action users take (adjust, advisor, dismiss)<br>- [ ] Monitor if adjustments improve success rate<br>- [ ] A/B test different warning messages for effectiveness |
| **Tasks** | **Analysis & Design (2 hours):**<br>- [ ] Create `getFailureReasons()` function to analyze simulation results<br>- [ ] Define criteria for each failure reason:<br>  - Early retirement (retirement age < 60, no CPP/OAS coverage)<br>  - Insufficient savings (assets < 10√ó annual expenses)<br>  - No income sources (employment, pension, rental all $0)<br>  - High expense ratio (expenses > assets / expected years)<br>  - Income gap (years between retirement and benefits)<br>- [ ] Design `LowSuccessRateWarning` modal (Figma or wireframe)<br>- [ ] Write messaging copy (clear, empathetic, actionable)<br><br>**Backend Implementation (2 hours):**<br>- [ ] Update simulation response to include `failureReasons` array<br>- [ ] Add income gap calculation (retirement age to CPP/OAS ages)<br>- [ ] Calculate funding needed for gap years<br>- [ ] Generate personalized recommendations based on scenario<br>- [ ] Add `warningDismissed` tracking to user session<br><br>**Frontend Implementation (3 hours):**<br>- [ ] Create `LowSuccessRateWarning` component (modal or card)<br>- [ ] Display specific failure reasons with icons/formatting<br>- [ ] Show calculations (e.g., "10 years √ó $60K = $600K needed")<br>- [ ] Add recommendation list with priority badges<br>- [ ] Implement action buttons (Adjust, Advisor, Dismiss)<br>- [ ] Link to help docs contextually<br>- [ ] Add to `/simulation/results` page (show after results load)<br><br>**Testing (1 hour):**<br>- [ ] Test with various low success rate scenarios (0-10%)<br>- [ ] Test failure reason detection accuracy<br>- [ ] Test recommendation relevance for each scenario<br>- [ ] Test modal behavior (display, dismiss, re-show)<br>- [ ] Test action button flows<br>- [ ] Test analytics events fire correctly |
| **Technical Notes** | **Failure Reason Detection Logic:**<br>```typescript<br>function getFailureReasons(simulation: SimulationResult): FailureReason[] {<br>  const reasons: FailureReason[] = [];<br>  <br>  // Early retirement without income coverage<br>  if (simulation.retirementAge < 60) {<br>    const gapYears = 60 - simulation.retirementAge;<br>    const fundingNeeded = gapYears * simulation.annualExpenses;<br>    <br>    reasons.push({<br>      type: 'EARLY_RETIREMENT_GAP',<br>      severity: 'critical',<br>      message: `Retiring at age ${simulation.retirementAge} means ${gapYears} years without CPP/OAS`,<br>      calculation: `${gapYears} years √ó $${simulation.annualExpenses.toLocaleString()}/year = $${fundingNeeded.toLocaleString()} needed`,<br>      recommendations: [<br>        'Delay retirement to age 60 when CPP starts',<br>        'Plan for part-time income until age 60',<br>        'Ensure you have adequate savings to cover gap years'<br>      ]<br>    });<br>  }<br>  <br>  // Insufficient savings<br>  const totalAssets = simulation.rrsp + simulation.tfsa + simulation.nonReg;<br>  const yearsInRetirement = 95 - simulation.retirementAge;<br>  const assetsNeeded = simulation.annualExpenses * yearsInRetirement;<br>  <br>  if (totalAssets < assetsNeeded * 0.1) { // Less than 10% of needed<br>    reasons.push({<br>      type: 'INSUFFICIENT_SAVINGS',<br>      severity: 'critical',<br>      message: `Current savings ($${totalAssets.toLocaleString()}) won't cover ${yearsInRetirement} years of expenses`,<br>      calculation: `Need ~$${assetsNeeded.toLocaleString()} for ${yearsInRetirement} years at $${simulation.annualExpenses.toLocaleString()}/year`,<br>      recommendations: [<br>        'Increase savings before retiring',<br>        'Reduce annual expenses',<br>        'Work longer to build more assets'<br>      ]<br>    });<br>  }<br>  <br>  // No income sources<br>  if (simulation.employmentIncome === 0 && simulation.pensionIncome === 0 && simulation.rentalIncome === 0) {<br>    reasons.push({<br>      type: 'NO_INCOME_SOURCES',<br>      severity: 'high',<br>      message: 'No employment, pension, or rental income to supplement savings',<br>      recommendations: [<br>        'Consider part-time work in early retirement',<br>        'Explore rental income opportunities',<br>        'Review if you have pensions not yet entered'<br>      ]<br>    });<br>  }<br>  <br>  return reasons;<br>}<br>```<br><br>**Warning Modal Component:**<br>- Component: `components/modals/LowSuccessRateWarning.tsx`<br>- Triggered when: `successRate < 10` in simulation results<br>- Dismissible: Yes, but re-shows on next simulation<br>- Priority: Show BEFORE user sees detailed results (intercept)<br><br>**Help Doc Links:**<br>- Early retirement guide: `/help/early-retirement` (US-049)<br>- Withdrawal strategies: `/help/withdrawal-strategies`<br>- Government benefits timing: `/help/cpp-oas-timing`<br><br>**Analytics Events:**<br>- `low_success_rate_warning_shown` (includes success rate, failure reasons)<br>- `low_success_rate_action_adjust` (user clicked "Adjust My Plan")<br>- `low_success_rate_action_advisor` (user clicked "Talk to Advisor")<br>- `low_success_rate_action_dismiss` (user dismissed warning)<br>- `low_success_rate_improvement` (user adjusted and improved success rate) |
| **User Impact** | **Critical** - Users with 0.6% success rate (like glacial-keels user) are confused and think "the app is broken" when it's actually showing their plan won't work. Clear messaging turns confusion into actionable steps. |
| **Success Metrics** | - [ ] 80%+ of users who see warning understand the issue (post-survey)<br>- [ ] 40%+ of users take action to adjust plan after seeing warning<br>- [ ] Average success rate improvement: >20 percentage points after adjustment<br>- [ ] <10% of users dismiss warning and proceed with low success rate<br>- [ ] User satisfaction improves (fewer "app is broken" support tickets) |
| **Dependencies** | - Simulation results API returning success rate<br>- User profile data (retirement age, assets, income, expenses)<br>- Help documentation for linking (US-049 for early retirement guide) |
| **Related Stories** | US-047 (Baseline Scenario Fix), US-048 (Early Retirement Validation), US-049 (Early Retirement Guide) |
| **Reference** | See investigation: `EARLY_RETIREMENT_ISSUE_INVESTIGATION.md` |

---

| **US-047** | **Fix Baseline Scenario Auto-Population from User Profile** | **3** | **P1** | **üìã To Do** |
| **Description** | As a new user, I want my baseline scenario to automatically use my actual age, province, and retirement preferences from my profile, so that my simulations are relevant to my situation without manual re-entry |
| **Acceptance Criteria** | **Auto-Population Logic:**<br>- [ ] Calculate user's current age from `dateOfBirth` when creating baseline scenario<br>- [ ] Use user's `province` instead of defaulting to "ON"<br>- [ ] Use user's `targetRetirementAge` if set, otherwise default to current age<br>- [ ] Set CPP start age to `max(60, retirementAge)` (CPP minimum is 60)<br>- [ ] Set OAS start age to `max(65, retirementAge)` (OAS minimum is 65)<br>- [ ] Set RRIF conversion age to `max(71, retirementAge)` (RRIF mandatory at 71)<br><br>**New User Flow:**<br>- [ ] When user completes onboarding, baseline scenario created with profile data<br>- [ ] If user updates profile (age, province), baseline scenario auto-updates<br>- [ ] User can still manually edit scenario fields (not locked)<br><br>**Existing User Migration:**<br>- [ ] Create migration script to fix existing baseline scenarios<br>- [ ] Update scenarios where age = 65 and user's actual age ‚â† 65<br>- [ ] Update scenarios where province = "ON" and user's province ‚â† "ON"<br>- [ ] Log changes made for audit trail<br>- [ ] Test migration on staging before production<br><br>**Validation:**<br>- [ ] Prevent invalid ages (current age < 18 or > 100)<br>- [ ] Prevent retirement age < current age (can't retire in the past)<br>- [ ] Ensure CPP/OAS ages respect minimum rules |
| **Tasks** | **Backend Implementation (2 hours):**<br>- [ ] Create `calculateAgeFromDOB()` utility function<br>- [ ] Update `/api/scenario/create-baseline` endpoint:<br>  - [ ] Fetch user's `dateOfBirth`, `province`, `targetRetirementAge`<br>  - [ ] Calculate current age from DOB<br>  - [ ] Set scenario fields from user profile<br>  - [ ] Apply CPP/OAS age validation<br>- [ ] Add input validation for scenario creation<br>- [ ] Update scenario update logic to re-validate ages<br><br>**Migration Script (1 hour):**<br>- [ ] Create `scripts/fix-baseline-scenarios.ts`<br>- [ ] Query all users with baseline scenarios<br>- [ ] For each user:<br>  - [ ] Calculate actual age from `dateOfBirth`<br>  - [ ] Compare with scenario's `currentAge`<br>  - [ ] If mismatch, update scenario<br>  - [ ] Compare province, update if different<br>  - [ ] Log: `Updated baseline for user ${userId}: age ${oldAge} ‚Üí ${newAge}, province ${oldProvince} ‚Üí ${newProvince}`<br>- [ ] Run migration on staging database first<br>- [ ] Review logs, verify no errors<br>- [ ] Run migration on production database<br><br>**Testing (30 min):**<br>- [ ] Test new user signup: baseline uses correct age/province<br>- [ ] Test user with DOB set: age calculated correctly<br>- [ ] Test user with no DOB: defaults gracefully<br>- [ ] Test user updates profile: scenario updates accordingly<br>- [ ] Test migration script with sample data<br>- [ ] Test edge cases (age 18, age 95, no province set) |
| **Technical Notes** | **Age Calculation Function:**<br>```typescript<br>function calculateAgeFromDOB(dateOfBirth: Date): number {<br>  const today = new Date();<br>  let age = today.getFullYear() - dateOfBirth.getFullYear();<br>  const monthDiff = today.getMonth() - dateOfBirth.getMonth();<br>  <br>  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dateOfBirth.getDate())) {<br>    age--;<br>  }<br>  <br>  return age;<br>}<br>```<br><br>**Baseline Scenario Creation (Updated):**<br>```typescript<br>// In /api/scenario/create-baseline/route.ts<br>const user = await prisma.user.findUnique({<br>  where: { id: session.userId },<br>  select: { dateOfBirth: true, province: true, targetRetirementAge: true }<br>});<br><br>const currentAge = user.dateOfBirth <br>  ? calculateAgeFromDOB(user.dateOfBirth) <br>  : 65; // fallback if no DOB<br><br>const retirementAge = user.targetRetirementAge || currentAge;<br>const province = user.province || "ON";<br><br>const baselineScenario = await prisma.scenario.create({<br>  data: {<br>    userId: session.userId,<br>    name: "Baseline",<br>    description: "Your default retirement scenario",<br>    currentAge,<br>    retirementAge,<br>    province,<br>    cppStartAge: Math.max(60, retirementAge),<br>    oasStartAge: Math.max(65, retirementAge),<br>    rrspToRrifAge: Math.max(71, retirementAge),<br>    lifeExpectancy: 95,<br>    isBaseline: true,<br>    // ... other fields<br>  }<br>});<br>```<br><br>**Migration Script:**<br>```typescript<br>// scripts/fix-baseline-scenarios.ts<br>import { PrismaClient } from '@prisma/client';<br>const prisma = new PrismaClient();<br><br>async function fixBaselineScenarios() {<br>  const users = await prisma.user.findMany({<br>    where: { dateOfBirth: { not: null } },<br>    include: { scenarios: { where: { isBaseline: true } } }<br>  });<br><br>  for (const user of users) {<br>    if (user.scenarios.length === 0) continue;<br>    <br>    const scenario = user.scenarios[0];<br>    const actualAge = calculateAgeFromDOB(user.dateOfBirth!);<br>    const actualProvince = user.province || scenario.province;<br>    <br>    if (scenario.currentAge !== actualAge || scenario.province !== actualProvince) {<br>      await prisma.scenario.update({<br>        where: { id: scenario.id },<br>        data: {<br>          currentAge: actualAge,<br>          province: actualProvince,<br>          retirementAge: user.targetRetirementAge || actualAge,<br>          cppStartAge: Math.max(60, user.targetRetirementAge || actualAge),<br>          oasStartAge: Math.max(65, user.targetRetirementAge || actualAge),<br>        }<br>      });<br>      <br>      console.log(`Updated user ${user.email}: age ${scenario.currentAge} ‚Üí ${actualAge}, province ${scenario.province} ‚Üí ${actualProvince}`);<br>    }<br>  }<br>}<br>```<br><br>**Files to Modify:**<br>- `/api/scenario/create-baseline/route.ts` (update creation logic)<br>- `/lib/utils/age.ts` (new utility file for age calculation)<br>- `scripts/fix-baseline-scenarios.ts` (new migration script) |
| **User Impact** | **High** - Users like glacial-keels (age 51, QC) get baseline scenario with age 65, ON - completely wrong data. This causes confusion and "app is broken" feedback. Fixing this improves first-use experience significantly. |
| **Success Metrics** | - [ ] 100% of new users have baseline scenario matching their profile<br>- [ ] 0 user complaints about "wrong age in simulation"<br>- [ ] Migration successfully updates >90% of mismatched scenarios<br>- [ ] No errors during migration (staging and production) |
| **Dependencies** | - User `dateOfBirth` field populated during onboarding<br>- Scenario creation endpoint working<br>- Database migration capability (Prisma) |
| **Related Stories** | US-046 (Low Success Rate Messaging), US-048 (Early Retirement Validation) |
| **Reference** | See investigation: `EARLY_RETIREMENT_ISSUE_INVESTIGATION.md` (user glacial-keels had age 51 but scenario showed 65) |

---

| **US-048** | **Add Early Retirement Validation & Warnings** | **5** | **P1** | **üìã To Do** |
| **Description** | As a user planning early retirement (before age 60), I want to see warnings about CPP/OAS timing and income gaps, so that I can plan appropriately for the years before government benefits start |
| **Acceptance Criteria** | **Early Retirement Detection:**<br>- [ ] Detect when user sets `retirementAge < 60`<br>- [ ] Show warning: "You're planning early retirement (before CPP eligibility)"<br>- [ ] Calculate income gap: years from retirement age to CPP (60) and OAS (65)<br>- [ ] Display gap prominently: "10 years without CPP, 15 years without OAS"<br><br>**CPP/OAS Age Validation:**<br>- [ ] CPP start age input has minimum value of 60 (enforced)<br>- [ ] OAS start age input has minimum value of 65 (enforced)<br>- [ ] If user tries to set CPP < 60, auto-correct to 60 with explanation<br>- [ ] If user tries to set OAS < 65, auto-correct to 65 with explanation<br>- [ ] Show tooltip: "CPP cannot start before age 60 per CRA rules"<br><br>**Income Gap Calculation & Display:**<br>- [ ] Calculate years without CPP: `60 - retirementAge`<br>- [ ] Calculate years without OAS: `65 - retirementAge`<br>- [ ] Calculate funding needed: `gapYears √ó annualExpenses`<br>- [ ] Show in warning card: "You'll need $X to cover Y years before CPP starts"<br>- [ ] Suggest income sources: employment, rental, dividends, pension<br><br>**Educational Content:**<br>- [ ] Warning links to "Early Retirement Planning Guide" (US-049)<br>- [ ] Tooltip explains CPP reduction for taking at 60 (36% penalty)<br>- [ ] Tooltip explains OAS deferral bonus (up to 36% at age 70)<br>- [ ] Help text suggests strategies: part-time work, TFSA withdrawals, rental income<br><br>**User Experience:**<br>- [ ] Warning is informative, not blocking (user can proceed)<br>- [ ] Warning dismissible but persists until retirement age ‚â• 60 or acknowledged<br>- [ ] Clear call-to-action: "Review Income Sources" button<br>- [ ] Green checkmark when user has income sources configured for gap years |
| **Tasks** | **Frontend Validation Component (3 hours):**<br>- [ ] Create `EarlyRetirementWarning` component<br>- [ ] Add to simulation form (below retirement age input)<br>- [ ] Show when `retirementAge < 60`<br>- [ ] Calculate and display income gap years<br>- [ ] Calculate funding needed (gap years √ó expenses)<br>- [ ] Add "Review Income Sources" button ‚Üí navigate to income section<br>- [ ] Add "Learn More" link ‚Üí early retirement guide (US-049)<br>- [ ] Style as warning (yellow/orange, not red - informative not error)<br><br>**Input Validation (1 hour):**<br>- [ ] Add `min={60}` to CPP start age input<br>- [ ] Add `min={65}` to OAS start age input<br>- [ ] Add onChange handler to auto-correct invalid ages<br>- [ ] Show tooltip when auto-correction happens<br>- [ ] Add form validation error if user somehow bypasses min<br><br>**Help Content Integration (1 hour):**<br>- [ ] Create tooltip content for CPP rules<br>- [ ] Create tooltip content for OAS rules<br>- [ ] Add inline help text about early retirement considerations<br>- [ ] Link to help docs (when US-049 is complete)<br>- [ ] Add examples: "Retiring at 55? You'll need income for 5 years until CPP"<br><br>**Testing (30 min):**<br>- [ ] Test retirement age 50, 55, 60, 65 (warning shows/hides correctly)<br>- [ ] Test CPP age set to 55 (auto-corrects to 60)<br>- [ ] Test OAS age set to 60 (auto-corrects to 65)<br>- [ ] Test income gap calculation accuracy<br>- [ ] Test warning dismissal and re-show logic<br>- [ ] Test "Review Income Sources" button navigation |
| **Technical Notes** | **Early Retirement Warning Component:**<br>```typescript<br>// components/simulation/EarlyRetirementWarning.tsx<br>function EarlyRetirementWarning({ retirementAge, annualExpenses }) {<br>  if (retirementAge >= 60) return null;<br>  <br>  const cppGapYears = 60 - retirementAge;<br>  const oasGapYears = 65 - retirementAge;<br>  const fundingNeeded = cppGapYears * annualExpenses;<br>  <br>  return (<br>    <Alert variant="warning" className="mt-4"><br>      <AlertTriangle className="h-4 w-4" /><br>      <AlertTitle>Early Retirement Detected</AlertTitle><br>      <AlertDescription><br>        <p>You're planning to retire at age {retirementAge}:</p><br>        <ul className="list-disc ml-5 mt-2"><br>          <li><strong>{cppGapYears} years</strong> until CPP starts (age 60)</li><br>          <li><strong>{oasGapYears} years</strong> until OAS starts (age 65)</li><br>          <li>Estimated funding needed: <strong>${fundingNeeded.toLocaleString()}</strong></li><br>        </ul><br>        <p className="mt-3">Consider planning for:</p><br>        <ul className="list-disc ml-5"><br>          <li>Part-time employment until age 60</li><br>          <li>Rental income or dividends</li><br>          <li>Strategic TFSA/Non-Reg withdrawals</li><br>        </ul><br>        <div className="flex gap-2 mt-4"><br>          <Button onClick={() => navigate('/income-sources')}><br>            Review Income Sources<br>          </Button><br>          <Button variant="outline" onClick={() => window.open('/help/early-retirement')}><br>            Learn More<br>          </Button><br>        </div><br>      </AlertDescription><br>    </Alert><br>  );<br>}<br>```<br><br>**CPP/OAS Age Input Validation:**<br>```typescript<br>// In simulation form<br><Input<br>  type="number"<br>  min={60}<br>  max={70}<br>  value={cppStartAge}<br>  onChange={(e) => {<br>    const age = parseInt(e.target.value);<br>    if (age < 60) {<br>      setCppStartAge(60);<br>      toast.warning('CPP cannot start before age 60. Age set to 60.');<br>    } else {<br>      setCppStartAge(age);<br>    }<br>  }}<br>/><br><br><Input<br>  type="number"<br>  min={65}<br>  max={70}<br>  value={oasStartAge}<br>  onChange={(e) => {<br>    const age = parseInt(e.target.value);<br>    if (age < 65) {<br>      setOasStartAge(65);<br>      toast.warning('OAS cannot start before age 65. Age set to 65.');<br>    } else {<br>      setOasStartAge(age);<br>    }<br>  }}<br>/><br>```<br><br>**Income Gap Calculation:**<br>```typescript<br>function calculateIncomeGap(retirementAge: number, annualExpenses: number) {<br>  const cppGapYears = Math.max(0, 60 - retirementAge);<br>  const oasGapYears = Math.max(0, 65 - retirementAge);<br>  <br>  return {<br>    cppGapYears,<br>    oasGapYears,<br>    fundingNeededForCPP: cppGapYears * annualExpenses,<br>    fundingNeededForOAS: oasGapYears * annualExpenses,<br>  };<br>}<br>```<br><br>**Files to Create:**<br>- `components/simulation/EarlyRetirementWarning.tsx`<br><br>**Files to Modify:**<br>- `app/(dashboard)/simulation/page.tsx` (add warning component)<br>- Form inputs for CPP/OAS start age (add validation) |
| **User Impact** | **High** - Early retirees (like glacial-keels, age 51 retiring at 50) don't realize they need to fund 10 years before CPP and 15 years before OAS. This warning educates and prevents unrealistic plans. |
| **Success Metrics** | - [ ] 100% of early retirement plans show warning<br>- [ ] 60%+ of users click "Review Income Sources" after seeing warning<br>- [ ] 0% of users able to set CPP < 60 or OAS < 65<br>- [ ] User understanding of CPP/OAS timing improves (survey)<br>- [ ] Fewer "app is broken" complaints from early retirees |
| **Dependencies** | - Simulation form with retirement age, CPP, OAS inputs<br>- Income sources section in app<br>- Early Retirement Planning Guide (US-049) for "Learn More" link |
| **Related Stories** | US-046 (Low Success Rate Messaging), US-047 (Baseline Scenario Fix), US-049 (Early Retirement Guide) |
| **Reference** | See investigation: `EARLY_RETIREMENT_ISSUE_INVESTIGATION.md` |

---

| **US-049** | **Create Early Retirement Planning Guide** | **2** | **P2** | **üìã To Do** |
| **Description** | As a user considering early retirement, I want educational content about early retirement challenges and strategies, so that I can make informed decisions about my retirement age and financial planning |
| **Acceptance Criteria** | **Content Sections:**<br>- [ ] Overview: What is early retirement? (retiring before age 60)<br>- [ ] CPP rules: Minimum age 60, reduction for early claiming (36% at 60 vs 65)<br>- [ ] OAS rules: Minimum age 65, no early access, deferral bonus up to age 70 (36%)<br>- [ ] Income gap strategies: Part-time work, rental income, dividends, TFSA withdrawals<br>- [ ] Asset requirements: Calculator showing years √ó expenses = needed savings<br>- [ ] Withdrawal sequencing: TFSA first (tax-free), then Non-Reg (capital gains), delay RRSP/RRIF<br>- [ ] Examples: 3-5 realistic early retirement scenarios (ages 50, 55, 58) with asset levels<br>- [ ] Risks & considerations: Market downturns, healthcare costs, longevity risk<br><br>**Interactive Elements:**<br>- [ ] Early retirement asset calculator: Input age, retirement age, expenses ‚Üí Output needed savings<br>- [ ] CPP/OAS timing visual: Timeline showing when benefits start<br>- [ ] Income gap visualization: Chart showing years without government benefits<br>- [ ] Success story examples: "How John retired at 55 with $800K"<br><br>**Help Integration:**<br>- [ ] Create `/help/early-retirement` page<br>- [ ] Add to help navigation menu<br>- [ ] Link from simulation warnings (US-046, US-048)<br>- [ ] Link from FAQ section<br>- [ ] Add to onboarding tips (if user sets early retirement age)<br><br>**Accessibility & Design:**<br>- [ ] Mobile-responsive layout<br>- [ ] Clear headings and sections (scannable)<br>- [ ] Visual aids: charts, timelines, infographics<br>- [ ] Plain language (avoid jargon)<br>- [ ] Print-friendly version (PDF export option) |
| **Tasks** | **Content Writing (1 hour):**<br>- [ ] Write introduction: What is early retirement?<br>- [ ] Document CPP rules and reduction table (age 60-70)<br>- [ ] Document OAS rules and deferral bonus table (age 65-70)<br>- [ ] Create income gap strategies list (10+ strategies)<br>- [ ] Write asset requirement explanation and formula<br>- [ ] Create 3 example scenarios (different ages, asset levels)<br>- [ ] Write risks and considerations section<br>- [ ] Add FAQs (5-10 common questions)<br><br>**Page Development (1 hour):**<br>- [ ] Create `/app/(dashboard)/help/early-retirement/page.tsx`<br>- [ ] Design layout (hero section, content sections, examples)<br>- [ ] Add CPP/OAS reduction/bonus tables<br>- [ ] Create timeline visualization component<br>- [ ] Add asset calculator widget (interactive)<br>- [ ] Style content (typography, spacing, colors)<br>- [ ] Add navigation breadcrumbs<br>- [ ] Add "Related Articles" section at bottom<br><br>**Testing & Review:**<br>- [ ] Proofread content for accuracy<br>- [ ] Verify CPP/OAS numbers against CRA 2026 data<br>- [ ] Test asset calculator math<br>- [ ] Test on mobile devices (responsive)<br>- [ ] Test print version (PDF export)<br>- [ ] Get SME review (financial advisor, if available)<br>- [ ] User test with 2-3 early retirement planners |
| **Technical Notes** | **Asset Requirement Calculator:**<br>```typescript<br>// Interactive calculator widget<br>function EarlyRetirementCalculator() {<br>  const [currentAge, setCurrentAge] = useState(45);<br>  const [retirementAge, setRetirementAge] = useState(55);<br>  const [annualExpenses, setAnnualExpenses] = useState(60000);<br>  <br>  const cppGapYears = Math.max(0, 60 - retirementAge);<br>  const cppGapFunding = cppGapYears * annualExpenses;<br>  <br>  const oasGapYears = Math.max(0, 65 - retirementAge);<br>  const oasGapFunding = oasGapYears * annualExpenses;<br>  <br>  // Rough estimate: need to cover expenses until CPP/OAS<br>  const totalNeeded = cppGapFunding + (oasGapFunding * 0.5); // OAS adds more income<br>  <br>  return (<br>    <Card><br>      <CardHeader>Early Retirement Asset Calculator</CardHeader><br>      <CardContent><br>        <Label>Current Age</Label><br>        <Input type="number" value={currentAge} onChange={...} /><br>        <br>        <Label>Planned Retirement Age</Label><br>        <Input type="number" value={retirementAge} onChange={...} /><br>        <br>        <Label>Annual Expenses</Label><br>        <Input type="number" value={annualExpenses} onChange={...} /><br>        <br>        <div className="mt-4 p-4 bg-blue-50 rounded"><br>          <h4>Results:</h4><br>          <p>Years until CPP (age 60): <strong>{cppGapYears}</strong></p><br>          <p>Years until OAS (age 65): <strong>{oasGapYears}</strong></p><br>          <p>Estimated savings needed: <strong>${totalNeeded.toLocaleString()}</strong></p><br>        </div><br>      </CardContent><br>    </Card><br>  );<br>}<br>```<br><br>**CPP Reduction Table (CRA 2026):**<br>| Age | Reduction | Max CPP Monthly | vs. Age 65 |<br>|-----|-----------|-----------------|------------|<br>| 60 | -36% | ~$850 | -$480 |<br>| 61 | -28.8% | ~$950 | -$380 |<br>| 62 | -21.6% | ~$1,045 | -$285 |<br>| 63 | -14.4% | ~$1,140 | -$190 |<br>| 64 | -7.2% | ~$1,235 | -$95 |<br>| 65 | 0% | ~$1,330 | Baseline |<br>| 66 | +8.4% | ~$1,442 | +$112 |<br>| 67 | +16.8% | ~$1,553 | +$223 |<br>| 68 | +25.2% | ~$1,665 | +$335 |<br>| 69 | +33.6% | ~$1,777 | +$447 |<br>| 70 | +42% | ~$1,889 | +$559 |<br><br>**OAS Deferral Table (CRA 2026):**<br>| Age | Increase | Max OAS Monthly | vs. Age 65 |<br>|-----|----------|-----------------|------------|<br>| 65 | 0% | ~$700 | Baseline |<br>| 66 | +7.2% | ~$750 | +$50 |<br>| 67 | +14.4% | ~$800 | +$100 |<br>| 68 | +21.6% | ~$851 | +$151 |<br>| 69 | +28.8% | ~$901 | +$201 |<br>| 70 | +36% | ~$952 | +$252 |<br><br>**Example Scenario:**<br>**John's Early Retirement at 55**<br>- Current age: 50<br>- Retirement age: 55<br>- Annual expenses: $50,000<br>- Assets needed: $250K (5 years √ó $50K until CPP at 60)<br>- Income sources: Part-time consulting ($20K/year ages 55-60)<br>- Withdrawal strategy: TFSA first, then Non-Reg dividends<br>- Result: Successfully retired with $800K in assets<br><br>**Files to Create:**<br>- `/app/(dashboard)/help/early-retirement/page.tsx`<br>- `/components/help/EarlyRetirementCalculator.tsx` (calculator widget)<br>- `/components/help/CPPOASTimeline.tsx` (visual timeline) |
| **User Impact** | **Medium** - Educational content improves user knowledge and reduces confusion. Not a blocking feature, but significantly improves early retiree experience and reduces support burden. |
| **Success Metrics** | - [ ] Page views: >100 views in first month<br>- [ ] Average time on page: >3 minutes (indicates engagement)<br>- [ ] Users who read guide have higher success rates (A/B test)<br>- [ ] Reduced support tickets about "CPP before 60" or "why can't I access OAS at 60"<br>- [ ] User feedback: >4/5 "helpful" rating |
| **Dependencies** | - Help section exists in app<br>- Navigation structure supports help pages<br>- Markdown or rich text rendering capability |
| **Related Stories** | US-046 (Low Success Rate Messaging), US-048 (Early Retirement Validation) - both link to this guide |
| **Reference** | See investigation: `EARLY_RETIREMENT_ISSUE_INVESTIGATION.md` for motivation and user need |

---

## üéØ Epics

### Epic 1: User Retention & Engagement
**Goal**: Reduce user churn by 40% through proactive issue identification and resolution
**Total Story Points**: 31
**Status**: üîÑ In Progress
**User Stories**: US-001, US-002, US-003, US-004, US-005

### Epic 2: French Language Support
**Goal**: Expand to Quebec market (~22% of Canadian population)
**Total Story Points**: 34
**Status**: üìã Backlog
**User Stories**: US-006, US-007

### Epic 3: Investment & Account Configuration
**Goal**: Give users control over investment return assumptions and account settings
**Total Story Points**: 8
**Status**: üìã Backlog
**User Stories**: US-021

### Epic 4: UX Improvements
**Goal**: Reduce onboarding abandonment and improve user satisfaction
**Total Story Points**: 15
**Status**: üîÑ In Progress
**User Stories**: US-008 (‚úÖ), US-009, US-010 (‚úÖ), US-025, US-026

### Epic 5: Simulation Accuracy & Features
**Goal**: Ensure simulation results are accurate and trustworthy
**Total Story Points**: 78 (was 73, +5 for US-075)
**Status**: üîÑ In Progress
**User Stories**: US-011 (‚úÖ), US-012 (‚úÖ), US-013, US-023, US-031, US-036, US-037, US-046, US-047, US-048, US-049, US-072 (‚úÖ), US-073 (‚úÖ), US-074, US-075

### Epic 6: Testing & Quality
**Goal**: Achieve >80% test coverage and prevent regression bugs
**Total Story Points**: 42 (was 34, +3 for US-040, +5 for US-041)
**Status**: üìã Backlog
**User Stories**: US-014, US-015, US-022 (‚úÖ), US-035, US-040, US-041

### Epic 7: Performance & Optimization
**Goal**: Improve app performance and mobile experience
**Total Story Points**: 13
**Status**: üìã Backlog
**User Stories**: US-016, US-017

### Epic 8: Advanced Features
**Goal**: Add sophisticated features for power users
**Total Story Points**: 68
**Status**: üìã Icebox
**User Stories**: US-018, US-019, US-020

### Epic 9: Security & Compliance
**Goal**: Ensure application security and protect user data
**Total Story Points**: 13
**Status**: üìã To Do
**User Stories**: US-030

### Epic 10: Monetization & Revenue
**Goal**: Ensure reliable payment processing, subscription management, and premium feature delivery
**Total Story Points**: 26
**Status**: üìã To Do
**User Stories**: US-024, US-032, US-033, US-034

### Epic 11: Process Improvements & Team Efficiency
**Goal**: Improve Agile processes, sprint predictability, and team productivity through systematic improvements
**Total Story Points**: 12
**Status**: üîÑ In Progress (Sprint 3 Retrospective Action Items)
**Action Items**: AI-3.1, AI-3.2, AI-3.3, AI-3.4, AI-3.5, AI-3.6, AI-3.7

---

#### Sprint 3 Retrospective Action Items (January 30, 2026)

| ID | Action Item | Story Points | Priority | Status | Due Date |
|----|-------------|--------------|----------|--------|----------|
| **AI-3.1** | **Create Sprint Pivot Protocol** | **2** | **P0 üî¥** | **üìã To Do** | **Before Sprint 4** |
| **AI-3.2** | **Implement User Story Naming Convention** | **1** | **P1 üü°** | **üìã To Do** | **Before Sprint 4** |
| **AI-3.3** | **Create "Urgent Work" Kanban Swim Lane** | **1** | **P1 üü°** | **üìã To Do** | **Before Sprint 4** |
| **AI-3.4** | **Establish Fallback Process for Blocked Stories** | **1** | **P1 üü°** | **üìã To Do** | **Sprint 3 Day 2** |
| **AI-3.5** | **Conduct Mid-Sprint Check-In (Day 5)** | **1** | **P2 üü¢** | **üìã To Do** | **Sprint 3 Day 5** |
| **AI-3.6** | **Create UAT Checklist Template** | **3** | **P2 üü¢** | **üìã To Do** | **Sprint 4** |
| **AI-3.7** | **Update Sprint Board Daily** | **3** | **P0 üî¥** | **üìã To Do** | **Daily** |

**Detailed Descriptions**: See [SPRINT_3_RETROSPECTIVE.md](SPRINT_3_RETROSPECTIVE.md) for full action item details, acceptance criteria, and context.

**Summary**:
- **AI-3.1**: Document formal process for sprint pivots during user crises (2 hrs)
- **AI-3.2**: Adopt US/AH/BF/SP/AI naming convention to prevent numbering conflicts (1 hr)
- **AI-3.3**: Add "Urgent Work" swim lane to sprint board template (30 min)
- **AI-3.4**: Create fallback process when stories blocked >48 hours (1 hr)
- **AI-3.5**: Mid-sprint review on Day 5 to catch derailment early (30 min)
- **AI-3.6**: Standardized UAT checklist for user-facing features (1 hr)
- **AI-3.7**: Daily sprint board updates (5 min/day) - AI-2.2 reinforced!

---

## üìù User Story Template

```markdown
### US-XXX: [Title]

**As a** [user role]
**I want** [goal/desire]
**So that** [benefit/value]

**Story Points**: [1, 2, 3, 5, 8, 13, 21, 34]
**Priority**: [P0-Critical, P1-High, P2-Medium, P3-Low, P4-Nice-to-have, P5-Icebox]
**Epic**: [Epic name]
**Sprint**: [Sprint number or Backlog]

#### Acceptance Criteria
- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3

#### Technical Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

#### Definition of Done
- [ ] Code complete
- [ ] Tests written and passing
- [ ] Code reviewed
- [ ] Documentation updated
- [ ] Deployed to production
- [ ] Product owner approved

#### Notes
[Any additional context, dependencies, or technical notes]
```

---

## ‚úÖ Definition of Done

A user story is considered "Done" when:

### Code Quality
- [ ] Code is written and committed to version control
- [ ] Code follows project style guidelines
- [ ] No compiler/linter warnings
- [ ] No console errors in browser

### Testing
- [ ] Unit tests written and passing (where applicable)
- [ ] Integration tests passing (where applicable)
- [ ] Manual testing completed
- [ ] Edge cases tested

### Review
- [ ] Code review completed by peer
- [ ] Feedback addressed
- [ ] Product owner reviewed feature

### Documentation
- [ ] README updated (if needed)
- [ ] API documentation updated (if needed)
- [ ] User-facing documentation updated (if needed)
- [ ] Code comments added for complex logic

### Deployment
- [ ] Deployed to staging environment
- [ ] Smoke tests passed in staging
- [ ] Deployed to production
- [ ] Verified working in production

### Acceptance
- [ ] All acceptance criteria met
- [ ] Product owner approved
- [ ] No critical bugs
- [ ] Performance acceptable

---

## üèÉ Sprint Planning Process

### Sprint Duration
**2 weeks** (10 business days)

### Sprint Ceremonies

#### 1. Sprint Planning (Monday, Week 1 - 2 hours)
- Review product backlog
- Select user stories for sprint
- Break down stories into tasks
- Estimate story points
- Define sprint goal
- Commit to sprint backlog

#### 2. Daily Standup (Every day - 15 minutes)
**Three Questions**:
1. What did I complete yesterday?
2. What will I work on today?
3. Are there any blockers?

#### 3. Sprint Review (Friday, Week 2 - 1 hour)
- Demo completed user stories
- Get feedback from stakeholders
- Update product backlog based on feedback

#### 4. Sprint Retrospective (Friday, Week 2 - 1 hour)
**Discuss**:
- What went well?
- What could be improved?
- Action items for next sprint

### Estimation

**Story Points** (Fibonacci sequence):
- **1**: Trivial (< 2 hours)
- **2**: Simple (2-4 hours)
- **3**: Moderate (4-8 hours)
- **5**: Substantial (1-2 days)
- **8**: Complex (2-3 days)
- **13**: Very complex (3-5 days)
- **21**: Epic (5-10 days) - should be broken down
- **34**: Too large - must be broken down

### Velocity Tracking

**Sprint 1 Baseline**: TBD
**Target Velocity**: 30-40 story points per 2-week sprint

Track velocity over sprints to improve estimation accuracy.

---

## üìä Backlog Metrics

### Current Status (Jan 30, 2026)

**Total User Stories**: 38 ‚¨ÜÔ∏è New: US-036 (RRIF Tax Withholding), US-037 (Real Estate), US-038 (Income Timing Bug), US-039 (Pension Start Dates), US-042 (Strategy Name Alignment), US-043 (Mobile Strategy Switching)
**Completed**: 5 (13%)
**In Progress**: 0 (0%) - Sprint 2 complete
**To Do**: 33 (87%)

**By Priority**:
- P0 (Critical): 4 stories (2 done, 2 to do) ‚¨ÜÔ∏è New: US-038 (Income Timing Bug)
- P1 (High): 14 stories (2 done, 12 to do) ‚¨ÜÔ∏è New: US-034 (Monetization), US-039 (Pension Start Dates)
- P2 (Medium): 12 stories (1 done, 11 to do) ‚¨ÜÔ∏è New: US-036 (RRIF Withholding), US-037 (Real Estate), US-042 (Strategy Name Alignment), US-043 (Mobile Strategy Switching)
- P3 (Low): 4 stories (0 done, 4 to do)
- P4 (Nice-to-have): 2 stories
- P5 (Icebox): 2 stories

**By Epic**:
- Epic 1 (User Retention): 5 stories, 31 pts (‚úÖ 5 done - Sprint 1 complete)
- Epic 2 (French): 2 stories, 34 pts (all backlog)
- Epic 3 (Investment Config): 1 story, 8 pts (all to do)
- Epic 4 (UX): 9 stories, 41 pts (2 done, 7 to do) ‚¨ÜÔ∏è New: US-038 (Income Timing), US-039 (Pension Start)
- Epic 5 (Simulation): 8 stories, 70 pts (2 done, 6 to do) ‚¨ÜÔ∏è New: US-036 (RRIF Withholding), US-037 (Real Estate), US-042 (Strategy Name Alignment)
- Epic 6 (Testing): 4 stories, 34 pts (all backlog) ‚¨ÜÔ∏è New: US-035 (E2E Testing)
- Epic 7 (Performance): 3 stories, 16 pts (all to do) ‚¨ÜÔ∏è New: US-043 (Mobile Strategy Switching)
- Epic 8 (Advanced): 3 stories, 68 pts (all icebox)
- Epic 9 (Security): 1 story, 13 pts (all to do) ‚¨ÜÔ∏è NEW EPIC
- Epic 10 (Monetization): 4 stories, 26 pts (all to do)
- Epic 11 (Process Improvements): 7 action items, 12 pts (üîÑ in progress) ‚¨ÜÔ∏è NEW EPIC - Sprint 3 Retrospective

---

## üéØ Roadmap

### Q1 2026 (Jan-Mar)
**Focus**: User retention and core UX improvements

- ‚úÖ Fix critical UX issues (deletion bugs)
- üîÑ Monitor re-engagement campaign
- üìã Complete pension indexing backend
- üìã Validate RRIF strategies
- üìã Fix onboarding friction (Step 6)

### Q2 2026 (Apr-Jun)
**Focus**: Testing and quality improvements

- E2E test suite for critical paths
- Unit test coverage >80%
- Performance optimization
- Mobile responsiveness improvements

### Q3 2026 (Jul-Sep)
**Focus**: Market expansion

- French language support
- Quebec tax rules
- Marketing to Quebec users
- Re-engage Maurice Poitras

### Q4 2026 (Oct-Dec)
**Focus**: Advanced features

- Scenario comparison
- Monte Carlo simulation
- Advanced analytics dashboard

---

## üìû Backlog Management

### Adding New Stories
1. Write user story following template
2. Define acceptance criteria
3. Estimate story points
4. Assign priority
5. Link to epic
6. Add to product backlog

### Refining Backlog
- **Weekly**: Review top 10 stories with product owner
- **Bi-weekly**: Re-prioritize based on user feedback
- **Monthly**: Update epic goals and roadmap

### Sources of New Stories
- User feedback (deletion reasons, support tickets)
- Analytics (user behavior, drop-off points)
- Technical debt
- Competitive analysis
- Team initiatives

---

**Document Version**: 1.0
**Created**: January 29, 2026
**Next Review**: February 5, 2026
